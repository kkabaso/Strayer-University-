!function(e,t){"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(e,t){function n(e){var t="length"in e&&e.length,n=ie.type(e);return"function"!==n&&!ie.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===n||0===t||"number"==typeof t&&t>0&&t-1 in e))}function o(e,t,n){if(ie.isFunction(t))return ie.grep(e,function(e,o){return!!t.call(e,o,e)!==n});if(t.nodeType)return ie.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(he.test(t))return ie.filter(t,e,n);t=ie.filter(t,e)}return ie.grep(e,function(e){return ie.inArray(e,t)>=0!==n})}function i(e,t){do{e=e[t]}while(e&&1!==e.nodeType);return e}function r(e){var t=Se[e]={};return ie.each(e.match(ve)||[],function(e,n){t[n]=!0}),t}function s(){ge.addEventListener?(ge.removeEventListener("DOMContentLoaded",a,!1),e.removeEventListener("load",a,!1)):(ge.detachEvent("onreadystatechange",a),e.detachEvent("onload",a))}function a(){(ge.addEventListener||"load"===event.type||"complete"===ge.readyState)&&(s(),ie.ready())}function l(e,t,n){if(void 0===n&&1===e.nodeType){var o="data-"+t.replace(we,"-$1").toLowerCase();if("string"==typeof(n=e.getAttribute(o))){try{n="true"===n||"false"!==n&&("null"===n?null:+n+""===n?+n:Ve.test(n)?ie.parseJSON(n):n)}catch(e){}ie.data(e,t,n)}else n=void 0}return n}function c(e){var t;for(t in e)if(("data"!==t||!ie.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function u(e,t,n,o){if(ie.acceptData(e)){var i,r,s=ie.expando,a=e.nodeType,l=a?ie.cache:e,c=a?e[s]:e[s]&&s;if(c&&l[c]&&(o||l[c].data)||void 0!==n||"string"!=typeof t)return c||(c=a?e[s]=q.pop()||ie.guid++:s),l[c]||(l[c]=a?{}:{toJSON:ie.noop}),("object"==typeof t||"function"==typeof t)&&(o?l[c]=ie.extend(l[c],t):l[c].data=ie.extend(l[c].data,t)),r=l[c],o||(r.data||(r.data={}),r=r.data),void 0!==n&&(r[ie.camelCase(t)]=n),"string"==typeof t?null==(i=r[t])&&(i=r[ie.camelCase(t)]):i=r,i}}function d(e,t,n){if(ie.acceptData(e)){var o,i,r=e.nodeType,s=r?ie.cache:e,a=r?e[ie.expando]:ie.expando;if(s[a]){if(t&&(o=n?s[a]:s[a].data)){ie.isArray(t)?t=t.concat(ie.map(t,ie.camelCase)):t in o?t=[t]:(t=ie.camelCase(t),t=t in o?[t]:t.split(" ")),i=t.length;for(;i--;)delete o[t[i]];if(n?!c(o):!ie.isEmptyObject(o))return}(n||(delete s[a].data,c(s[a])))&&(r?ie.cleanData([e],!0):ne.deleteExpando||s!=s.window?delete s[a]:s[a]=null)}}}function h(){return!0}function f(){return!1}function g(){try{return ge.activeElement}catch(e){}}function p(e){var t=Be.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}function m(e,t){var n,o,i=0,r=typeof e.getElementsByTagName!==xe?e.getElementsByTagName(t||"*"):typeof e.querySelectorAll!==xe?e.querySelectorAll(t||"*"):void 0;if(!r)for(r=[],n=e.childNodes||e;null!=(o=n[i]);i++)!t||ie.nodeName(o,t)?r.push(o):ie.merge(r,m(o,t));return void 0===t||t&&ie.nodeName(e,t)?ie.merge([e],r):r}function T(e){Ie.test(e.type)&&(e.defaultChecked=e.checked)}function v(e,t){return ie.nodeName(e,"table")&&ie.nodeName(11!==t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function S(e){return e.type=(null!==ie.find.attr(e,"type"))+"/"+e.type,e}function y(e){var t=Je.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function b(e,t){for(var n,o=0;null!=(n=e[o]);o++)ie._data(n,"globalEval",!t||ie._data(t[o],"globalEval"))}function x(e,t){if(1===t.nodeType&&ie.hasData(e)){var n,o,i,r=ie._data(e),s=ie._data(t,r),a=r.events;if(a){delete s.handle,s.events={};for(n in a)for(o=0,i=a[n].length;i>o;o++)ie.event.add(t,n,a[n][o])}s.data&&(s.data=ie.extend({},s.data))}}function V(e,t){var n,o,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!ne.noCloneEvent&&t[ie.expando]){i=ie._data(t);for(o in i.events)ie.removeEvent(t,o,i.handle);t.removeAttribute(ie.expando)}"script"===n&&t.text!==e.text?(S(t).text=e.text,y(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),ne.html5Clone&&e.innerHTML&&!ie.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&Ie.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function w(t,n){var o,i=ie(n.createElement(t)).appendTo(n.body),r=e.getDefaultComputedStyle&&(o=e.getDefaultComputedStyle(i[0]))?o.display:ie.css(i[0],"display");return i.detach(),r}function C(e){var t=ge,n=Qe[e];return n||(n=w(e,t),"none"!==n&&n||(Ke=(Ke||ie("<iframe frameborder='0' width='0' height='0'/>")).appendTo(t.documentElement),t=(Ke[0].contentWindow||Ke[0].contentDocument).document,t.write(),t.close(),n=w(e,t),Ke.detach()),Qe[e]=n),n}function k(e,t){return{get:function(){var n=e();return null!=n?n?void delete this.get:(this.get=t).apply(this,arguments):void 0}}}function E(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),o=t,i=dt.length;i--;)if((t=dt[i]+n)in e)return t;return o}function N(e,t){for(var n,o,i,r=[],s=0,a=e.length;a>s;s++)o=e[s],o.style&&(r[s]=ie._data(o,"olddisplay"),n=o.style.display,t?(r[s]||"none"!==n||(o.style.display=""),""===o.style.display&&Ee(o)&&(r[s]=ie._data(o,"olddisplay",C(o.nodeName)))):(i=Ee(o),(n&&"none"!==n||!i)&&ie._data(o,"olddisplay",i?n:ie.css(o,"display"))));for(s=0;a>s;s++)o=e[s],o.style&&(t&&"none"!==o.style.display&&""!==o.style.display||(o.style.display=t?r[s]||"":"none"));return e}function I(e,t,n){var o=at.exec(t);return o?Math.max(0,o[1]-(n||0))+(o[2]||"px"):t}function P(e,t,n,o,i){for(var r=n===(o?"border":"content")?4:"width"===t?1:0,s=0;4>r;r+=2)"margin"===n&&(s+=ie.css(e,n+ke[r],!0,i)),o?("content"===n&&(s-=ie.css(e,"padding"+ke[r],!0,i)),"margin"!==n&&(s-=ie.css(e,"border"+ke[r]+"Width",!0,i))):(s+=ie.css(e,"padding"+ke[r],!0,i),"padding"!==n&&(s+=ie.css(e,"border"+ke[r]+"Width",!0,i)));return s}function F(e,t,n){var o=!0,i="width"===t?e.offsetWidth:e.offsetHeight,r=Ze(e),s=ne.boxSizing&&"border-box"===ie.css(e,"boxSizing",!1,r);if(0>=i||null==i){if(i=et(e,t,r),(0>i||null==i)&&(i=e.style[t]),nt.test(i))return i;o=s&&(ne.boxSizingReliable()||i===e.style[t]),i=parseFloat(i)||0}return i+P(e,t,n||(s?"border":"content"),o,r)+"px"}function A(e,t,n,o,i){return new A.prototype.init(e,t,n,o,i)}function R(){return setTimeout(function(){ht=void 0}),ht=ie.now()}function H(e,t){var n,o={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=ke[i],o["margin"+n]=o["padding"+n]=e;return t&&(o.opacity=o.width=e),o}function B(e,t,n){for(var o,i=(vt[t]||[]).concat(vt["*"]),r=0,s=i.length;s>r;r++)if(o=i[r].call(n,t,e))return o}function L(e,t,n){var o,i,r,s,a,l,c,u=this,d={},h=e.style,f=e.nodeType&&Ee(e),g=ie._data(e,"fxshow");n.queue||(a=ie._queueHooks(e,"fx"),null==a.unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,u.always(function(){u.always(function(){a.unqueued--,ie.queue(e,"fx").length||a.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],c=ie.css(e,"display"),"inline"===("none"===c?ie._data(e,"olddisplay")||C(e.nodeName):c)&&"none"===ie.css(e,"float")&&(ne.inlineBlockNeedsLayout&&"inline"!==C(e.nodeName)?h.zoom=1:h.display="inline-block")),n.overflow&&(h.overflow="hidden",ne.shrinkWrapBlocks()||u.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]}));for(o in t)if(i=t[o],gt.exec(i)){if(delete t[o],r=r||"toggle"===i,i===(f?"hide":"show")){if("show"!==i||!g||void 0===g[o])continue;f=!0}d[o]=g&&g[o]||ie.style(e,o)}else c=void 0;if(ie.isEmptyObject(d))"inline"===("none"===c?C(e.nodeName):c)&&(h.display=c);else{g?"hidden"in g&&(f=g.hidden):g=ie._data(e,"fxshow",{}),r&&(g.hidden=!f),f?ie(e).show():u.done(function(){ie(e).hide()}),u.done(function(){var t;ie._removeData(e,"fxshow");for(t in d)ie.style(e,t,d[t])});for(o in d)s=B(f?g[o]:0,o,u),o in g||(g[o]=s.start,f&&(s.end=s.start,s.start="width"===o||"height"===o?1:0))}}function M(e,t){var n,o,i,r,s;for(n in e)if(o=ie.camelCase(n),i=t[o],r=e[n],ie.isArray(r)&&(i=r[1],r=e[n]=r[0]),n!==o&&(e[o]=r,delete e[n]),(s=ie.cssHooks[o])&&"expand"in s){r=s.expand(r),delete e[o];for(n in r)n in e||(e[n]=r[n],t[n]=i)}else t[o]=i}function j(e,t,n){var o,i,r=0,s=Tt.length,a=ie.Deferred().always(function(){delete l.elem}),l=function(){if(i)return!1;for(var t=ht||R(),n=Math.max(0,c.startTime+c.duration-t),o=n/c.duration||0,r=1-o,s=0,l=c.tweens.length;l>s;s++)c.tweens[s].run(r);return a.notifyWith(e,[c,r,n]),1>r&&l?n:(a.resolveWith(e,[c]),!1)},c=a.promise({elem:e,props:ie.extend({},t),opts:ie.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:ht||R(),duration:n.duration,tweens:[],createTween:function(t,n){var o=ie.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(o),o},stop:function(t){var n=0,o=t?c.tweens.length:0;if(i)return this;for(i=!0;o>n;n++)c.tweens[n].run(1);return t?a.resolveWith(e,[c,t]):a.rejectWith(e,[c,t]),this}}),u=c.props;for(M(u,c.opts.specialEasing);s>r;r++)if(o=Tt[r].call(c,e,u,c.opts))return o;return ie.map(u,B,c),ie.isFunction(c.opts.start)&&c.opts.start.call(e,c),ie.fx.timer(ie.extend(l,{elem:e,anim:c,queue:c.opts.queue})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function D(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var o,i=0,r=t.toLowerCase().match(ve)||[];if(ie.isFunction(n))for(;o=r[i++];)"+"===o.charAt(0)?(o=o.slice(1)||"*",(e[o]=e[o]||[]).unshift(n)):(e[o]=e[o]||[]).push(n)}}function O(e,t,n,o){function i(a){var l;return r[a]=!0,ie.each(e[a]||[],function(e,a){var c=a(t,n,o);return"string"!=typeof c||s||r[c]?s?!(l=c):void 0:(t.dataTypes.unshift(c),i(c),!1)}),l}var r={},s=e===_t;return i(t.dataTypes[0])||!r["*"]&&i("*")}function U(e,t){var n,o,i=ie.ajaxSettings.flatOptions||{};for(o in t)void 0!==t[o]&&((i[o]?e:n||(n={}))[o]=t[o]);return n&&ie.extend(!0,e,n),e}function _(e,t,n){for(var o,i,r,s,a=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),void 0===i&&(i=e.mimeType||t.getResponseHeader("Content-Type"));if(i)for(s in a)if(a[s]&&a[s].test(i)){l.unshift(s);break}if(l[0]in n)r=l[0];else{for(s in n){if(!l[0]||e.converters[s+" "+l[0]]){r=s;break}o||(o=s)}r=r||o}return r?(r!==l[0]&&l.unshift(r),n[r]):void 0}function W(e,t,n,o){var i,r,s,a,l,c={},u=e.dataTypes.slice();if(u[1])for(s in e.converters)c[s.toLowerCase()]=e.converters[s];for(r=u.shift();r;)if(e.responseFields[r]&&(n[e.responseFields[r]]=t),!l&&o&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=r,r=u.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(!(s=c[l+" "+r]||c["* "+r]))for(i in c)if(a=i.split(" "),a[1]===r&&(s=c[l+" "+a[0]]||c["* "+a[0]])){!0===s?s=c[i]:!0!==c[i]&&(r=a[0],u.unshift(a[1]));break}if(!0!==s)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(e){return{state:"parsererror",error:s?e:"No conversion from "+l+" to "+r}}}return{state:"success",data:t}}function G(e,t,n,o){var i;if(ie.isArray(t))ie.each(t,function(t,i){n||zt.test(e)?o(e,i):G(e+"["+("object"==typeof i?t:"")+"]",i,n,o)});else if(n||"object"!==ie.type(t))o(e,t);else for(i in t)G(e+"["+i+"]",t[i],n,o)}function z(){try{return new e.XMLHttpRequest}catch(e){}}function J(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}function $(e){return ie.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}var q=[],X=q.slice,Y=q.concat,K=q.push,Q=q.indexOf,Z={},ee=Z.toString,te=Z.hasOwnProperty,ne={},oe="1.11.3",ie=function(e,t){return new ie.fn.init(e,t)},re=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,se=/^-ms-/,ae=/-([\da-z])/gi,le=function(e,t){return t.toUpperCase()};ie.fn=ie.prototype={jquery:oe,constructor:ie,selector:"",length:0,toArray:function(){return X.call(this)},get:function(e){return null!=e?0>e?this[e+this.length]:this[e]:X.call(this)},pushStack:function(e){var t=ie.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return ie.each(this,e,t)},map:function(e){return this.pushStack(ie.map(this,function(t,n){return e.call(t,n,t)}))},slice:function(){return this.pushStack(X.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:K,sort:q.sort,splice:q.splice},ie.extend=ie.fn.extend=function(){var e,t,n,o,i,r,s=arguments[0]||{},a=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[a]||{},a++),"object"==typeof s||ie.isFunction(s)||(s={}),a===l&&(s=this,a--);l>a;a++)if(null!=(i=arguments[a]))for(o in i)e=s[o],n=i[o],s!==n&&(c&&n&&(ie.isPlainObject(n)||(t=ie.isArray(n)))?(t?(t=!1,r=e&&ie.isArray(e)?e:[]):r=e&&ie.isPlainObject(e)?e:{},s[o]=ie.extend(c,r,n)):void 0!==n&&(s[o]=n));return s},ie.extend({expando:"jQuery"+(oe+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isFunction:function(e){return"function"===ie.type(e)},isArray:Array.isArray||function(e){return"array"===ie.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!ie.isArray(e)&&e-parseFloat(e)+1>=0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},isPlainObject:function(e){var t;if(!e||"object"!==ie.type(e)||e.nodeType||ie.isWindow(e))return!1;try{if(e.constructor&&!te.call(e,"constructor")&&!te.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}if(ne.ownLast)for(t in e)return te.call(e,t);for(t in e);return void 0===t||te.call(e,t)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?Z[ee.call(e)]||"object":typeof e},globalEval:function(t){t&&ie.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(se,"ms-").replace(ae,le)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,o){var i=0,r=e.length,s=n(e);if(o){if(s)for(;r>i&&!1!==t.apply(e[i],o);i++);else for(i in e)if(!1===t.apply(e[i],o))break}else if(s)for(;r>i&&!1!==t.call(e[i],i,e[i]);i++);else for(i in e)if(!1===t.call(e[i],i,e[i]))break;return e},trim:function(e){return null==e?"":(e+"").replace(re,"")},makeArray:function(e,t){var o=t||[];return null!=e&&(n(Object(e))?ie.merge(o,"string"==typeof e?[e]:e):K.call(o,e)),o},inArray:function(e,t,n){var o;if(t){if(Q)return Q.call(t,e,n);for(o=t.length,n=n?0>n?Math.max(0,o+n):n:0;o>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,t){for(var n=+t.length,o=0,i=e.length;n>o;)e[i++]=t[o++];if(n!==n)for(;void 0!==t[o];)e[i++]=t[o++];return e.length=i,e},grep:function(e,t,n){for(var o=[],i=0,r=e.length,s=!n;r>i;i++)!t(e[i],i)!==s&&o.push(e[i]);return o},map:function(e,t,o){var i,r=0,s=e.length,a=n(e),l=[];if(a)for(;s>r;r++)null!=(i=t(e[r],r,o))&&l.push(i);else for(r in e)null!=(i=t(e[r],r,o))&&l.push(i);return Y.apply([],l)},guid:1,proxy:function(e,t){var n,o,i;return"string"==typeof t&&(i=e[t],t=e,e=i),ie.isFunction(e)?(n=X.call(arguments,2),o=function(){return e.apply(t||this,n.concat(X.call(arguments)))},o.guid=e.guid=e.guid||ie.guid++,o):void 0},now:function(){return+new Date},support:ne}),ie.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Z["[object "+t+"]"]=t.toLowerCase()});var ce=function(e){function t(e,t,n,o){var i,r,s,a,l,c,d,f,g,p;if((t?t.ownerDocument||t:O)!==A&&F(t),t=t||A,n=n||[],a=t.nodeType,"string"!=typeof e||!e||1!==a&&9!==a&&11!==a)return n;if(!o&&H){if(11!==a&&(i=ve.exec(e)))if(s=i[1]){if(9===a){if(!(r=t.getElementById(s))||!r.parentNode)return n;if(r.id===s)return n.push(r),n}else if(t.ownerDocument&&(r=t.ownerDocument.getElementById(s))&&j(t,r)&&r.id===s)return n.push(r),n}else{if(i[2])return Q.apply(n,t.getElementsByTagName(e)),n;if((s=i[3])&&b.getElementsByClassName)return Q.apply(n,t.getElementsByClassName(s)),n}if(b.qsa&&(!B||!B.test(e))){if(f=d=D,g=t,p=1!==a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(c=C(e),(d=t.getAttribute("id"))?f=d.replace(ye,"\\$&"):t.setAttribute("id",f),f="[id='"+f+"'] ",l=c.length;l--;)c[l]=f+h(c[l]);g=Se.test(e)&&u(t.parentNode)||t,p=c.join(",")}if(p)try{return Q.apply(n,g.querySelectorAll(p)),n}catch(e){}finally{d||t.removeAttribute("id")}}}return E(e.replace(le,"$1"),t,n,o)}function n(){function e(n,o){return t.push(n+" ")>x.cacheLength&&delete e[t.shift()],e[n+" "]=o}var t=[];return e}function o(e){return e[D]=!0,e}function i(e){var t=A.createElement("div");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function r(e,t){for(var n=e.split("|"),o=e.length;o--;)x.attrHandle[n[o]]=t}function s(e,t){var n=t&&e,o=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||$)-(~e.sourceIndex||$);if(o)return o;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function a(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function l(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function c(e){return o(function(t){return t=+t,o(function(n,o){for(var i,r=e([],n.length,t),s=r.length;s--;)n[i=r[s]]&&(n[i]=!(o[i]=n[i]))})})}function u(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}function d(){}function h(e){for(var t=0,n=e.length,o="";n>t;t++)o+=e[t].value;return o}function f(e,t,n){var o=t.dir,i=n&&"parentNode"===o,r=_++;return t.first?function(t,n,r){for(;t=t[o];)if(1===t.nodeType||i)return e(t,n,r)}:function(t,n,s){var a,l,c=[U,r];if(s){for(;t=t[o];)if((1===t.nodeType||i)&&e(t,n,s))return!0}else for(;t=t[o];)if(1===t.nodeType||i){if(l=t[D]||(t[D]={}),(a=l[o])&&a[0]===U&&a[1]===r)return c[2]=a[2];if(l[o]=c,c[2]=e(t,n,s))return!0}}}function g(e){return e.length>1?function(t,n,o){for(var i=e.length;i--;)if(!e[i](t,n,o))return!1;return!0}:e[0]}function p(e,n,o){for(var i=0,r=n.length;r>i;i++)t(e,n[i],o);return o}function m(e,t,n,o,i){for(var r,s=[],a=0,l=e.length,c=null!=t;l>a;a++)(r=e[a])&&(!n||n(r,o,i))&&(s.push(r),c&&t.push(a));return s}function T(e,t,n,i,r,s){return i&&!i[D]&&(i=T(i)),r&&!r[D]&&(r=T(r,s)),o(function(o,s,a,l){var c,u,d,h=[],f=[],g=s.length,T=o||p(t||"*",a.nodeType?[a]:a,[]),v=!e||!o&&t?T:m(T,h,e,a,l),S=n?r||(o?e:g||i)?[]:s:v;if(n&&n(v,S,a,l),i)for(c=m(S,f),i(c,[],a,l),u=c.length;u--;)(d=c[u])&&(S[f[u]]=!(v[f[u]]=d));if(o){if(r||e){if(r){for(c=[],u=S.length;u--;)(d=S[u])&&c.push(v[u]=d);r(null,S=[],c,l)}for(u=S.length;u--;)(d=S[u])&&(c=r?ee(o,d):h[u])>-1&&(o[c]=!(s[c]=d))}}else S=m(S===s?S.splice(g,S.length):S),r?r(null,s,S,l):Q.apply(s,S)})}function v(e){for(var t,n,o,i=e.length,r=x.relative[e[0].type],s=r||x.relative[" "],a=r?1:0,l=f(function(e){return e===t},s,!0),c=f(function(e){return ee(t,e)>-1},s,!0),u=[function(e,n,o){var i=!r&&(o||n!==N)||((t=n).nodeType?l(e,n,o):c(e,n,o));return t=null,i}];i>a;a++)if(n=x.relative[e[a].type])u=[f(g(u),n)];else{if(n=x.filter[e[a].type].apply(null,e[a].matches),n[D]){for(o=++a;i>o&&!x.relative[e[o].type];o++);return T(a>1&&g(u),a>1&&h(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(le,"$1"),n,o>a&&v(e.slice(a,o)),i>o&&v(e=e.slice(o)),i>o&&h(e))}u.push(n)}return g(u)}function S(e,n){var i=n.length>0,r=e.length>0,s=function(o,s,a,l,c){var u,d,h,f=0,g="0",p=o&&[],T=[],v=N,S=o||r&&x.find.TAG("*",c),y=U+=null==v?1:Math.random()||.1,b=S.length;for(c&&(N=s!==A&&s);g!==b&&null!=(u=S[g]);g++){if(r&&u){for(d=0;h=e[d++];)if(h(u,s,a)){l.push(u);break}c&&(U=y)}i&&((u=!h&&u)&&f--,o&&p.push(u))}if(f+=g,i&&g!==f){for(d=0;h=n[d++];)h(p,T,s,a);if(o){if(f>0)for(;g--;)p[g]||T[g]||(T[g]=Y.call(l));T=m(T)}Q.apply(l,T),c&&!o&&T.length>0&&f+n.length>1&&t.uniqueSort(l)}return c&&(U=y,N=v),p};return i?o(s):s}var y,b,x,V,w,C,k,E,N,I,P,F,A,R,H,B,L,M,j,D="sizzle"+1*new Date,O=e.document,U=0,_=0,W=n(),G=n(),z=n(),J=function(e,t){return e===t&&(P=!0),0},$=1<<31,q={}.hasOwnProperty,X=[],Y=X.pop,K=X.push,Q=X.push,Z=X.slice,ee=function(e,t){for(var n=0,o=e.length;o>n;n++)if(e[n]===t)return n;return-1},te="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",ne="[\\x20\\t\\r\\n\\f]",oe="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",ie=oe.replace("w","w#"),re="\\["+ne+"*("+oe+")(?:"+ne+"*([*^$|!~]?=)"+ne+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+ie+"))|)"+ne+"*\\]",se=":("+oe+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+re+")*)|.*)\\)|)",ae=new RegExp(ne+"+","g"),le=new RegExp("^"+ne+"+|((?:^|[^\\\\])(?:\\\\.)*)"+ne+"+$","g"),ce=new RegExp("^"+ne+"*,"+ne+"*"),ue=new RegExp("^"+ne+"*([>+~]|"+ne+")"+ne+"*"),de=new RegExp("="+ne+"*([^\\]'\"]*?)"+ne+"*\\]","g"),he=new RegExp(se),fe=new RegExp("^"+ie+"$"),ge={ID:new RegExp("^#("+oe+")"),CLASS:new RegExp("^\\.("+oe+")"),TAG:new RegExp("^("+oe.replace("w","w*")+")"),ATTR:new RegExp("^"+re),PSEUDO:new RegExp("^"+se),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+ne+"*(even|odd|(([+-]|)(\\d*)n|)"+ne+"*(?:([+-]|)"+ne+"*(\\d+)|))"+ne+"*\\)|)","i"),bool:new RegExp("^(?:"+te+")$","i"),needsContext:new RegExp("^"+ne+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+ne+"*((?:-\\d)?\\d*)"+ne+"*\\)|)(?=[^-]|$)","i")},pe=/^(?:input|select|textarea|button)$/i,me=/^h\d$/i,Te=/^[^{]+\{\s*\[native \w/,ve=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Se=/[+~]/,ye=/'|\\/g,be=new RegExp("\\\\([\\da-f]{1,6}"+ne+"?|("+ne+")|.)","ig"),xe=function(e,t,n){var o="0x"+t-65536;return o!==o||n?t:0>o?String.fromCharCode(o+65536):String.fromCharCode(o>>10|55296,1023&o|56320)},Ve=function(){F()};try{Q.apply(X=Z.call(O.childNodes),O.childNodes),X[O.childNodes.length].nodeType}catch(e){Q={apply:X.length?function(e,t){K.apply(e,Z.call(t))}:function(e,t){for(var n=e.length,o=0;e[n++]=t[o++];);e.length=n-1}}}b=t.support={},w=t.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},F=t.setDocument=function(e){var t,n,o=e?e.ownerDocument||e:O;return o!==A&&9===o.nodeType&&o.documentElement?(A=o,R=o.documentElement,n=o.defaultView,n&&n!==n.top&&(n.addEventListener?n.addEventListener("unload",Ve,!1):n.attachEvent&&n.attachEvent("onunload",Ve)),H=!w(o),b.attributes=i(function(e){return e.className="i",!e.getAttribute("className")}),b.getElementsByTagName=i(function(e){return e.appendChild(o.createComment("")),!e.getElementsByTagName("*").length}),b.getElementsByClassName=Te.test(o.getElementsByClassName),b.getById=i(function(e){return R.appendChild(e).id=D,!o.getElementsByName||!o.getElementsByName(D).length}),b.getById?(x.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&H){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},x.filter.ID=function(e){var t=e.replace(be,xe);return function(e){return e.getAttribute("id")===t}}):(delete x.find.ID,x.filter.ID=function(e){var t=e.replace(be,xe);return function(e){var n="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return n&&n.value===t}}),x.find.TAG=b.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):b.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,o=[],i=0,r=t.getElementsByTagName(e);if("*"===e){for(;n=r[i++];)1===n.nodeType&&o.push(n);return o}return r},x.find.CLASS=b.getElementsByClassName&&function(e,t){return H?t.getElementsByClassName(e):void 0},L=[],B=[],(b.qsa=Te.test(o.querySelectorAll))&&(i(function(e){R.appendChild(e).innerHTML="<a id='"+D+"'></a><select id='"+D+"-\f]' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&B.push("[*^$]="+ne+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||B.push("\\["+ne+"*(?:value|"+te+")"),e.querySelectorAll("[id~="+D+"-]").length||B.push("~="),e.querySelectorAll(":checked").length||B.push(":checked"),e.querySelectorAll("a#"+D+"+*").length||B.push(".#.+[+~]")}),i(function(e){var t=o.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&B.push("name"+ne+"*[*^$|!~]?="),e.querySelectorAll(":enabled").length||B.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),B.push(",.*:")})),(b.matchesSelector=Te.test(M=R.matches||R.webkitMatchesSelector||R.mozMatchesSelector||R.oMatchesSelector||R.msMatchesSelector))&&i(function(e){b.disconnectedMatch=M.call(e,"div"),M.call(e,"[s!='']:x"),L.push("!=",se)}),B=B.length&&new RegExp(B.join("|")),L=L.length&&new RegExp(L.join("|")),t=Te.test(R.compareDocumentPosition),j=t||Te.test(R.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,o=t&&t.parentNode;return e===o||!(!o||1!==o.nodeType||!(n.contains?n.contains(o):e.compareDocumentPosition&&16&e.compareDocumentPosition(o)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},J=t?function(e,t){if(e===t)return P=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1,1&n||!b.sortDetached&&t.compareDocumentPosition(e)===n?e===o||e.ownerDocument===O&&j(O,e)?-1:t===o||t.ownerDocument===O&&j(O,t)?1:I?ee(I,e)-ee(I,t):0:4&n?-1:1)}:function(e,t){if(e===t)return P=!0,0;var n,i=0,r=e.parentNode,a=t.parentNode,l=[e],c=[t];if(!r||!a)return e===o?-1:t===o?1:r?-1:a?1:I?ee(I,e)-ee(I,t):0;if(r===a)return s(e,t);for(n=e;n=n.parentNode;)l.unshift(n);for(n=t;n=n.parentNode;)c.unshift(n);for(;l[i]===c[i];)i++;return i?s(l[i],c[i]):l[i]===O?-1:c[i]===O?1:0},o):A},t.matches=function(e,n){return t(e,null,null,n)},t.matchesSelector=function(e,n){if((e.ownerDocument||e)!==A&&F(e),n=n.replace(de,"='$1']"),!(!b.matchesSelector||!H||L&&L.test(n)||B&&B.test(n)))try{var o=M.call(e,n);if(o||b.disconnectedMatch||e.document&&11!==e.document.nodeType)return o}catch(e){}return t(n,A,null,[e]).length>0},t.contains=function(e,t){return(e.ownerDocument||e)!==A&&F(e),j(e,t)},t.attr=function(e,t){(e.ownerDocument||e)!==A&&F(e);var n=x.attrHandle[t.toLowerCase()],o=n&&q.call(x.attrHandle,t.toLowerCase())?n(e,t,!H):void 0;return void 0!==o?o:b.attributes||!H?e.getAttribute(t):(o=e.getAttributeNode(t))&&o.specified?o.value:null},t.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},t.uniqueSort=function(e){var t,n=[],o=0,i=0;if(P=!b.detectDuplicates,I=!b.sortStable&&e.slice(0),e.sort(J),P){for(;t=e[i++];)t===e[i]&&(o=n.push(i));for(;o--;)e.splice(n[o],1)}return I=null,e},V=t.getText=function(e){var t,n="",o=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=V(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[o++];)n+=V(t);return n},x=t.selectors={cacheLength:50,createPseudo:o,match:ge,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(be,xe),e[3]=(e[3]||e[4]||e[5]||"").replace(be,xe),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||t.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&t.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return ge.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&he.test(n)&&(t=C(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(be,xe).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=W[e+" "];return t||(t=new RegExp("(^|"+ne+")"+e+"("+ne+"|$)"))&&W(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(e,n,o){return function(i){var r=t.attr(i,e);return null==r?"!="===n:!n||(r+="","="===n?r===o:"!="===n?r!==o:"^="===n?o&&0===r.indexOf(o):"*="===n?o&&r.indexOf(o)>-1:"$="===n?o&&r.slice(-o.length)===o:"~="===n?(" "+r.replace(ae," ")+" ").indexOf(o)>-1:"|="===n&&(r===o||r.slice(0,o.length+1)===o+"-"))}},CHILD:function(e,t,n,o,i){var r="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===o&&0===i?function(e){return!!e.parentNode}:function(t,n,l){var c,u,d,h,f,g,p=r!==s?"nextSibling":"previousSibling",m=t.parentNode,T=a&&t.nodeName.toLowerCase(),v=!l&&!a;if(m){if(r){for(;p;){for(d=t;d=d[p];)if(a?d.nodeName.toLowerCase()===T:1===d.nodeType)return!1;g=p="only"===e&&!g&&"nextSibling"}return!0}if(g=[s?m.firstChild:m.lastChild],s&&v){for(u=m[D]||(m[D]={}),c=u[e]||[],f=c[0]===U&&c[1],h=c[0]===U&&c[2],d=f&&m.childNodes[f];d=++f&&d&&d[p]||(h=f=0)||g.pop();)if(1===d.nodeType&&++h&&d===t){u[e]=[U,f,h];break}}else if(v&&(c=(t[D]||(t[D]={}))[e])&&c[0]===U)h=c[1];else for(;(d=++f&&d&&d[p]||(h=f=0)||g.pop())&&((a?d.nodeName.toLowerCase()!==T:1!==d.nodeType)||!++h||(v&&((d[D]||(d[D]={}))[e]=[U,h]),d!==t)););return(h-=i)===o||h%o==0&&h/o>=0}}},PSEUDO:function(e,n){var i,r=x.pseudos[e]||x.setFilters[e.toLowerCase()]||t.error("unsupported pseudo: "+e);return r[D]?r(n):r.length>1?(i=[e,e,"",n],x.setFilters.hasOwnProperty(e.toLowerCase())?o(function(e,t){for(var o,i=r(e,n),s=i.length;s--;)o=ee(e,i[s]),e[o]=!(t[o]=i[s])}):function(e){return r(e,0,i)}):r}},pseudos:{not:o(function(e){var t=[],n=[],i=k(e.replace(le,"$1"));return i[D]?o(function(e,t,n,o){for(var r,s=i(e,null,o,[]),a=e.length;a--;)(r=s[a])&&(e[a]=!(t[a]=r))}):function(e,o,r){return t[0]=e,i(t,null,r,n),t[0]=null,!n.pop()}}),has:o(function(e){return function(n){return t(e,n).length>0}}),contains:o(function(e){return e=e.replace(be,xe),function(t){return(t.textContent||t.innerText||V(t)).indexOf(e)>-1}}),lang:o(function(e){return fe.test(e||"")||t.error("unsupported lang: "+e),e=e.replace(be,xe).toLowerCase(),function(t){var n;do{if(n=H?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return(n=n.toLowerCase())===e||0===n.indexOf(e+"-")}while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===R},focus:function(e){return e===A.activeElement&&(!A.hasFocus||A.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!x.pseudos.empty(e)},header:function(e){return me.test(e.nodeName)},input:function(e){return pe.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,n){return[0>n?n+t:n]}),even:c(function(e,t){for(var n=0;t>n;n+=2)e.push(n);return e}),odd:c(function(e,t){for(var n=1;t>n;n+=2)e.push(n);return e}),lt:c(function(e,t,n){for(var o=0>n?n+t:n;--o>=0;)e.push(o);return e}),gt:c(function(e,t,n){for(var o=0>n?n+t:n;++o<t;)e.push(o);return e})}},x.pseudos.nth=x.pseudos.eq;for(y in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})x.pseudos[y]=a(y);for(y in{submit:!0,reset:!0})x.pseudos[y]=l(y);return d.prototype=x.filters=x.pseudos,x.setFilters=new d,C=t.tokenize=function(e,n){var o,i,r,s,a,l,c,u=G[e+" "];if(u)return n?0:u.slice(0);for(a=e,l=[],c=x.preFilter;a;){(!o||(i=ce.exec(a)))&&(i&&(a=a.slice(i[0].length)||a),l.push(r=[])),o=!1,(i=ue.exec(a))&&(o=i.shift(),r.push({value:o,type:i[0].replace(le," ")}),a=a.slice(o.length));for(s in x.filter)!(i=ge[s].exec(a))||c[s]&&!(i=c[s](i))||(o=i.shift(),r.push({value:o,type:s,matches:i}),a=a.slice(o.length));if(!o)break}return n?a.length:a?t.error(e):G(e,l).slice(0)},k=t.compile=function(e,t){var n,o=[],i=[],r=z[e+" "];if(!r){for(t||(t=C(e)),n=t.length;n--;)r=v(t[n]),r[D]?o.push(r):i.push(r);r=z(e,S(i,o)),r.selector=e}return r},E=t.select=function(e,t,n,o){var i,r,s,a,l,c="function"==typeof e&&e,d=!o&&C(e=c.selector||e);if(n=n||[],1===d.length){if(r=d[0]=d[0].slice(0),r.length>2&&"ID"===(s=r[0]).type&&b.getById&&9===t.nodeType&&H&&x.relative[r[1].type]){if(!(t=(x.find.ID(s.matches[0].replace(be,xe),t)||[])[0]))return n;c&&(t=t.parentNode),e=e.slice(r.shift().value.length)}for(i=ge.needsContext.test(e)?0:r.length;i--&&(s=r[i],
!x.relative[a=s.type]);)if((l=x.find[a])&&(o=l(s.matches[0].replace(be,xe),Se.test(r[0].type)&&u(t.parentNode)||t))){if(r.splice(i,1),!(e=o.length&&h(r)))return Q.apply(n,o),n;break}}return(c||k(e,d))(o,t,!H,n,Se.test(e)&&u(t.parentNode)||t),n},b.sortStable=D.split("").sort(J).join("")===D,b.detectDuplicates=!!P,F(),b.sortDetached=i(function(e){return 1&e.compareDocumentPosition(A.createElement("div"))}),i(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||r("type|href|height|width",function(e,t,n){return n?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),b.attributes&&i(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||r("value",function(e,t,n){return n||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),i(function(e){return null==e.getAttribute("disabled")})||r(te,function(e,t,n){var o;return n?void 0:!0===e[t]?t.toLowerCase():(o=e.getAttributeNode(t))&&o.specified?o.value:null}),t}(e);ie.find=ce,ie.expr=ce.selectors,ie.expr[":"]=ie.expr.pseudos,ie.unique=ce.uniqueSort,ie.text=ce.getText,ie.isXMLDoc=ce.isXML,ie.contains=ce.contains;var ue=ie.expr.match.needsContext,de=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,he=/^.[^:#\[\.,]*$/;ie.filter=function(e,t,n){var o=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===o.nodeType?ie.find.matchesSelector(o,e)?[o]:[]:ie.find.matches(e,ie.grep(t,function(e){return 1===e.nodeType}))},ie.fn.extend({find:function(e){var t,n=[],o=this,i=o.length;if("string"!=typeof e)return this.pushStack(ie(e).filter(function(){for(t=0;i>t;t++)if(ie.contains(o[t],this))return!0}));for(t=0;i>t;t++)ie.find(e,o[t],n);return n=this.pushStack(i>1?ie.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},filter:function(e){return this.pushStack(o(this,e||[],!1))},not:function(e){return this.pushStack(o(this,e||[],!0))},is:function(e){return!!o(this,"string"==typeof e&&ue.test(e)?ie(e):e||[],!1).length}});var fe,ge=e.document,pe=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(ie.fn.init=function(e,t){var n,o;if(!e)return this;if("string"==typeof e){if(!(n="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:pe.exec(e))||!n[1]&&t)return!t||t.jquery?(t||fe).find(e):this.constructor(t).find(e);if(n[1]){if(t=t instanceof ie?t[0]:t,ie.merge(this,ie.parseHTML(n[1],t&&t.nodeType?t.ownerDocument||t:ge,!0)),de.test(n[1])&&ie.isPlainObject(t))for(n in t)ie.isFunction(this[n])?this[n](t[n]):this.attr(n,t[n]);return this}if((o=ge.getElementById(n[2]))&&o.parentNode){if(o.id!==n[2])return fe.find(e);this.length=1,this[0]=o}return this.context=ge,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):ie.isFunction(e)?"undefined"!=typeof fe.ready?fe.ready(e):e(ie):(void 0!==e.selector&&(this.selector=e.selector,this.context=e.context),ie.makeArray(e,this))}).prototype=ie.fn,fe=ie(ge);var me=/^(?:parents|prev(?:Until|All))/,Te={children:!0,contents:!0,next:!0,prev:!0};ie.extend({dir:function(e,t,n){for(var o=[],i=e[t];i&&9!==i.nodeType&&(void 0===n||1!==i.nodeType||!ie(i).is(n));)1===i.nodeType&&o.push(i),i=i[t];return o},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}}),ie.fn.extend({has:function(e){var t,n=ie(e,this),o=n.length;return this.filter(function(){for(t=0;o>t;t++)if(ie.contains(this,n[t]))return!0})},closest:function(e,t){for(var n,o=0,i=this.length,r=[],s=ue.test(e)||"string"!=typeof e?ie(e,t||this.context):0;i>o;o++)for(n=this[o];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(s?s.index(n)>-1:1===n.nodeType&&ie.find.matchesSelector(n,e))){r.push(n);break}return this.pushStack(r.length>1?ie.unique(r):r)},index:function(e){return e?"string"==typeof e?ie.inArray(this[0],ie(e)):ie.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(ie.unique(ie.merge(this.get(),ie(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ie.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ie.dir(e,"parentNode")},parentsUntil:function(e,t,n){return ie.dir(e,"parentNode",n)},next:function(e){return i(e,"nextSibling")},prev:function(e){return i(e,"previousSibling")},nextAll:function(e){return ie.dir(e,"nextSibling")},prevAll:function(e){return ie.dir(e,"previousSibling")},nextUntil:function(e,t,n){return ie.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return ie.dir(e,"previousSibling",n)},siblings:function(e){return ie.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return ie.sibling(e.firstChild)},contents:function(e){return ie.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:ie.merge([],e.childNodes)}},function(e,t){ie.fn[e]=function(n,o){var i=ie.map(this,t,n);return"Until"!==e.slice(-5)&&(o=n),o&&"string"==typeof o&&(i=ie.filter(o,i)),this.length>1&&(Te[e]||(i=ie.unique(i)),me.test(e)&&(i=i.reverse())),this.pushStack(i)}});var ve=/\S+/g,Se={};ie.Callbacks=function(e){e="string"==typeof e?Se[e]||r(e):ie.extend({},e);var t,n,o,i,s,a,l=[],c=!e.once&&[],u=function(r){for(n=e.memory&&r,o=!0,s=a||0,a=0,i=l.length,t=!0;l&&i>s;s++)if(!1===l[s].apply(r[0],r[1])&&e.stopOnFalse){n=!1;break}t=!1,l&&(c?c.length&&u(c.shift()):n?l=[]:d.disable())},d={add:function(){if(l){var o=l.length;!function t(n){ie.each(n,function(n,o){var i=ie.type(o);"function"===i?e.unique&&d.has(o)||l.push(o):o&&o.length&&"string"!==i&&t(o)})}(arguments),t?i=l.length:n&&(a=o,u(n))}return this},remove:function(){return l&&ie.each(arguments,function(e,n){for(var o;(o=ie.inArray(n,l,o))>-1;)l.splice(o,1),t&&(i>=o&&i--,s>=o&&s--)}),this},has:function(e){return e?ie.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],i=0,this},disable:function(){return l=c=n=void 0,this},disabled:function(){return!l},lock:function(){return c=void 0,n||d.disable(),this},locked:function(){return!c},fireWith:function(e,n){return!l||o&&!c||(n=n||[],n=[e,n.slice?n.slice():n],t?c.push(n):u(n)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!o}};return d},ie.extend({Deferred:function(e){var t=[["resolve","done",ie.Callbacks("once memory"),"resolved"],["reject","fail",ie.Callbacks("once memory"),"rejected"],["notify","progress",ie.Callbacks("memory")]],n="pending",o={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return ie.Deferred(function(n){ie.each(t,function(t,r){var s=ie.isFunction(e[t])&&e[t];i[r[1]](function(){var e=s&&s.apply(this,arguments);e&&ie.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[r[0]+"With"](this===o?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?ie.extend(e,o):o}},i={};return o.pipe=o.then,ie.each(t,function(e,r){var s=r[2],a=r[3];o[r[1]]=s.add,a&&s.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),i[r[0]]=function(){return i[r[0]+"With"](this===i?o:this,arguments),this},i[r[0]+"With"]=s.fireWith}),o.promise(i),e&&e.call(i,i),i},when:function(e){var t,n,o,i=0,r=X.call(arguments),s=r.length,a=1!==s||e&&ie.isFunction(e.promise)?s:0,l=1===a?e:ie.Deferred(),c=function(e,n,o){return function(i){n[e]=this,o[e]=arguments.length>1?X.call(arguments):i,o===t?l.notifyWith(n,o):--a||l.resolveWith(n,o)}};if(s>1)for(t=new Array(s),n=new Array(s),o=new Array(s);s>i;i++)r[i]&&ie.isFunction(r[i].promise)?r[i].promise().done(c(i,o,r)).fail(l.reject).progress(c(i,n,t)):--a;return a||l.resolveWith(o,r),l.promise()}});var ye;ie.fn.ready=function(e){return ie.ready.promise().done(e),this},ie.extend({isReady:!1,readyWait:1,holdReady:function(e){e?ie.readyWait++:ie.ready(!0)},ready:function(e){if(!0===e?!--ie.readyWait:!ie.isReady){if(!ge.body)return setTimeout(ie.ready);ie.isReady=!0,!0!==e&&--ie.readyWait>0||(ye.resolveWith(ge,[ie]),ie.fn.triggerHandler&&(ie(ge).triggerHandler("ready"),ie(ge).off("ready")))}}}),ie.ready.promise=function(t){if(!ye)if(ye=ie.Deferred(),"complete"===ge.readyState)setTimeout(ie.ready);else if(ge.addEventListener)ge.addEventListener("DOMContentLoaded",a,!1),e.addEventListener("load",a,!1);else{ge.attachEvent("onreadystatechange",a),e.attachEvent("onload",a);var n=!1;try{n=null==e.frameElement&&ge.documentElement}catch(e){}n&&n.doScroll&&function e(){if(!ie.isReady){try{n.doScroll("left")}catch(t){return setTimeout(e,50)}s(),ie.ready()}}()}return ye.promise(t)};var be,xe="undefined";for(be in ie(ne))break;ne.ownLast="0"!==be,ne.inlineBlockNeedsLayout=!1,ie(function(){var e,t,n,o;(n=ge.getElementsByTagName("body")[0])&&n.style&&(t=ge.createElement("div"),o=ge.createElement("div"),o.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(o).appendChild(t),typeof t.style.zoom!==xe&&(t.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",ne.inlineBlockNeedsLayout=e=3===t.offsetWidth,e&&(n.style.zoom=1)),n.removeChild(o))}),function(){var e=ge.createElement("div");if(null==ne.deleteExpando){ne.deleteExpando=!0;try{delete e.test}catch(e){ne.deleteExpando=!1}}e=null}(),ie.acceptData=function(e){var t=ie.noData[(e.nodeName+" ").toLowerCase()],n=+e.nodeType||1;return(1===n||9===n)&&(!t||!0!==t&&e.getAttribute("classid")===t)};var Ve=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,we=/([A-Z])/g;ie.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return!!(e=e.nodeType?ie.cache[e[ie.expando]]:e[ie.expando])&&!c(e)},data:function(e,t,n){return u(e,t,n)},removeData:function(e,t){return d(e,t)},_data:function(e,t,n){return u(e,t,n,!0)},_removeData:function(e,t){return d(e,t,!0)}}),ie.fn.extend({data:function(e,t){var n,o,i,r=this[0],s=r&&r.attributes;if(void 0===e){if(this.length&&(i=ie.data(r),1===r.nodeType&&!ie._data(r,"parsedAttrs"))){for(n=s.length;n--;)s[n]&&(o=s[n].name,0===o.indexOf("data-")&&(o=ie.camelCase(o.slice(5)),l(r,o,i[o])));ie._data(r,"parsedAttrs",!0)}return i}return"object"==typeof e?this.each(function(){ie.data(this,e)}):arguments.length>1?this.each(function(){ie.data(this,e,t)}):r?l(r,e,ie.data(r,e)):void 0},removeData:function(e){return this.each(function(){ie.removeData(this,e)})}}),ie.extend({queue:function(e,t,n){var o;return e?(t=(t||"fx")+"queue",o=ie._data(e,t),n&&(!o||ie.isArray(n)?o=ie._data(e,t,ie.makeArray(n)):o.push(n)),o||[]):void 0},dequeue:function(e,t){t=t||"fx";var n=ie.queue(e,t),o=n.length,i=n.shift(),r=ie._queueHooks(e,t),s=function(){ie.dequeue(e,t)};"inprogress"===i&&(i=n.shift(),o--),i&&("fx"===t&&n.unshift("inprogress"),delete r.stop,i.call(e,s,r)),!o&&r&&r.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return ie._data(e,n)||ie._data(e,n,{empty:ie.Callbacks("once memory").add(function(){ie._removeData(e,t+"queue"),ie._removeData(e,n)})})}}),ie.fn.extend({queue:function(e,t){var n=2;return"string"!=typeof e&&(t=e,e="fx",n--),arguments.length<n?ie.queue(this[0],e):void 0===t?this:this.each(function(){var n=ie.queue(this,e,t);ie._queueHooks(this,e),"fx"===e&&"inprogress"!==n[0]&&ie.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ie.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,o=1,i=ie.Deferred(),r=this,s=this.length,a=function(){--o||i.resolveWith(r,[r])};for("string"!=typeof e&&(t=e,e=void 0),e=e||"fx";s--;)(n=ie._data(r[s],e+"queueHooks"))&&n.empty&&(o++,n.empty.add(a));return a(),i.promise(t)}});var Ce=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ke=["Top","Right","Bottom","Left"],Ee=function(e,t){return e=t||e,"none"===ie.css(e,"display")||!ie.contains(e.ownerDocument,e)},Ne=ie.access=function(e,t,n,o,i,r,s){var a=0,l=e.length,c=null==n;if("object"===ie.type(n)){i=!0;for(a in n)ie.access(e,t,a,n[a],!0,r,s)}else if(void 0!==o&&(i=!0,ie.isFunction(o)||(s=!0),c&&(s?(t.call(e,o),t=null):(c=t,t=function(e,t,n){return c.call(ie(e),n)})),t))for(;l>a;a++)t(e[a],n,s?o:o.call(e[a],a,t(e[a],n)));return i?e:c?t.call(e):l?t(e[0],n):r},Ie=/^(?:checkbox|radio)$/i;!function(){var e=ge.createElement("input"),t=ge.createElement("div"),n=ge.createDocumentFragment();if(t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",ne.leadingWhitespace=3===t.firstChild.nodeType,ne.tbody=!t.getElementsByTagName("tbody").length,ne.htmlSerialize=!!t.getElementsByTagName("link").length,ne.html5Clone="<:nav></:nav>"!==ge.createElement("nav").cloneNode(!0).outerHTML,e.type="checkbox",e.checked=!0,n.appendChild(e),ne.appendChecked=e.checked,t.innerHTML="<textarea>x</textarea>",ne.noCloneChecked=!!t.cloneNode(!0).lastChild.defaultValue,n.appendChild(t),t.innerHTML="<input type='radio' checked='checked' name='t'/>",ne.checkClone=t.cloneNode(!0).cloneNode(!0).lastChild.checked,ne.noCloneEvent=!0,t.attachEvent&&(t.attachEvent("onclick",function(){ne.noCloneEvent=!1}),t.cloneNode(!0).click()),null==ne.deleteExpando){ne.deleteExpando=!0;try{delete t.test}catch(e){ne.deleteExpando=!1}}}(),function(){var t,n,o=ge.createElement("div");for(t in{submit:!0,change:!0,focusin:!0})n="on"+t,(ne[t+"Bubbles"]=n in e)||(o.setAttribute(n,"t"),ne[t+"Bubbles"]=!1===o.attributes[n].expando);o=null}();var Pe=/^(?:input|select|textarea)$/i,Fe=/^key/,Ae=/^(?:mouse|pointer|contextmenu)|click/,Re=/^(?:focusinfocus|focusoutblur)$/,He=/^([^.]*)(?:\.(.+)|)$/;ie.event={global:{},add:function(e,t,n,o,i){var r,s,a,l,c,u,d,h,f,g,p,m=ie._data(e);if(m){for(n.handler&&(l=n,n=l.handler,i=l.selector),n.guid||(n.guid=ie.guid++),(s=m.events)||(s=m.events={}),(u=m.handle)||(u=m.handle=function(e){return typeof ie===xe||e&&ie.event.triggered===e.type?void 0:ie.event.dispatch.apply(u.elem,arguments)},u.elem=e),t=(t||"").match(ve)||[""],a=t.length;a--;)r=He.exec(t[a])||[],f=p=r[1],g=(r[2]||"").split(".").sort(),f&&(c=ie.event.special[f]||{},f=(i?c.delegateType:c.bindType)||f,c=ie.event.special[f]||{},d=ie.extend({type:f,origType:p,data:o,handler:n,guid:n.guid,selector:i,needsContext:i&&ie.expr.match.needsContext.test(i),namespace:g.join(".")},l),(h=s[f])||(h=s[f]=[],h.delegateCount=0,c.setup&&!1!==c.setup.call(e,o,g,u)||(e.addEventListener?e.addEventListener(f,u,!1):e.attachEvent&&e.attachEvent("on"+f,u))),c.add&&(c.add.call(e,d),d.handler.guid||(d.handler.guid=n.guid)),i?h.splice(h.delegateCount++,0,d):h.push(d),ie.event.global[f]=!0);e=null}},remove:function(e,t,n,o,i){var r,s,a,l,c,u,d,h,f,g,p,m=ie.hasData(e)&&ie._data(e);if(m&&(u=m.events)){for(t=(t||"").match(ve)||[""],c=t.length;c--;)if(a=He.exec(t[c])||[],f=p=a[1],g=(a[2]||"").split(".").sort(),f){for(d=ie.event.special[f]||{},f=(o?d.delegateType:d.bindType)||f,h=u[f]||[],a=a[2]&&new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"),l=r=h.length;r--;)s=h[r],!i&&p!==s.origType||n&&n.guid!==s.guid||a&&!a.test(s.namespace)||o&&o!==s.selector&&("**"!==o||!s.selector)||(h.splice(r,1),s.selector&&h.delegateCount--,d.remove&&d.remove.call(e,s));l&&!h.length&&(d.teardown&&!1!==d.teardown.call(e,g,m.handle)||ie.removeEvent(e,f,m.handle),delete u[f])}else for(f in u)ie.event.remove(e,f+t[c],n,o,!0);ie.isEmptyObject(u)&&(delete m.handle,ie._removeData(e,"events"))}},trigger:function(t,n,o,i){var r,s,a,l,c,u,d,h=[o||ge],f=te.call(t,"type")?t.type:t,g=te.call(t,"namespace")?t.namespace.split("."):[];if(a=u=o=o||ge,3!==o.nodeType&&8!==o.nodeType&&!Re.test(f+ie.event.triggered)&&(f.indexOf(".")>=0&&(g=f.split("."),f=g.shift(),g.sort()),s=f.indexOf(":")<0&&"on"+f,t=t[ie.expando]?t:new ie.Event(f,"object"==typeof t&&t),t.isTrigger=i?2:3,t.namespace=g.join("."),t.namespace_re=t.namespace?new RegExp("(^|\\.)"+g.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=void 0,t.target||(t.target=o),n=null==n?[t]:ie.makeArray(n,[t]),c=ie.event.special[f]||{},i||!c.trigger||!1!==c.trigger.apply(o,n))){if(!i&&!c.noBubble&&!ie.isWindow(o)){for(l=c.delegateType||f,Re.test(l+f)||(a=a.parentNode);a;a=a.parentNode)h.push(a),u=a;u===(o.ownerDocument||ge)&&h.push(u.defaultView||u.parentWindow||e)}for(d=0;(a=h[d++])&&!t.isPropagationStopped();)t.type=d>1?l:c.bindType||f,r=(ie._data(a,"events")||{})[t.type]&&ie._data(a,"handle"),r&&r.apply(a,n),(r=s&&a[s])&&r.apply&&ie.acceptData(a)&&(t.result=r.apply(a,n),!1===t.result&&t.preventDefault());if(t.type=f,!i&&!t.isDefaultPrevented()&&(!c._default||!1===c._default.apply(h.pop(),n))&&ie.acceptData(o)&&s&&o[f]&&!ie.isWindow(o)){u=o[s],u&&(o[s]=null),ie.event.triggered=f;try{o[f]()}catch(e){}ie.event.triggered=void 0,u&&(o[s]=u)}return t.result}},dispatch:function(e){e=ie.event.fix(e);var t,n,o,i,r,s=[],a=X.call(arguments),l=(ie._data(this,"events")||{})[e.type]||[],c=ie.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,e)){for(s=ie.event.handlers.call(this,e,l),t=0;(i=s[t++])&&!e.isPropagationStopped();)for(e.currentTarget=i.elem,r=0;(o=i.handlers[r++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(o.namespace))&&(e.handleObj=o,e.data=o.data,void 0!==(n=((ie.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,a))&&!1===(e.result=n)&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,t){var n,o,i,r,s=[],a=t.delegateCount,l=e.target;if(a&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!=this;l=l.parentNode||this)if(1===l.nodeType&&(!0!==l.disabled||"click"!==e.type)){for(i=[],r=0;a>r;r++)o=t[r],n=o.selector+" ",void 0===i[n]&&(i[n]=o.needsContext?ie(n,this).index(l)>=0:ie.find(n,this,null,[l]).length),i[n]&&i.push(o);i.length&&s.push({elem:l,handlers:i})}return a<t.length&&s.push({elem:this,handlers:t.slice(a)}),s},fix:function(e){if(e[ie.expando])return e;var t,n,o,i=e.type,r=e,s=this.fixHooks[i];for(s||(this.fixHooks[i]=s=Ae.test(i)?this.mouseHooks:Fe.test(i)?this.keyHooks:{}),o=s.props?this.props.concat(s.props):this.props,e=new ie.Event(r),t=o.length;t--;)n=o[t],e[n]=r[n];return e.target||(e.target=r.srcElement||ge),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,t){var n,o,i,r=t.button,s=t.fromElement;return null==e.pageX&&null!=t.clientX&&(o=e.target.ownerDocument||ge,i=o.documentElement,n=o.body,e.pageX=t.clientX+(i&&i.scrollLeft||n&&n.scrollLeft||0)-(i&&i.clientLeft||n&&n.clientLeft||0),e.pageY=t.clientY+(i&&i.scrollTop||n&&n.scrollTop||0)-(i&&i.clientTop||n&&n.clientTop||0)),!e.relatedTarget&&s&&(e.relatedTarget=s===e.target?t.toElement:s),e.which||void 0===r||(e.which=1&r?1:2&r?3:4&r?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==g()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===g()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return ie.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(e){return ie.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,o){var i=ie.extend(new ie.Event,n,{type:e,isSimulated:!0,originalEvent:{}});o?ie.event.trigger(i,null,t):ie.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},ie.removeEvent=ge.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var o="on"+t;e.detachEvent&&(typeof e[o]===xe&&(e[o]=null),e.detachEvent(o,n))},ie.Event=function(e,t){return this instanceof ie.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?h:f):this.type=e,t&&ie.extend(this,t),this.timeStamp=e&&e.timeStamp||ie.now(),void(this[ie.expando]=!0)):new ie.Event(e,t)},ie.Event.prototype={isDefaultPrevented:f,isPropagationStopped:f,isImmediatePropagationStopped:f,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=h,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=h,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=h,e&&e.stopImmediatePropagation&&e.stopImmediatePropagation(),this.stopPropagation()}},ie.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,t){ie.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,o=this,i=e.relatedTarget,r=e.handleObj;return(!i||i!==o&&!ie.contains(o,i))&&(e.type=r.origType,n=r.handler.apply(this,arguments),e.type=t),n}}}),ne.submitBubbles||(ie.event.special.submit={setup:function(){return!ie.nodeName(this,"form")&&void ie.event.add(this,"click._submit keypress._submit",function(e){var t=e.target,n=ie.nodeName(t,"input")||ie.nodeName(t,"button")?t.form:void 0;n&&!ie._data(n,"submitBubbles")&&(ie.event.add(n,"submit._submit",function(e){e._submit_bubble=!0}),ie._data(n,"submitBubbles",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&ie.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return!ie.nodeName(this,"form")&&void ie.event.remove(this,"._submit")}}),ne.changeBubbles||(ie.event.special.change={setup:function(){return Pe.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(ie.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),ie.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),ie.event.simulate("change",this,e,!0)})),!1):void ie.event.add(this,"beforeactivate._change",function(e){var t=e.target;Pe.test(t.nodeName)&&!ie._data(t,"changeBubbles")&&(ie.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||ie.event.simulate("change",this.parentNode,e,!0)}),ie._data(t,"changeBubbles",!0))})},handle:function(e){var t=e.target;return this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type?e.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return ie.event.remove(this,"._change"),!Pe.test(this.nodeName)}}),ne.focusinBubbles||ie.each({focus:"focusin",blur:"focusout"},function(e,t){var n=function(e){ie.event.simulate(t,e.target,ie.event.fix(e),!0)};ie.event.special[t]={setup:function(){var o=this.ownerDocument||this,i=ie._data(o,t);i||o.addEventListener(e,n,!0),ie._data(o,t,(i||0)+1)},teardown:function(){var o=this.ownerDocument||this,i=ie._data(o,t)-1;i?ie._data(o,t,i):(o.removeEventListener(e,n,!0),ie._removeData(o,t))}}}),ie.fn.extend({on:function(e,t,n,o,i){var r,s;if("object"==typeof e){"string"!=typeof t&&(n=n||t,t=void 0);for(r in e)this.on(r,t,n,e[r],i);return this}if(null==n&&null==o?(o=t,n=t=void 0):null==o&&("string"==typeof t?(o=n,n=void 0):(o=n,n=t,t=void 0)),!1===o)o=f;else if(!o)return this;return 1===i&&(s=o,o=function(e){return ie().off(e),s.apply(this,arguments)},o.guid=s.guid||(s.guid=ie.guid++)),this.each(function(){ie.event.add(this,e,o,n,t)})},one:function(e,t,n,o){return this.on(e,t,n,o,1)},off:function(e,t,n){var o,i;if(e&&e.preventDefault&&e.handleObj)return o=e.handleObj,ie(e.delegateTarget).off(o.namespace?o.origType+"."+o.namespace:o.origType,o.selector,o.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return(!1===t||"function"==typeof t)&&(n=t,t=void 0),!1===n&&(n=f),this.each(function(){ie.event.remove(this,e,n,t)})},trigger:function(e,t){return this.each(function(){ie.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];return n?ie.event.trigger(e,t,n,!0):void 0}});var Be="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",Le=/ jQuery\d+="(?:null|\d+)"/g,Me=new RegExp("<(?:"+Be+")[\\s/>]","i"),je=/^\s+/,De=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Oe=/<([\w:]+)/,Ue=/<tbody/i,_e=/<|&#?\w+;/,We=/<(?:script|style|link)/i,Ge=/checked\s*(?:[^=]|=\s*.checked.)/i,ze=/^$|\/(?:java|ecma)script/i,Je=/^true\/(.*)/,$e=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,qe={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:ne.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},Xe=p(ge),Ye=Xe.appendChild(ge.createElement("div"));qe.optgroup=qe.option,qe.tbody=qe.tfoot=qe.colgroup=qe.caption=qe.thead,qe.th=qe.td,ie.extend({clone:function(e,t,n){var o,i,r,s,a,l=ie.contains(e.ownerDocument,e);if(ne.html5Clone||ie.isXMLDoc(e)||!Me.test("<"+e.nodeName+">")?r=e.cloneNode(!0):(Ye.innerHTML=e.outerHTML,Ye.removeChild(r=Ye.firstChild)),!(ne.noCloneEvent&&ne.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ie.isXMLDoc(e)))for(o=m(r),a=m(e),s=0;null!=(i=a[s]);++s)o[s]&&V(i,o[s]);if(t)if(n)for(a=a||m(e),o=o||m(r),s=0;null!=(i=a[s]);s++)x(i,o[s]);else x(e,r);return o=m(r,"script"),o.length>0&&b(o,!l&&m(e,"script")),o=a=i=null,r},buildFragment:function(e,t,n,o){for(var i,r,s,a,l,c,u,d=e.length,h=p(t),f=[],g=0;d>g;g++)if((r=e[g])||0===r)if("object"===ie.type(r))ie.merge(f,r.nodeType?[r]:r);else if(_e.test(r)){for(a=a||h.appendChild(t.createElement("div")),l=(Oe.exec(r)||["",""])[1].toLowerCase(),u=qe[l]||qe._default,a.innerHTML=u[1]+r.replace(De,"<$1></$2>")+u[2],i=u[0];i--;)a=a.lastChild;if(!ne.leadingWhitespace&&je.test(r)&&f.push(t.createTextNode(je.exec(r)[0])),!ne.tbody)for(r="table"!==l||Ue.test(r)?"<table>"!==u[1]||Ue.test(r)?0:a:a.firstChild,i=r&&r.childNodes.length;i--;)ie.nodeName(c=r.childNodes[i],"tbody")&&!c.childNodes.length&&r.removeChild(c);for(ie.merge(f,a.childNodes),a.textContent="";a.firstChild;)a.removeChild(a.firstChild);a=h.lastChild}else f.push(t.createTextNode(r));for(a&&h.removeChild(a),ne.appendChecked||ie.grep(m(f,"input"),T),g=0;r=f[g++];)if((!o||-1===ie.inArray(r,o))&&(s=ie.contains(r.ownerDocument,r),a=m(h.appendChild(r),"script"),s&&b(a),n))for(i=0;r=a[i++];)ze.test(r.type||"")&&n.push(r);return a=null,h},cleanData:function(e,t){for(var n,o,i,r,s=0,a=ie.expando,l=ie.cache,c=ne.deleteExpando,u=ie.event.special;null!=(n=e[s]);s++)if((t||ie.acceptData(n))&&(i=n[a],r=i&&l[i])){if(r.events)for(o in r.events)u[o]?ie.event.remove(n,o):ie.removeEvent(n,o,r.handle);l[i]&&(delete l[i],c?delete n[a]:typeof n.removeAttribute!==xe?n.removeAttribute(a):n[a]=null,q.push(i))}}}),ie.fn.extend({text:function(e){return Ne(this,function(e){return void 0===e?ie.text(this):this.empty().append((this[0]&&this[0].ownerDocument||ge).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){v(this,e).appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=v(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,o=e?ie.filter(e,this):this,i=0;null!=(n=o[i]);i++)t||1!==n.nodeType||ie.cleanData(m(n)),n.parentNode&&(t&&ie.contains(n.ownerDocument,n)&&b(m(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++){for(1===e.nodeType&&ie.cleanData(m(e,!1));e.firstChild;)e.removeChild(e.firstChild);e.options&&ie.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return ie.clone(this,e,t)})},html:function(e){return Ne(this,function(e){var t=this[0]||{},n=0,o=this.length;if(void 0===e)return 1===t.nodeType?t.innerHTML.replace(Le,""):void 0;if(!("string"!=typeof e||We.test(e)||!ne.htmlSerialize&&Me.test(e)||!ne.leadingWhitespace&&je.test(e)||qe[(Oe.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(De,"<$1></$2>");try{for(;o>n;n++)t=this[n]||{},1===t.nodeType&&(ie.cleanData(m(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=arguments[0];return this.domManip(arguments,function(t){e=this.parentNode,ie.cleanData(m(this)),e&&e.replaceChild(t,this)}),e&&(e.length||e.nodeType)?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t){e=Y.apply([],e);var n,o,i,r,s,a,l=0,c=this.length,u=this,d=c-1,h=e[0],f=ie.isFunction(h);if(f||c>1&&"string"==typeof h&&!ne.checkClone&&Ge.test(h))return this.each(function(n){var o=u.eq(n);f&&(e[0]=h.call(this,n,o.html())),o.domManip(e,t)});if(c&&(a=ie.buildFragment(e,this[0].ownerDocument,!1,this),n=a.firstChild,1===a.childNodes.length&&(a=n),n)){for(r=ie.map(m(a,"script"),S),i=r.length;c>l;l++)o=a,l!==d&&(o=ie.clone(o,!0,!0),i&&ie.merge(r,m(o,"script"))),t.call(this[l],o,l);if(i)for(s=r[r.length-1].ownerDocument,ie.map(r,y),l=0;i>l;l++)o=r[l],ze.test(o.type||"")&&!ie._data(o,"globalEval")&&ie.contains(s,o)&&(o.src?ie._evalUrl&&ie._evalUrl(o.src):ie.globalEval((o.text||o.textContent||o.innerHTML||"").replace($e,"")));a=n=null}return this}}),ie.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ie.fn[e]=function(e){for(var n,o=0,i=[],r=ie(e),s=r.length-1;s>=o;o++)n=o===s?this:this.clone(!0),ie(r[o])[t](n),K.apply(i,n.get());return this.pushStack(i)}});var Ke,Qe={};!function(){var e;ne.shrinkWrapBlocks=function(){if(null!=e)return e;e=!1;var t,n,o;return n=ge.getElementsByTagName("body")[0],n&&n.style?(t=ge.createElement("div"),o=ge.createElement("div"),o.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(o).appendChild(t),typeof t.style.zoom!==xe&&(t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",t.appendChild(ge.createElement("div")).style.width="5px",e=3!==t.offsetWidth),n.removeChild(o),e):void 0}}();var Ze,et,tt=/^margin/,nt=new RegExp("^("+Ce+")(?!px)[a-z%]+$","i"),ot=/^(top|right|bottom|left)$/;e.getComputedStyle?(Ze=function(t){return t.ownerDocument.defaultView.opener?t.ownerDocument.defaultView.getComputedStyle(t,null):e.getComputedStyle(t,null)},et=function(e,t,n){var o,i,r,s,a=e.style;return n=n||Ze(e),s=n?n.getPropertyValue(t)||n[t]:void 0,n&&(""!==s||ie.contains(e.ownerDocument,e)||(s=ie.style(e,t)),nt.test(s)&&tt.test(t)&&(o=a.width,i=a.minWidth,r=a.maxWidth,a.minWidth=a.maxWidth=a.width=s,s=n.width,a.width=o,a.minWidth=i,a.maxWidth=r)),void 0===s?s:s+""}):ge.documentElement.currentStyle&&(Ze=function(e){return e.currentStyle},et=function(e,t,n){var o,i,r,s,a=e.style;return n=n||Ze(e),s=n?n[t]:void 0,null==s&&a&&a[t]&&(s=a[t]),nt.test(s)&&!ot.test(t)&&(o=a.left,i=e.runtimeStyle,r=i&&i.left,r&&(i.left=e.currentStyle.left),a.left="fontSize"===t?"1em":s,s=a.pixelLeft+"px",a.left=o,r&&(i.left=r)),void 0===s?s:s+""||"auto"}),function(){function t(){var t,n,o,i;(n=ge.getElementsByTagName("body")[0])&&n.style&&(t=ge.createElement("div"),o=ge.createElement("div"),o.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",n.appendChild(o).appendChild(t),t.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",r=s=!1,l=!0,e.getComputedStyle&&(r="1%"!==(e.getComputedStyle(t,null)||{}).top,s="4px"===(e.getComputedStyle(t,null)||{width:"4px"}).width,i=t.appendChild(ge.createElement("div")),i.style.cssText=t.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",t.style.width="1px",l=!parseFloat((e.getComputedStyle(i,null)||{}).marginRight),t.removeChild(i)),t.innerHTML="<table><tr><td></td><td>t</td></tr></table>",
i=t.getElementsByTagName("td"),i[0].style.cssText="margin:0;border:0;padding:0;display:none",a=0===i[0].offsetHeight,a&&(i[0].style.display="",i[1].style.display="none",a=0===i[0].offsetHeight),n.removeChild(o))}var n,o,i,r,s,a,l;n=ge.createElement("div"),n.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",i=n.getElementsByTagName("a")[0],(o=i&&i.style)&&(o.cssText="float:left;opacity:.5",ne.opacity="0.5"===o.opacity,ne.cssFloat=!!o.cssFloat,n.style.backgroundClip="content-box",n.cloneNode(!0).style.backgroundClip="",ne.clearCloneStyle="content-box"===n.style.backgroundClip,ne.boxSizing=""===o.boxSizing||""===o.MozBoxSizing||""===o.WebkitBoxSizing,ie.extend(ne,{reliableHiddenOffsets:function(){return null==a&&t(),a},boxSizingReliable:function(){return null==s&&t(),s},pixelPosition:function(){return null==r&&t(),r},reliableMarginRight:function(){return null==l&&t(),l}}))}(),ie.swap=function(e,t,n,o){var i,r,s={};for(r in t)s[r]=e.style[r],e.style[r]=t[r];i=n.apply(e,o||[]);for(r in t)e.style[r]=s[r];return i};var it=/alpha\([^)]*\)/i,rt=/opacity\s*=\s*([^)]*)/,st=/^(none|table(?!-c[ea]).+)/,at=new RegExp("^("+Ce+")(.*)$","i"),lt=new RegExp("^([+-])=("+Ce+")","i"),ct={position:"absolute",visibility:"hidden",display:"block"},ut={letterSpacing:"0",fontWeight:"400"},dt=["Webkit","O","Moz","ms"];ie.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=et(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":ne.cssFloat?"cssFloat":"styleFloat"},style:function(e,t,n,o){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,r,s,a=ie.camelCase(t),l=e.style;if(t=ie.cssProps[a]||(ie.cssProps[a]=E(l,a)),s=ie.cssHooks[t]||ie.cssHooks[a],void 0===n)return s&&"get"in s&&void 0!==(i=s.get(e,!1,o))?i:l[t];if(r=typeof n,"string"===r&&(i=lt.exec(n))&&(n=(i[1]+1)*i[2]+parseFloat(ie.css(e,t)),r="number"),null!=n&&n===n&&("number"!==r||ie.cssNumber[a]||(n+="px"),ne.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),!(s&&"set"in s&&void 0===(n=s.set(e,n,o)))))try{l[t]=n}catch(e){}}},css:function(e,t,n,o){var i,r,s,a=ie.camelCase(t);return t=ie.cssProps[a]||(ie.cssProps[a]=E(e.style,a)),s=ie.cssHooks[t]||ie.cssHooks[a],s&&"get"in s&&(r=s.get(e,!0,n)),void 0===r&&(r=et(e,t,o)),"normal"===r&&t in ut&&(r=ut[t]),""===n||n?(i=parseFloat(r),!0===n||ie.isNumeric(i)?i||0:r):r}}),ie.each(["height","width"],function(e,t){ie.cssHooks[t]={get:function(e,n,o){return n?st.test(ie.css(e,"display"))&&0===e.offsetWidth?ie.swap(e,ct,function(){return F(e,t,o)}):F(e,t,o):void 0},set:function(e,n,o){var i=o&&Ze(e);return I(e,n,o?P(e,t,o,ne.boxSizing&&"border-box"===ie.css(e,"boxSizing",!1,i),i):0)}}}),ne.opacity||(ie.cssHooks.opacity={get:function(e,t){return rt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,o=e.currentStyle,i=ie.isNumeric(t)?"alpha(opacity="+100*t+")":"",r=o&&o.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===ie.trim(r.replace(it,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||o&&!o.filter)||(n.filter=it.test(r)?r.replace(it,i):r+" "+i)}}),ie.cssHooks.marginRight=k(ne.reliableMarginRight,function(e,t){return t?ie.swap(e,{display:"inline-block"},et,[e,"marginRight"]):void 0}),ie.each({margin:"",padding:"",border:"Width"},function(e,t){ie.cssHooks[e+t]={expand:function(n){for(var o=0,i={},r="string"==typeof n?n.split(" "):[n];4>o;o++)i[e+ke[o]+t]=r[o]||r[o-2]||r[0];return i}},tt.test(e)||(ie.cssHooks[e+t].set=I)}),ie.fn.extend({css:function(e,t){return Ne(this,function(e,t,n){var o,i,r={},s=0;if(ie.isArray(t)){for(o=Ze(e),i=t.length;i>s;s++)r[t[s]]=ie.css(e,t[s],!1,o);return r}return void 0!==n?ie.style(e,t,n):ie.css(e,t)},e,t,arguments.length>1)},show:function(){return N(this,!0)},hide:function(){return N(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){Ee(this)?ie(this).show():ie(this).hide()})}}),ie.Tween=A,A.prototype={constructor:A,init:function(e,t,n,o,i,r){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=o,this.unit=r||(ie.cssNumber[n]?"":"px")},cur:function(){var e=A.propHooks[this.prop];return e&&e.get?e.get(this):A.propHooks._default.get(this)},run:function(e){var t,n=A.propHooks[this.prop];return this.options.duration?this.pos=t=ie.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):A.propHooks._default.set(this),this}},A.prototype.init.prototype=A.prototype,A.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=ie.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){ie.fx.step[e.prop]?ie.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[ie.cssProps[e.prop]]||ie.cssHooks[e.prop])?ie.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},A.propHooks.scrollTop=A.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ie.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},ie.fx=A.prototype.init,ie.fx.step={};var ht,ft,gt=/^(?:toggle|show|hide)$/,pt=new RegExp("^(?:([+-])=|)("+Ce+")([a-z%]*)$","i"),mt=/queueHooks$/,Tt=[L],vt={"*":[function(e,t){var n=this.createTween(e,t),o=n.cur(),i=pt.exec(t),r=i&&i[3]||(ie.cssNumber[e]?"":"px"),s=(ie.cssNumber[e]||"px"!==r&&+o)&&pt.exec(ie.css(n.elem,e)),a=1,l=20;if(s&&s[3]!==r){r=r||s[3],i=i||[],s=+o||1;do{a=a||".5",s/=a,ie.style(n.elem,e,s+r)}while(a!==(a=n.cur()/o)&&1!==a&&--l)}return i&&(s=n.start=+s||+o||0,n.unit=r,n.end=i[1]?s+(i[1]+1)*i[2]:+i[2]),n}]};ie.Animation=ie.extend(j,{tweener:function(e,t){ie.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,o=0,i=e.length;i>o;o++)n=e[o],vt[n]=vt[n]||[],vt[n].unshift(t)},prefilter:function(e,t){t?Tt.unshift(e):Tt.push(e)}}),ie.speed=function(e,t,n){var o=e&&"object"==typeof e?ie.extend({},e):{complete:n||!n&&t||ie.isFunction(e)&&e,duration:e,easing:n&&t||t&&!ie.isFunction(t)&&t};return o.duration=ie.fx.off?0:"number"==typeof o.duration?o.duration:o.duration in ie.fx.speeds?ie.fx.speeds[o.duration]:ie.fx.speeds._default,(null==o.queue||!0===o.queue)&&(o.queue="fx"),o.old=o.complete,o.complete=function(){ie.isFunction(o.old)&&o.old.call(this),o.queue&&ie.dequeue(this,o.queue)},o},ie.fn.extend({fadeTo:function(e,t,n,o){return this.filter(Ee).css("opacity",0).show().end().animate({opacity:t},e,n,o)},animate:function(e,t,n,o){var i=ie.isEmptyObject(e),r=ie.speed(t,n,o),s=function(){var t=j(this,ie.extend({},e),r);(i||ie._data(this,"finish"))&&t.stop(!0)};return s.finish=s,i||!1===r.queue?this.each(s):this.queue(r.queue,s)},stop:function(e,t,n){var o=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=t,t=e,e=void 0),t&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",r=ie.timers,s=ie._data(this);if(i)s[i]&&s[i].stop&&o(s[i]);else for(i in s)s[i]&&s[i].stop&&mt.test(i)&&o(s[i]);for(i=r.length;i--;)r[i].elem!==this||null!=e&&r[i].queue!==e||(r[i].anim.stop(n),t=!1,r.splice(i,1));(t||!n)&&ie.dequeue(this,e)})},finish:function(e){return!1!==e&&(e=e||"fx"),this.each(function(){var t,n=ie._data(this),o=n[e+"queue"],i=n[e+"queueHooks"],r=ie.timers,s=o?o.length:0;for(n.finish=!0,ie.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=r.length;t--;)r[t].elem===this&&r[t].queue===e&&(r[t].anim.stop(!0),r.splice(t,1));for(t=0;s>t;t++)o[t]&&o[t].finish&&o[t].finish.call(this);delete n.finish})}}),ie.each(["toggle","show","hide"],function(e,t){var n=ie.fn[t];ie.fn[t]=function(e,o,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(H(t,!0),e,o,i)}}),ie.each({slideDown:H("show"),slideUp:H("hide"),slideToggle:H("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ie.fn[e]=function(e,n,o){return this.animate(t,e,n,o)}}),ie.timers=[],ie.fx.tick=function(){var e,t=ie.timers,n=0;for(ht=ie.now();n<t.length;n++)(e=t[n])()||t[n]!==e||t.splice(n--,1);t.length||ie.fx.stop(),ht=void 0},ie.fx.timer=function(e){ie.timers.push(e),e()?ie.fx.start():ie.timers.pop()},ie.fx.interval=13,ie.fx.start=function(){ft||(ft=setInterval(ie.fx.tick,ie.fx.interval))},ie.fx.stop=function(){clearInterval(ft),ft=null},ie.fx.speeds={slow:600,fast:200,_default:400},ie.fn.delay=function(e,t){return e=ie.fx?ie.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var o=setTimeout(t,e);n.stop=function(){clearTimeout(o)}})},function(){var e,t,n,o,i;t=ge.createElement("div"),t.setAttribute("className","t"),t.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",o=t.getElementsByTagName("a")[0],n=ge.createElement("select"),i=n.appendChild(ge.createElement("option")),e=t.getElementsByTagName("input")[0],o.style.cssText="top:1px",ne.getSetAttribute="t"!==t.className,ne.style=/top/.test(o.getAttribute("style")),ne.hrefNormalized="/a"===o.getAttribute("href"),ne.checkOn=!!e.value,ne.optSelected=i.selected,ne.enctype=!!ge.createElement("form").enctype,n.disabled=!0,ne.optDisabled=!i.disabled,e=ge.createElement("input"),e.setAttribute("value",""),ne.input=""===e.getAttribute("value"),e.value="t",e.setAttribute("type","radio"),ne.radioValue="t"===e.value}();var St=/\r/g;ie.fn.extend({val:function(e){var t,n,o,i=this[0];return arguments.length?(o=ie.isFunction(e),this.each(function(n){var i;1===this.nodeType&&(i=o?e.call(this,n,ie(this).val()):e,null==i?i="":"number"==typeof i?i+="":ie.isArray(i)&&(i=ie.map(i,function(e){return null==e?"":e+""})),(t=ie.valHooks[this.type]||ie.valHooks[this.nodeName.toLowerCase()])&&"set"in t&&void 0!==t.set(this,i,"value")||(this.value=i))})):i?(t=ie.valHooks[i.type]||ie.valHooks[i.nodeName.toLowerCase()],t&&"get"in t&&void 0!==(n=t.get(i,"value"))?n:(n=i.value,"string"==typeof n?n.replace(St,""):null==n?"":n)):void 0}}),ie.extend({valHooks:{option:{get:function(e){var t=ie.find.attr(e,"value");return null!=t?t:ie.trim(ie.text(e))}},select:{get:function(e){for(var t,n,o=e.options,i=e.selectedIndex,r="select-one"===e.type||0>i,s=r?null:[],a=r?i+1:o.length,l=0>i?a:r?i:0;a>l;l++)if(n=o[l],!(!n.selected&&l!==i||(ne.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&ie.nodeName(n.parentNode,"optgroup"))){if(t=ie(n).val(),r)return t;s.push(t)}return s},set:function(e,t){for(var n,o,i=e.options,r=ie.makeArray(t),s=i.length;s--;)if(o=i[s],ie.inArray(ie.valHooks.option.get(o),r)>=0)try{o.selected=n=!0}catch(e){o.scrollHeight}else o.selected=!1;return n||(e.selectedIndex=-1),i}}}}),ie.each(["radio","checkbox"],function(){ie.valHooks[this]={set:function(e,t){return ie.isArray(t)?e.checked=ie.inArray(ie(e).val(),t)>=0:void 0}},ne.checkOn||(ie.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var yt,bt,xt=ie.expr.attrHandle,Vt=/^(?:checked|selected)$/i,wt=ne.getSetAttribute,Ct=ne.input;ie.fn.extend({attr:function(e,t){return Ne(this,ie.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ie.removeAttr(this,e)})}}),ie.extend({attr:function(e,t,n){var o,i,r=e.nodeType;return e&&3!==r&&8!==r&&2!==r?typeof e.getAttribute===xe?ie.prop(e,t,n):(1===r&&ie.isXMLDoc(e)||(t=t.toLowerCase(),o=ie.attrHooks[t]||(ie.expr.match.bool.test(t)?bt:yt)),void 0===n?o&&"get"in o&&null!==(i=o.get(e,t))?i:(i=ie.find.attr(e,t),null==i?void 0:i):null!==n?o&&"set"in o&&void 0!==(i=o.set(e,n,t))?i:(e.setAttribute(t,n+""),n):void ie.removeAttr(e,t)):void 0},removeAttr:function(e,t){var n,o,i=0,r=t&&t.match(ve);if(r&&1===e.nodeType)for(;n=r[i++];)o=ie.propFix[n]||n,ie.expr.match.bool.test(n)?Ct&&wt||!Vt.test(n)?e[o]=!1:e[ie.camelCase("default-"+n)]=e[o]=!1:ie.attr(e,n,""),e.removeAttribute(wt?n:o)},attrHooks:{type:{set:function(e,t){if(!ne.radioValue&&"radio"===t&&ie.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}}}),bt={set:function(e,t,n){return!1===t?ie.removeAttr(e,n):Ct&&wt||!Vt.test(n)?e.setAttribute(!wt&&ie.propFix[n]||n,n):e[ie.camelCase("default-"+n)]=e[n]=!0,n}},ie.each(ie.expr.match.bool.source.match(/\w+/g),function(e,t){var n=xt[t]||ie.find.attr;xt[t]=Ct&&wt||!Vt.test(t)?function(e,t,o){var i,r;return o||(r=xt[t],xt[t]=i,i=null!=n(e,t,o)?t.toLowerCase():null,xt[t]=r),i}:function(e,t,n){return n?void 0:e[ie.camelCase("default-"+t)]?t.toLowerCase():null}}),Ct&&wt||(ie.attrHooks.value={set:function(e,t,n){return ie.nodeName(e,"input")?void(e.defaultValue=t):yt&&yt.set(e,t,n)}}),wt||(yt={set:function(e,t,n){var o=e.getAttributeNode(n);return o||e.setAttributeNode(o=e.ownerDocument.createAttribute(n)),o.value=t+="","value"===n||t===e.getAttribute(n)?t:void 0}},xt.id=xt.name=xt.coords=function(e,t,n){var o;return n?void 0:(o=e.getAttributeNode(t))&&""!==o.value?o.value:null},ie.valHooks.button={get:function(e,t){var n=e.getAttributeNode(t);return n&&n.specified?n.value:void 0},set:yt.set},ie.attrHooks.contenteditable={set:function(e,t,n){yt.set(e,""!==t&&t,n)}},ie.each(["width","height"],function(e,t){ie.attrHooks[t]={set:function(e,n){return""===n?(e.setAttribute(t,"auto"),n):void 0}}})),ne.style||(ie.attrHooks.style={get:function(e){return e.style.cssText||void 0},set:function(e,t){return e.style.cssText=t+""}});var kt=/^(?:input|select|textarea|button|object)$/i,Et=/^(?:a|area)$/i;ie.fn.extend({prop:function(e,t){return Ne(this,ie.prop,e,t,arguments.length>1)},removeProp:function(e){return e=ie.propFix[e]||e,this.each(function(){try{this[e]=void 0,delete this[e]}catch(e){}})}}),ie.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(e,t,n){var o,i,r,s=e.nodeType;return e&&3!==s&&8!==s&&2!==s?(r=1!==s||!ie.isXMLDoc(e),r&&(t=ie.propFix[t]||t,i=ie.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(o=i.set(e,n,t))?o:e[t]=n:i&&"get"in i&&null!==(o=i.get(e,t))?o:e[t]):void 0},propHooks:{tabIndex:{get:function(e){var t=ie.find.attr(e,"tabindex");return t?parseInt(t,10):kt.test(e.nodeName)||Et.test(e.nodeName)&&e.href?0:-1}}}}),ne.hrefNormalized||ie.each(["href","src"],function(e,t){ie.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),ne.optSelected||(ie.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),ie.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ie.propFix[this.toLowerCase()]=this}),ne.enctype||(ie.propFix.enctype="encoding");var Nt=/[\t\r\n\f]/g;ie.fn.extend({addClass:function(e){var t,n,o,i,r,s,a=0,l=this.length,c="string"==typeof e&&e;if(ie.isFunction(e))return this.each(function(t){ie(this).addClass(e.call(this,t,this.className))});if(c)for(t=(e||"").match(ve)||[];l>a;a++)if(n=this[a],o=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Nt," "):" ")){for(r=0;i=t[r++];)o.indexOf(" "+i+" ")<0&&(o+=i+" ");s=ie.trim(o),n.className!==s&&(n.className=s)}return this},removeClass:function(e){var t,n,o,i,r,s,a=0,l=this.length,c=0===arguments.length||"string"==typeof e&&e;if(ie.isFunction(e))return this.each(function(t){ie(this).removeClass(e.call(this,t,this.className))});if(c)for(t=(e||"").match(ve)||[];l>a;a++)if(n=this[a],o=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(Nt," "):"")){for(r=0;i=t[r++];)for(;o.indexOf(" "+i+" ")>=0;)o=o.replace(" "+i+" "," ");s=e?ie.trim(o):"",n.className!==s&&(n.className=s)}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):this.each(ie.isFunction(e)?function(n){ie(this).toggleClass(e.call(this,n,this.className,t),t)}:function(){if("string"===n)for(var t,o=0,i=ie(this),r=e.match(ve)||[];t=r[o++];)i.hasClass(t)?i.removeClass(t):i.addClass(t);else(n===xe||"boolean"===n)&&(this.className&&ie._data(this,"__className__",this.className),this.className=this.className||!1===e?"":ie._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,o=this.length;o>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(Nt," ").indexOf(t)>=0)return!0;return!1}}),ie.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){ie.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),ie.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,o){return this.on(t,e,n,o)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var It=ie.now(),Pt=/\?/,Ft=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;ie.parseJSON=function(t){if(e.JSON&&e.JSON.parse)return e.JSON.parse(t+"");var n,o=null,i=ie.trim(t+"");return i&&!ie.trim(i.replace(Ft,function(e,t,i,r){return n&&t&&(o=0),0===o?e:(n=i||t,o+=!r-!i,"")}))?Function("return "+i)():ie.error("Invalid JSON: "+t)},ie.parseXML=function(t){var n,o;if(!t||"string"!=typeof t)return null;try{e.DOMParser?(o=new DOMParser,n=o.parseFromString(t,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(t))}catch(e){n=void 0}return n&&n.documentElement&&!n.getElementsByTagName("parsererror").length||ie.error("Invalid XML: "+t),n};var At,Rt,Ht=/#.*$/,Bt=/([?&])_=[^&]*/,Lt=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Mt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,jt=/^(?:GET|HEAD)$/,Dt=/^\/\//,Ot=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ut={},_t={},Wt="*/".concat("*");try{Rt=location.href}catch(e){Rt=ge.createElement("a"),Rt.href="",Rt=Rt.href}At=Ot.exec(Rt.toLowerCase())||[],ie.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Rt,type:"GET",isLocal:Mt.test(At[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Wt,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ie.parseJSON,"text xml":ie.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?U(U(e,ie.ajaxSettings),t):U(ie.ajaxSettings,e)},ajaxPrefilter:D(Ut),ajaxTransport:D(_t),ajax:function(e,t){function n(e,t,n,o){var i,u,T,v,y,x=t;2!==S&&(S=2,a&&clearTimeout(a),c=void 0,s=o||"",b.readyState=e>0?4:0,i=e>=200&&300>e||304===e,n&&(v=_(d,b,n)),v=W(d,v,b,i),i?(d.ifModified&&(y=b.getResponseHeader("Last-Modified"),y&&(ie.lastModified[r]=y),(y=b.getResponseHeader("etag"))&&(ie.etag[r]=y)),204===e||"HEAD"===d.type?x="nocontent":304===e?x="notmodified":(x=v.state,u=v.data,T=v.error,i=!T)):(T=x,(e||!x)&&(x="error",0>e&&(e=0))),b.status=e,b.statusText=(t||x)+"",i?g.resolveWith(h,[u,x,b]):g.rejectWith(h,[b,x,T]),b.statusCode(m),m=void 0,l&&f.trigger(i?"ajaxSuccess":"ajaxError",[b,d,i?u:T]),p.fireWith(h,[b,x]),l&&(f.trigger("ajaxComplete",[b,d]),--ie.active||ie.event.trigger("ajaxStop")))}"object"==typeof e&&(t=e,e=void 0),t=t||{};var o,i,r,s,a,l,c,u,d=ie.ajaxSetup({},t),h=d.context||d,f=d.context&&(h.nodeType||h.jquery)?ie(h):ie.event,g=ie.Deferred(),p=ie.Callbacks("once memory"),m=d.statusCode||{},T={},v={},S=0,y="canceled",b={readyState:0,getResponseHeader:function(e){var t;if(2===S){if(!u)for(u={};t=Lt.exec(s);)u[t[1].toLowerCase()]=t[2];t=u[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===S?s:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return S||(e=v[n]=v[n]||e,T[e]=t),this},overrideMimeType:function(e){return S||(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>S)for(t in e)m[t]=[m[t],e[t]];else b.always(e[b.status]);return this},abort:function(e){var t=e||y;return c&&c.abort(t),n(0,t),this}};if(g.promise(b).complete=p.add,b.success=b.done,b.error=b.fail,d.url=((e||d.url||Rt)+"").replace(Ht,"").replace(Dt,At[1]+"//"),d.type=t.method||t.type||d.method||d.type,d.dataTypes=ie.trim(d.dataType||"*").toLowerCase().match(ve)||[""],null==d.crossDomain&&(o=Ot.exec(d.url.toLowerCase()),d.crossDomain=!(!o||o[1]===At[1]&&o[2]===At[2]&&(o[3]||("http:"===o[1]?"80":"443"))===(At[3]||("http:"===At[1]?"80":"443")))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=ie.param(d.data,d.traditional)),O(Ut,d,t,b),2===S)return b;l=ie.event&&d.global,l&&0==ie.active++&&ie.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!jt.test(d.type),r=d.url,d.hasContent||(d.data&&(r=d.url+=(Pt.test(r)?"&":"?")+d.data,delete d.data),!1===d.cache&&(d.url=Bt.test(r)?r.replace(Bt,"$1_="+It++):r+(Pt.test(r)?"&":"?")+"_="+It++)),d.ifModified&&(ie.lastModified[r]&&b.setRequestHeader("If-Modified-Since",ie.lastModified[r]),ie.etag[r]&&b.setRequestHeader("If-None-Match",ie.etag[r])),(d.data&&d.hasContent&&!1!==d.contentType||t.contentType)&&b.setRequestHeader("Content-Type",d.contentType),b.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+Wt+"; q=0.01":""):d.accepts["*"]);for(i in d.headers)b.setRequestHeader(i,d.headers[i]);if(d.beforeSend&&(!1===d.beforeSend.call(h,b,d)||2===S))return b.abort();y="abort";for(i in{success:1,error:1,complete:1})b[i](d[i]);if(c=O(_t,d,t,b)){b.readyState=1,l&&f.trigger("ajaxSend",[b,d]),d.async&&d.timeout>0&&(a=setTimeout(function(){b.abort("timeout")},d.timeout));try{S=1,c.send(T,n)}catch(e){if(!(2>S))throw e;n(-1,e)}}else n(-1,"No Transport");return b},getJSON:function(e,t,n){return ie.get(e,t,n,"json")},getScript:function(e,t){return ie.get(e,void 0,t,"script")}}),ie.each(["get","post"],function(e,t){ie[t]=function(e,n,o,i){return ie.isFunction(n)&&(i=i||o,o=n,n=void 0),ie.ajax({url:e,type:t,dataType:i,data:n,success:o})}}),ie._evalUrl=function(e){return ie.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},ie.fn.extend({wrapAll:function(e){if(ie.isFunction(e))return this.each(function(t){ie(this).wrapAll(e.call(this,t))});if(this[0]){var t=ie(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return this.each(ie.isFunction(e)?function(t){ie(this).wrapInner(e.call(this,t))}:function(){var t=ie(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=ie.isFunction(e);return this.each(function(n){ie(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){ie.nodeName(this,"body")||ie(this).replaceWith(this.childNodes)}).end()}}),ie.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0||!ne.reliableHiddenOffsets()&&"none"===(e.style&&e.style.display||ie.css(e,"display"))},ie.expr.filters.visible=function(e){return!ie.expr.filters.hidden(e)};var Gt=/%20/g,zt=/\[\]$/,Jt=/\r?\n/g,$t=/^(?:submit|button|image|reset|file)$/i,qt=/^(?:input|select|textarea|keygen)/i;ie.param=function(e,t){var n,o=[],i=function(e,t){t=ie.isFunction(t)?t():null==t?"":t,o[o.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(void 0===t&&(t=ie.ajaxSettings&&ie.ajaxSettings.traditional),ie.isArray(e)||e.jquery&&!ie.isPlainObject(e))ie.each(e,function(){i(this.name,this.value)});else for(n in e)G(n,e[n],t,i);return o.join("&").replace(Gt,"+")},ie.fn.extend({serialize:function(){return ie.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ie.prop(this,"elements");return e?ie.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ie(this).is(":disabled")&&qt.test(this.nodeName)&&!$t.test(e)&&(this.checked||!Ie.test(e))}).map(function(e,t){var n=ie(this).val();return null==n?null:ie.isArray(n)?ie.map(n,function(e){return{name:t.name,value:e.replace(Jt,"\r\n")}}):{name:t.name,value:n.replace(Jt,"\r\n")}}).get()}}),ie.ajaxSettings.xhr=void 0!==e.ActiveXObject?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&z()||J()}:z;var Xt=0,Yt={},Kt=ie.ajaxSettings.xhr();e.attachEvent&&e.attachEvent("onunload",function(){for(var e in Yt)Yt[e](void 0,!0)}),ne.cors=!!Kt&&"withCredentials"in Kt,Kt=ne.ajax=!!Kt,Kt&&ie.ajaxTransport(function(e){if(!e.crossDomain||ne.cors){var t;return{send:function(n,o){var i,r=e.xhr(),s=++Xt;if(r.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(i in e.xhrFields)r[i]=e.xhrFields[i];e.mimeType&&r.overrideMimeType&&r.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(i in n)void 0!==n[i]&&r.setRequestHeader(i,n[i]+"");r.send(e.hasContent&&e.data||null),t=function(n,i){var a,l,c;if(t&&(i||4===r.readyState))if(delete Yt[s],t=void 0,r.onreadystatechange=ie.noop,i)4!==r.readyState&&r.abort();else{c={},a=r.status,"string"==typeof r.responseText&&(c.text=r.responseText);try{l=r.statusText}catch(e){l=""}a||!e.isLocal||e.crossDomain?1223===a&&(a=204):a=c.text?200:404}c&&o(a,l,c,r.getAllResponseHeaders())},e.async?4===r.readyState?setTimeout(t):r.onreadystatechange=Yt[s]=t:t()},abort:function(){t&&t(void 0,!0)}}}}),ie.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return ie.globalEval(e),e}}}),ie.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),ie.ajaxTransport("script",function(e){if(e.crossDomain){var t,n=ge.head||ie("head")[0]||ge.documentElement;return{send:function(o,i){t=ge.createElement("script"),t.async=!0,e.scriptCharset&&(t.charset=e.scriptCharset),t.src=e.url,t.onload=t.onreadystatechange=function(e,n){(n||!t.readyState||/loaded|complete/.test(t.readyState))&&(t.onload=t.onreadystatechange=null,t.parentNode&&t.parentNode.removeChild(t),t=null,n||i(200,"success"))},n.insertBefore(t,n.firstChild)},abort:function(){t&&t.onload(void 0,!0)}}}});var Qt=[],Zt=/(=)\?(?=&|$)|\?\?/;ie.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Qt.pop()||ie.expando+"_"+It++;return this[e]=!0,e}}),ie.ajaxPrefilter("json jsonp",function(t,n,o){var i,r,s,a=!1!==t.jsonp&&(Zt.test(t.url)?"url":"string"==typeof t.data&&!(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Zt.test(t.data)&&"data");return a||"jsonp"===t.dataTypes[0]?(i=t.jsonpCallback=ie.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,a?t[a]=t[a].replace(Zt,"$1"+i):!1!==t.jsonp&&(t.url+=(Pt.test(t.url)?"&":"?")+t.jsonp+"="+i),t.converters["script json"]=function(){return s||ie.error(i+" was not called"),s[0]},t.dataTypes[0]="json",r=e[i],e[i]=function(){s=arguments},o.always(function(){e[i]=r,t[i]&&(t.jsonpCallback=n.jsonpCallback,Qt.push(i)),s&&ie.isFunction(r)&&r(s[0]),s=r=void 0}),"script"):void 0}),ie.parseHTML=function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||ge;var o=de.exec(e),i=!n&&[];return o?[t.createElement(o[1])]:(o=ie.buildFragment([e],t,i),i&&i.length&&ie(i).remove(),ie.merge([],o.childNodes))};var en=ie.fn.load;ie.fn.load=function(e,t,n){if("string"!=typeof e&&en)return en.apply(this,arguments);var o,i,r,s=this,a=e.indexOf(" ");return a>=0&&(o=ie.trim(e.slice(a,e.length)),e=e.slice(0,a)),ie.isFunction(t)?(n=t,t=void 0):t&&"object"==typeof t&&(r="POST"),s.length>0&&ie.ajax({url:e,type:r,dataType:"html",data:t}).done(function(e){i=arguments,s.html(o?ie("<div>").append(ie.parseHTML(e)).find(o):e)}).complete(n&&function(e,t){s.each(n,i||[e.responseText,t,e])}),this},ie.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ie.fn[t]=function(e){return this.on(t,e)}}),ie.expr.filters.animated=function(e){return ie.grep(ie.timers,function(t){return e===t.elem}).length};var tn=e.document.documentElement;ie.offset={setOffset:function(e,t,n){var o,i,r,s,a,l,c,u=ie.css(e,"position"),d=ie(e),h={};"static"===u&&(e.style.position="relative"),a=d.offset(),r=ie.css(e,"top"),l=ie.css(e,"left"),c=("absolute"===u||"fixed"===u)&&ie.inArray("auto",[r,l])>-1,c?(o=d.position(),s=o.top,i=o.left):(s=parseFloat(r)||0,i=parseFloat(l)||0),ie.isFunction(t)&&(t=t.call(e,n,a)),null!=t.top&&(h.top=t.top-a.top+s),null!=t.left&&(h.left=t.left-a.left+i),"using"in t?t.using.call(e,h):d.css(h)}},ie.fn.extend({offset:function(e){if(arguments.length)return void 0===e?this:this.each(function(t){ie.offset.setOffset(this,e,t)});var t,n,o={top:0,left:0},i=this[0],r=i&&i.ownerDocument;return r?(t=r.documentElement,ie.contains(t,i)?(typeof i.getBoundingClientRect!==xe&&(o=i.getBoundingClientRect()),n=$(r),{top:o.top+(n.pageYOffset||t.scrollTop)-(t.clientTop||0),left:o.left+(n.pageXOffset||t.scrollLeft)-(t.clientLeft||0)}):o):void 0},position:function(){if(this[0]){var e,t,n={top:0,left:0},o=this[0];return"fixed"===ie.css(o,"position")?t=o.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),ie.nodeName(e[0],"html")||(n=e.offset()),n.top+=ie.css(e[0],"borderTopWidth",!0),n.left+=ie.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-ie.css(o,"marginTop",!0),left:t.left-n.left-ie.css(o,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||tn;e&&!ie.nodeName(e,"html")&&"static"===ie.css(e,"position");)e=e.offsetParent;return e||tn})}}),ie.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,t){var n=/Y/.test(t);ie.fn[e]=function(o){return Ne(this,function(e,o,i){var r=$(e);return void 0===i?r?t in r?r[t]:r.document.documentElement[o]:e[o]:void(r?r.scrollTo(n?ie(r).scrollLeft():i,n?i:ie(r).scrollTop()):e[o]=i)},e,o,arguments.length,null)}}),ie.each(["top","left"],function(e,t){ie.cssHooks[t]=k(ne.pixelPosition,function(e,n){return n?(n=et(e,t),nt.test(n)?ie(e).position()[t]+"px":n):void 0})}),ie.each({Height:"height",Width:"width"},function(e,t){ie.each({padding:"inner"+e,content:t,"":"outer"+e},function(n,o){ie.fn[o]=function(o,i){var r=arguments.length&&(n||"boolean"!=typeof o),s=n||(!0===o||!0===i?"margin":"border");return Ne(this,function(t,n,o){var i;return ie.isWindow(t)?t.document.documentElement["client"+e]:9===t.nodeType?(i=t.documentElement,Math.max(t.body["scroll"+e],i["scroll"+e],t.body["offset"+e],i["offset"+e],i["client"+e])):void 0===o?ie.css(t,n,s):ie.style(t,n,o,s)},t,r?o:void 0,r,null)}})}),ie.fn.size=function(){return this.length},ie.fn.andSelf=ie.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return ie});var nn=e.jQuery,on=e.$;return ie.noConflict=function(t){return e.$===ie&&(e.$=on),t&&e.jQuery===ie&&(e.jQuery=nn),ie},typeof t===xe&&(e.jQuery=e.$=ie),ie}),function(e){var t=e;(function(e){var t={Models:{},Settings:{enableLogging:!1,wordsPerPage:300}};t.enableLogging=function(){this.Settings.enableLogging=!0},t.disableLogging=function(){this.Settings.enableLogging=!1},t.setLogLevel=function(e){var e=t.Logger.levels[e];void 0===e&&(e=t.Logger.levels.error),this.Settings.logLevel=e},t.init=function(n,o,i,r){null==n&&(n=window),null==o&&(o=document),null==i&&(i=VSTEPUBModule),this.window=n,this.document=o,this.scrollElement=r||n,this.sharedEpubModule=i,e(this.window).load(function(){t.fire("internal:page:load")}),e(this.window).unload(function(){t.fire("page:unload")}),t.Models.Highlight.init(this.window,this.document),t.Utils.init(this.window,this.document,this.scrollElement)},t.eW=function(e,n){var o=!1;this.fire=function(){o||t.EventDispatcher.fire(e)};var i=this,r=function(){t.fire(e+":before");var r=n.call(i);return o||t.fire(e),r};return setTimeout(r,0)},t.ajax=function(n,o){return t.Utils.calculateAjaxKey(n),o&&(n.error=n.error||function(e,n){var i=new t.Error(n);o(i)}),e.ajax(n)},t.Error=function(e){this.message=e},this.VST=t}).call(window,t),function(e){VST.EventDispatcher=new function(){var e={},t={},n={},o={},i={},r=this,s=function(t){return!!(e[t]&&e[t].length>0)},a=function(t){if(s(t)){for(var n=[],o=e[t].length-1;o>=0;o--)e[t][o].unbound&&n.push(o);for(var i=0;i<n.length;i++)e[t].splice(n[i],1)}},l=function(e){return!!(t[e]&&t[e].length>0)};this.init=function(){return i={},this},this.getBatchedEvents=function(){return n},this.getListeners=function(t){return e[t]||[]},this.firedEvents=function(){return i},this.unbind=function(t,n){if(n){
if(e[t])for(var o=e[t].length-1;o>=0;o--){var i=e[t][o];if(i.handler==n)return VST.Logger.debug("we found the handler"),void(e[t][o].unbound=!0);VST.Logger.debug("no handler",i,n)}}else e[t]&&(e[t]=null)},this.bind=function(n,o,i,r){if(i=i||this,o={handler:o,binding:i},r){t[n]=t[n]||[];for(var s=t[n].length-1;s>=0;s--){var a=t[n][s];if(a.handler===o.handler&&a.binding===o.binding)return VST.Logger.debug("handler already bound"),!1}t[n].push(o)}else{e[n]=e[n]||[];for(var s=e[n].length-1;s>=0;s--){var a=e[n][s];if(a.handler===o.handler&&a.binding===o.binding)return VST.Logger.debug("handler already bound"),!1}e[n].push(o)}return this},this.once=function(n,o,i,r){i=i||this;for(var s=r?t:e,a=s[n]||[],l=a.length-1;l>=0;l--){var c=a[l].handler;if(c.handler===o&&c===i)return this}var u=function(){return d(),o.apply(i,arguments)},d=function(){VST.Logger.debug("cancelling ourself!"),VST.unbind(n,u)};return this.bind(n,u,i,r)},this.cancel=function(e){n[e]&&clearTimeout(n[e].timer)},this.fireLater=function(e,t,o){return null==o&&(o=20),n[e]?clearTimeout(n[e].timer):n[e]={},n[e].timer=setTimeout(function(){r.fire(e,t)},o),this},this.fire=function(n,o){var r;if(r=n instanceof VST.Event?n:new VST.Event(n),o?VST.Logger.debug(r.toString(),o):VST.Logger.debug(r.toString()),i[r.name]=o,l(r.name))for(var c=0;c<t[r.name].length;c++){var u=t[r.name][c];u.handler.call(u.binding,r,o)}if(s(r.name)){for(var c=0;c<e[r.name].length;c++)if(r.shouldPropogate()){var u=e[r.name][c];u.unbound||u.handler.call(u.binding,r,o)}a(r.name)}return this},this.throttle=function(e,t,n,i){n=n||20,i=i||100,o[e]=o[e]||{count:0};var r=o[e];clearTimeout(r.timer);var s=function(){o[e].lastFired=+new Date,o[e].count=0,VST.fire(e,t)};return function(){return r.count+1>=n||(!r.lastFired||+new Date-r.lastFired>i)}()?s():(o[e].count+=1,o[e].timer=setTimeout(s,i)),this},this.trigger=this.fire,this.fireBefore=function(e,t){return this.fire(e+":before",t),this}},VST.delayedEventWrapper=function(e,t,n,o){"function"!=typeof n&&(o=n,n=t,t=this);var i=function(){VST.EventDispatcher.fireLater(e+":before");var o=n.call(t);return VST.EventDispatcher.fireLater(e),o};return o?i():void setTimeout(i,0)},VST.eventWrapper=function(e,t,n,o){"function"!=typeof n&&(o=n,n=t,t=this);var i=function(){VST.EventDispatcher.fire(e+":before");var o=n.call(t);return VST.EventDispatcher.fire(e),o};return o?i():void setTimeout(i,0)},VST.ajaxEventWrapper=function(t,n,o){VST.EventDispatcher.fire(t+":before");var i=n.complete;n.complete=function(){VST.EventDispatcher.fire(t),i&&i.apply(this,arguments)},o&&(n.error=n.error||function(e,t){var t=new VST.Error(status);o(t,void 0)}),e.ajax(n)},VST.delayedAjaxEventWrapper=function(t,n,o){VST.EventDispatcher.fireLater(t+":before"),n.complete=function(){VST.EventDispatcher.fireLater(t)},o&&(n.error=n.error||function(e,t){var t=new VST.Error(status);o(t,void 0)}),e.ajax(n)},VST.bind=VST.EventDispatcher.bind,VST.unbind=VST.EventDispatcher.unbind,VST.once=VST.EventDispatcher.once,VST.fire=VST.EventDispatcher.fire,VST.fireLater=VST.EventDispatcher.fireLater,VST.throttle=VST.EventDispatcher.throttle,VST.trigger=VST.fire,VST.Event=function(e,t){VST.Utils.setDefaults(this,t),this.name=e;var n=!0;this.stop=function(){n=!1},this.shouldPropogate=function(){return n},this.fire=function(){VST.EventDispatcher.fire(this)},this.toString=function(){return"[Event] : "+this.name}},VST.Event.fromjQueryEvent=function(e,t,n){return n=n||{},VST.Utils.setDefaults(n,{target:t.target,originalEvent:t}),new VST.Event(e,n)}}.call(window,t),function(e){VST.Utils={},VST.Utils.init=function(){VST.Utils.watchCopy(),VST.Utils.watchScroll()},VST.Utils.watchCopy=function(){e(VST.document).find("body").bind("copy",function(e){"undefined"!=typeof VST.Book&&VST.Book.handleCopy(e)})},VST.Utils.pageScrollHandler=function(){VST.fireLater("internal:page:scroll"),VST.fire("page:scroll:raw")},VST.Utils.throttledPageScrollHandler=function(){VST.fire("page:scroll:raw"),VST.throttle("internal:page:scroll",+new Date,20)},VST.Utils.scrollTop=function(){var e=VST.scrollElement.scrollTop||VST.scrollElement.scrollY||VST.scrollElement.pageYOffset;return void 0===e&&(e=0),e},VST.Utils.scrollLeft=function(){var e=VST.scrollElement.scrollLeft||VST.scrollElement.scrollX||VST.scrollElement.pageXOffset;return void 0===e&&(e=0),e};var t=function(){var e=VST.$(VST.document),t=function(e){return-1!=["style","script"].indexOf(e.nodeName.toLowerCase())},n={cfi:VST.sharedEpubModule.GetCFIForCurrentScrollPosition(t),scrollTop:VST.Utils.scrollTop(),scrollLeft:VST.Utils.scrollLeft(),scrollHeight:VST.scrollElement.scrollHeight||e.outerHeight(),scrollWidth:VST.scrollElement.scrollWidth||e.outerWidth()};VST.fire("page:scroll",n)};VST.Utils.watchScroll=function(){e(VST.scrollElement).unbind("scroll.vst"),e(VST.scrollElement).bind("scroll.vst",VST.Utils.pageScrollHandler),VST.bind("internal:page:scroll",t,null,!0)},VST.Utils.triggerPageScroll=function(){t()},VST.Utils.throttlePageScrollEvent=function(){e(VST.scrollElement).unbind("scroll.vst"),e(VST.scrollElement).bind("scroll.vst",VST.Utils.throttledPageScrollHandler),VST.bind("internal:page:scroll",t,null,!0)},VST.Utils.fireScrollOnlyOnStop=function(){e(VST.scrollElement).unbind("scroll.vst");var n;e(VST.scrollElement).bind("scroll.vst",function(){clearTimeout(n),n=setTimeout(t,100)})};var n=!1;VST.Utils.pauseSelectionEventTriggering=function(){n=!0},VST.Utils.resumeSelectionEventTriggering=function(){n=!1},VST.Utils.selectionEventTriggeringIsPaused=function(){return n},VST.Utils.getSelectionObject=function(){return delete VST.selectionObject,VST.window&&VST.window.getSelection?VST.selectionObject=VST.window.getSelection():VST.document&&VST.document.selection&&(VST.selectionObject=VST.document.selection.createRange()),VST.selectionObject},VST.Utils.getRangeObject=function(e){if(null==e&&(e=VST.Utils.getSelectionObject()),!e)return null;if(e.getRangeAt)return e.rangeCount>0?e.getRangeAt(0):null;var t=VST.document.selection.createRange();return t?(t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset),t):null},VST.Utils.defaultGetSelectedTextHandler=function(){var e=VST.Utils.getSelectionObject(),t=(VST.document,VST.window,e);return e?(e.toString&&(t=e.toString()),"undefined"!=typeof e.text&&(t=e.text),t):""},VST.Utils.getSelectedText=function(){return VST.Handler.get("VST.Utils.getSelectedText",VST.Utils.defaultGetSelectedTextHandler)()},VST.Utils.calculateAjaxKey=function(t){var n=t.url;return t.dataType&&(n+=":"+t.dataType),t.data&&(n+=e.param(t.data)),n},VST.Utils.setDefaults=function(e,t){if(void 0!==t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},VST.Utils.getElementText=function(t){var n="";if(!t)return"";t.length&&(t=t.constructor===String?e(VST.document).find(t)[0]:t[0]);for(var o=0;o<t.childNodes.length;o++){var i=t.childNodes[o];3===i.nodeType?n+=i.nodeValue:1===i.nodeType&&("img"===i.nodeName.toLowerCase()&&(n+=i.alt||i.title),i.contentDocument?n+=VST.Utils.getElementText(i.contentDocument.body):/script|style|object/i.test(i.nodeName)||(n+=VST.Utils.getElementText(i)))}return n},VST.Utils.LESS_THAN=-1,VST.Utils.EQUAL=0,VST.Utils.GREATER_THAN=1,VST.Utils.stripCFIAssertions=function(e){return e.replace(/\[(.*?)[^\^]\]/g,"")},VST.Utils.compareCFIs=function(e,t){if(null==e&&(e=""),null==t&&(t=""),e=VST.Utils.stripCFIAssertions(e),t=VST.Utils.stripCFIAssertions(t),e=e.replace(/!$/,""),t=t.replace(/!$/,""),e===t)return VST.Utils.EQUAL;for(var n=/[\/@~:!]/,o=/(\[.+\]|[^\d])/g,i=e.split(n),r=t.split(n),s=0;;s++){var a=i[s],l=r[s];if(null==a&&null==l)return VST.Utils.EQUAL;if(null==a)return VST.Utils.LESS_THAN;if(null==l)return VST.Utils.GREATER_THAN;if(a!==l){if(a=parseFloat(a.replace(o,""),10),(l=parseFloat(l.replace(o,""),10))>a)return VST.Utils.LESS_THAN;if(a>l)return VST.Utils.GREATER_THAN}}},VST.Utils.installCallback=function(e){VST.Utils.callbackMap?++VST.Utils.callbackID:(VST.Utils.callbackMap={},VST.Utils.callbackID=1);var t=VST.Utils.callbackID;return VST.Utils.callbackMap[t]=e,t},VST.Utils.findCallback=function(e){return VST.Utils.callbackMap?VST.Utils.callbackMap[e]:void 0},VST.Utils.removeCallback=function(e){VST.Utils.callbackMap&&delete VST.Utils.callbackMap[e]},VST.Utils.fireCallback=function(e){var t=VST.Utils.findCallback(e);if(t){var n,o=[],i=arguments.length;for(n=1;i>n;++n)o.push(arguments[n]);t.apply(this,o),VST.Utils.removeCallback(e)}else VST.Logger.error("Callback id not found: "+e)},VST.Utils.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},VST.Utils.getQueryParam=function(e,t){for(var n=e.location.search.substring(1),o=n.split("&"),i=0;i<o.length;i++){var r=o[i].split("=");if(r[0]==t)return r[1]}};var o={};window.ifr=o,VST.Utils.multi=function(e,t,n,i){i=i||this;var r=e+":multi";o[e]?VST.once(r,function(e,t){n.apply(n,t)}):(o[e]=!0,t.call(i,function(){delete o[e],n.apply(i,arguments),VST.trigger(r,arguments)}))},VST.Utility=VST.Utils}.call(window,t),function(){this.VST.noop=function(){},this.VST.Handler={_handlers:[]},this.VST.Handler.get=function(e,t){return t=t||VST.noop,this._handlers[e]||t},this.VST.Handler.set=function(e,t){this._handlers[e]=t},this.VST.Handler.fire=function(e,t,n){return n=n||this,VST.Utils.isArray(t)?VST.Handler.get(e).apply(n,t):VST.Handler.get(e).call(n,t||VST.noop)}}.call(window),function(){VST.Logger={levels:{debug:0,info:1,warn:2,warning:2,error:3,ignore:4}};var e=[];for(var t in VST.Logger.levels)!function(t){"ignore"!==t&&(e.push(t),VST.Logger[t]=function(){var e=Array.prototype.slice.call(arguments);e.push(t),VST.log.apply(VST.log,e)})}(t);var n=new RegExp("^"+e.join("|")+"$");VST.log=function(){var e=Array.prototype.slice.call(arguments),t="info";if(e.length>1&&n.test(e[e.length-1])&&(t=e.pop()),VST.Logger.levels[t]>=VST.Settings.logLevel&&console&&console.log&&console.log.apply)try{return console.log.apply(console,e)}catch(e){}},VST.setLogLevel("error")}.call(window,t),function(){VST.Reader=function(e,t){this.name=e,this.version=t||"1.0",this.layoutStyle="scrolling"},VST.Reader.prototype.hasFeature=function(e){switch(e){case"mouse-events":case"keyboard-events":case"spine-scripting":case"touch-events":case"layout-changes":return!0;default:return!1}},VST.Reader.prototype.isOnline=function(){return/online/i.test(this.name)},VST.Reader.prototype.isDesktop=function(){return/desktop/i.test(this.name)}}.call(window),function(e){var t=function(e,t){this.mediaType=e,this.href=t};t.prototype.render=function(e,t){return t?this.replaceObjectTag(t,e):new n([this]).render(e)},t.prototype.replaceObjectTag=function(t,n){if(t){null==n&&(n=VST.document),t&&t.jquery&&(t=t[0]),n.jquery&&(n=n[0]),el=n.createElement("iframe"),el.style.width="100%",el.style.border="none",el.setAttribute("allowtransparency","true"),el.setAttribute("frameBorder","0"),el.setAttribute("class","vst-epub-binding"),el.onload=function(){try{this.style.height=e(this.contentDocument).height()+"px"}catch(e){}};var o=t.parentNode,i=t.getAttribute("data"),r=[];void 0!==i&&r.push("src="+i),r.push("type="+this.mediaType);for(var s=t.childNodes.length,a=0;s>a;a++){var l=t.childNodes[a];if("param"===l.nodeName.toLowerCase()){var c=l.getAttribute("name"),u=l.getAttribute("value");c&&u&&r.push(c+"="+u)}}var d=r.length>0?"?"+r.join("&"):"";return el.setAttribute("src",this.href+d),o.replaceChild(el,t),el}};var n=function(e){this.bindings=e||[];for(var n=this.bindings.length-1;n>=0;n--)this.bindings[n].render||(this.bindings[n]=new t(this.bindings[n].mediaType,this.bindings[n].href));this.bindingsMap={},this.length=e.length;for(var n=this.bindings.length-1;n>=0;n--)this.bindingsMap[this.bindings[n].mediaType]=this.bindings[n]};n.prototype.findBinding=function(e){return this.bindingsMap[e]},n.prototype.render=function(e){null==e&&(e=VST.document);for(var t=e.getElementsByTagName("object"),n=t.length-1;n>=0;n--){var o=this.findBinding(t[n].getAttribute("type"));void 0!==o&&o.render(e,t[n])}VST.fire("bindings:render")},VST.Models.Binding=t,VST.Models.BindingsCollection=n}.call(window,t),function(e){function t(e){this.pageBreakList=e,this.index=0}VST.Models.Book=function(t){t=t||{},VST.Logger.debug("here is what we know about the book: ",t);var n,o=t.isbn,i=t.author,r=t.title,s=t.copyLimit,a=t.printLimit,l=t.format||t.vbkType||"epub",c=t.hasPageBreaks||!1,u=t.isFixedLayout||!1,d=t.pathPrefix||"/books",h=t.apiPathPrefix||"/books",f=function(e){return e=e.replace(/^([^\/])/,function(e){return"/"+e}),e=e.replace(/\/+$/,""),e=e.indexOf(":isbn")>=0?e.replace(":isbn",o):[e,o].join("/")};d=f(d),h=f(h),this.getISBN=function(){return o},this.getAuthor=function(){return i},this.getTitle=function(){return r},this.getPathPrefix=function(){return d},this.dashlessISBN=function(){return this.getISBN().replace(/-/g,"")},this.hasPageBreaks=function(){return c},this.isFixedLayout=function(){return u},this.hasCopyLimit=function(){return this.getCopyLimit()>=0},this.getCopyLimit=function(){return void 0===s?0:parseInt(s)},this.hasPrintLimit=function(){return this.getPrintLimit()>=0},this.getPrintLimit=function(){return void 0===a?0:parseInt(a)},this.isEpub=function(){return/epub/i.test(l)},this.isPBK=function(){return/^p/i.test(l)},this.isDash=function(){return/dash/i.test(l)},this.getFormat=function(){return l},this.renderBindings=function(e){return n.render(e)},this.getBindings=function(){return n},this.setFixedLayout=function(e){u=e},this.setFixedLayoutDimensions=function(t){if(this.isFixedLayout()){null==t&&(t=VST.document),t=e(t);var n=t.find("meta[name=viewport]");if(0!=n.length){var o=n.attr("content"),i=o.match(/height=(\d+)/),r=o.match(/width=(\d+)/);if(i&&r){i=i[1],r=r[1];var s=t.find("html"),a=t.find("body");if(0==a.length||""!=a[0].style.width||""!=a[0].style.height)return;s.css({overflow:"auto"}),a.css({overflow:"hidden",height:i,width:r})}}}},this.setBindings=function(e){n=new VST.Models.BindingsCollection(e)};var g=function(e,t){var n=e.replace(/^\//,""),i=t.replace(/^\//,"");return 0===n.indexOf(i)||n.indexOf("books/"+o)>=0?e:[t,n].join("/")};this.buildURL=function(e){return g(e,d)},this.buildContentURL=this.buildURL,this.buildAPIURL=function(e){return g(e,h)},this.setBindings(t.bindings||[]),c&&this.setupPageBreaks()},VST.Models.Book.prototype.getTOC=function(e){VST.EventDispatcher.trigger("book:getTOC:before"),VST.Handler.fire("book:getTOC",e,this)},VST.Models.Book.prototype.setPages=function(e){this.pages=e},VST.Models.Book.prototype.getPages=function(e){VST.EventDispatcher.trigger("book:getPages:before"),VST.Handler.fire("book:getPages",e,this)},VST.Models.Book.prototype.getCurrentPageURL=function(){return VST.EventDispatcher.trigger("book:getCurrentPageURL:before"),VST.Handler.fire("book:getCurrentPageURL")},VST.Models.Book.prototype.goToNextPage=function(e){VST.EventDispatcher.trigger("book:goToNextPage:before"),VST.Handler.fire("book:goToNextPage",e,this)},VST.Models.Book.prototype.goToPreviousPage=function(e){VST.EventDispatcher.trigger("book:goToPreviousPage:before"),VST.Handler.fire("book:goToPreviousPage",e,this)},VST.Models.Book.prototype.getNextPage=function(e){VST.EventDispatcher.trigger("book:getNextPage:before"),VST.Handler.fire("book:getNextPage",e,this)},VST.Models.Book.prototype.getPageBreaks=function(e){VST.EventDispatcher.trigger("book:getPageBreaks:before"),VST.Handler.fire("book:getPageBreaks",e,this)},VST.Models.Book.prototype.sendActivityData=function(e,t){VST.Handler.fire("book:sendActivityData",[e,t],this)},VST.Models.Book.prototype.retrieveActivityData=function(e,t){VST.Handler.fire("book:retrieveActivityData",[e,t],this)},VST.Models.Book.prototype.reportScores=function(e,t){if(VST.Utils.isArray(e))for(var n=e.length-1;n>=0;n--)e[n]=new VST.Models.Score(e[n]);else e=new VST.Models.Score(e);VST.Handler.fire("book:reportScores",[e,t],this)},VST.Models.Book.prototype.reportScore=VST.Models.Book.prototype.reportScores,VST.Models.Book.prototype.getScores=function(e,t){var n=function(e,n){if(n&&n.length)for(var o=n.length-1;o>=0;o--)n[o]=new VST.Models.Score(n[o]);t(e,n)};VST.Handler.fire("book:getScores",[e,n],this)},VST.Models.Book.prototype.getScore=VST.Models.Book.prototype.getScores,VST.Models.Book.prototype.hideTOC=function(e){VST.EventDispatcher.trigger("book:hideTOC:before"),VST.Handler.fire("book:hideTOC",e,this)},VST.Models.Book.prototype.showTOC=function(e){VST.EventDispatcher.trigger("book:showTOC:before"),VST.Handler.fire("book:showTOC",e,this)},VST.Models.Book.prototype.getPreviousPage=function(e){VST.EventDispatcher.trigger("book:getPreviousPage:before"),VST.Handler.fire("book:getPreviousPage",e,this)},VST.Models.Book.prototype.getNextPageURL=function(e){VST.EventDispatcher.trigger("book:getNextPageURL:before"),VST.Handler.fire("book:getNextPageURL",e,this)},VST.Models.Book.prototype.getPreviousPageURL=function(e){VST.EventDispatcher.trigger("book:getPreviousPageURL:before"),VST.Handler.fire("book:getPreviousPageURL",e,this)},VST.Models.Book.prototype.getCurrentPage=function(e){VST.EventDispatcher.trigger("book:getCurrentPage:before"),VST.Handler.fire("book:getCurrentPage",e,this)},VST.Models.Book.prototype.hasNextPage=function(e){VST.Handler.fire("book:hasNextPage",e,this)},VST.Models.Book.prototype.hasPreviousPage=function(e){VST.Handler.fire("book:hasPreviousPage",e,this)},VST.Models.Book.prototype.contentDocForCFI=function(e,t){t&&this.getPages(function(n,o){var i;if(o&&o.length){for(var r=o.length-1;r>=0;r--)if(result=VST.Utils.compareCFIs(e,o[r].getCFI()),result===VST.Utils.GREATER_THAN||result===VST.Utils.EQUAL){i=o[r];break}t(null,i)}else t(new VST.Error("No pages found"))})},VST.Models.Book.prototype.pageForCFI=function(e,t){var n=function(e){return e.getAttribute("title")||e.textContent||e.innerText},o="";if(!e||!e.indexOf)return null;if(this.pageBreakList){for(var i=this.pageBreakList.length-1;i>=0;i--){var r=this.pageBreakList[i].cfi||"",s=VST.Utils.compareCFIs(e,r);if(s===VST.Utils.GREATER_THAN||s===VST.Utils.EQUAL)return this.pageBreakList[i]}return null}-1!==e.indexOf("!")&&(o=t+"!");for(var a,r,l,s,c=this.createPageBreakIterator(VST.document);a=c.nextNode();){if(r=o+(VST.sharedEpubModule.GetCFIForNode(a)||""),(s=VST.Utils.compareCFIs(e,r))===VST.Utils.LESS_THAN)return l?{title:n(c.previousNode()),cfi:l}:{title:n(a),cfi:r};if(s===VST.Utils.EQUAL)return{title:n(a),cfi:r};l=r}return null},VST.Models.Book.prototype.getHighlights=function(e){VST.EventDispatcher.trigger("book:getHighlights:before"),VST.Handler.fire("book:getHighlights",e,this)},VST.Models.Book.prototype.clearSelection=function(){var e=VST.window||window,t=VST.document||document;t.selection&&t.selection.empty?t.selection.empty():e.getSelection&&e.getSelection().removeAllRanges(),VST.fire("book:selectionCancelled")},VST.Models.Book.prototype.setupPageBreaks=function(){this.hasPageBreaks()&&!this.hasEPUB3PagebreakAttributes()&&this.getPageBreaks(null)},VST.Models.Book.prototype.hasEPUB3PagebreakAttributes=function(){var e=VST.document||document,t=this.createPageBreakIterator(e);return t&&null!=t.nextNode()},VST.Models.Book.prototype.setPageBreaks=function(e){this.pageBreakList=e};var n=function(e){this.currentNode=e;for(var t=-1,n=[],o=function(e){if(!e||1!==e.nodeType)return!1;for(var t=e.attributes.length-1;t>=0;t--)if("epub:type"==e.attributes[t].nodeName&&"pagebreak"==e.attributes[t].nodeValue)return!0;return!1},i=this.currentNode.getElementsByTagName("*"),r=0;r<i.length;r++)o(i[r])&&n.push(i[r]);this.nextNode=function(){return VST.Logger.debug("IE next node called"),t<n.length-1?(t++,this.currentNode=n[t],this.currentNode):void 0},this.previousNode=function(){return 0>t?null:0==t?(t--,this.currentNode=e,null):(t--,this.currentNode=n[t],n[t+1])}};t.prototype.doFindNodeForEntry=function(e){var t=(VST.window||window,VST.document||document),n=null;if(e.cfi){var o=VST.sharedEpubModule.locateCFI(e.cfi);o&&(n=o.node)}else if(e.fragment){if(/^epubcfi/.test(fragment)){var i=fragment.slice(8,fragment.length-1),o=VST.sharedEpubModule.locateCFI(i);o&&(n=o.node)}else if(!(n=t.getElementById(decodeURIComponent(fragment)))){var r=t.getElementsByName(fragment);r.length>0&&(n=r[0])}}else n=t.body;return n},t.prototype.findNode=function(e){var t=this.pageBreakList[e];return t.node||(t.node=this.doFindNodeForEntry(t)),t},t.prototype.titleForNode=function(e){var t=this.index;for(t>=this.pageBreakList.length&&(t=this.pageBreakList.length-1);t>=0;--t){var n=this.pageBreakList[t];if(n.node==e)return n.title}var o=this.pageBreakList.length;for(t=this.index;o>t;++t){var n=this.pageBreakList[t];if(n.node==e)return n.title}return null},t.prototype.nextNode=function(){if(this.index>=this.pageBreakList.length)return null;var e=this.findNode(this.index);return++this.index,e.node},VST.Models.Book.prototype.createPageBreakIterator=function(e,o){var i=o||e.body;if(!r)var r={SHOW_ELEMENT:1,FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3};if(e.createNodeIterator)var s=e.createNodeIterator(i,r.SHOW_ELEMENT,function(e){return"pagebreak"==e.getAttributeNS("http://www.idpf.org/2007/ops","type")?r.FILTER_ACCEPT:r.FILTER_REJECT},!1);else var s=new n(i);return this.pageBreakList&&(null!=s.nextNode()?s.previousNode():s=new t(this.pageBreakList)),this.pageBreakIterator=s,s},VST.Models.Book.prototype.isSelectionTooLong=function(e){var t=VST.window||window,n=VST.document||document,o=VST.Settings.wordsPerPage*e,i=VST.Utils.getSelectionObject();if(this.hasPageBreaks()&&t.getSelection&&i&&!i.isCollapsed&&i.rangeCount>0){for(var r=i.getRangeAt(0),s=r.commonAncestorContainer,a=this.createPageBreakIterator(n,s),l=0,c=null,u=r.cloneRange();c=a.nextNode();)if(u.selectNode(c),r.compareBoundaryPoints(Range.START_TO_START,u)<=0&&r.compareBoundaryPoints(Range.START_TO_END,u)>0&&++l>e)return!0;return!1}return VST.Utils.getSelectedText().split(/\s+/).length>o},VST.Models.Book.prototype.isSelectionTooLongForCopy=function(){if(!this.hasCopyLimit())return!1;var e=this.getCopyLimit();return 0==e||this.isSelectionTooLong(e)},VST.Models.Book.prototype.limitSelection=function(e,t){var n=VST.window||window,o=VST.document||document,i=VST.Settings.wordsPerPage*e,r=VST.Utils.getSelectionObject(),s=VST.Utils.getRangeObject();if(this.hasPageBreaks()){if(!n.getSelection){var a,l=this.createPageBreakIterator(o),c=o.body.createTextRange(),u=VST.Utils.getSelectionObject(),d=0;for(r.collapse(!0);a=l.nextNode();)if(c.moveToElementText(a),r.compareEndPoints("StartToStart",c)<=0){for(d++;r.compareEndPoints("EndToStart",c)<0&&r.compareEndPoints("EndToEnd",u)<0;)r.moveEnd("sentence",1);for(;1===r.compareEndPoints("EndToEnd",u)||1===r.compareEndPoints("EndToEnd",c);)r.moveEnd("word",-1);if(d>e)break}return this.clearSelection(),r.select(),window.select=r,window.iter=l,r.text}if(r&&!r.isCollapsed&&r.rangeCount>0){for(var h=0,a=null,f=s.cloneRange(),g=s.commonAncestorContainer,l=this.createPageBreakIterator(o,g);a=l.nextNode();)if(a.ownerDocument===o&&(f.selectNode(a),s.compareBoundaryPoints(Range.START_TO_START,f)<=0&&s.compareBoundaryPoints(Range.START_TO_END,f)>0&&++h>e)){s=s.cloneRange(),s.setEndBefore(a);break}return r.removeAllRanges(),r.addRange(s),r.toString()}}else{if(VST.Utils.getSelectedText().split(/\s+/).length<=i)VST.Logger.debug("acceptable "+t+" length");else if(VST.Logger.debug(t+" text too long"),r=VST.Utils.getSelectionObject(),r.collapseToStart&&r.modify){r.collapseToStart();for(var p=0;i>p;p++)r.modify("extend","forward","word")}else r.collapse(!0),r.moveEnd("word",i),this.clearSelection(),r.select()}return r.toString?r.toString():r.text},VST.Models.Book.prototype.handleCopy=function(e){var t=this.getCopyLimit();return 0==t?(VST.Logger.debug("copy not allowed"),e&&e.preventDefault(),!1):(this.hasCopyLimit()&&this.limitSelection(t,"copy"),this.appendBibliography(),!0)},VST.Models.Book.prototype.setBibliographicHTML=function(e){this.bibliographicInfo=e},VST.Models.Book.prototype.appendBibliographyHTML=function(t){var n=VST.window||window,o=VST.document||document,i=n.getSelection();if(i&&!i.isCollapsed&&i.rangeCount>0){if(e("#vst_newcopyelement_temp").length>0)return;var r=i.getRangeAt(0),s=e('<div id="vst_newcopyelement_temp" style="overflow:hidden;color:#000000;backgroundColor:transparent;textAlign:left;textDecoration:none;width:0.1;height:0.1"></div>',o);e(r.cloneContents()).appendTo(s);e("<div>"+t+"</div>",o).appendTo(s),s.appendTo(e(o.body));var a=o.createRange(),l=s.get(0);a.selectNode(l),i.removeAllRanges(),i.addRange(a),n.setTimeout(function(){l.parentNode.removeChild(l);var e=n.getSelection();e.removeAllRanges(),e.addRange(r)},0)}},VST.Models.Book.prototype.appendBibliography=function(){if(this.bibliographicInfo&&this.bibliographicInfo.length>0)this.appendBibliographyHTML(this.bibliographicInfo);else{var e=VST.sharedEpubModule.GetCFIRangeStringForSelection(),t=VST.Handler.fire("book:getBibliographyHTML",e,this);t&&t.length>0&&this.appendBibliographyHTML(t)}},VST.Models.Book.prototype.getPrintXMLForRange=function(t){var n=(VST.window||window,VST.document||document),o=null;if(t.cloneContents){var i=t.cloneContents(),r=n.createElement("html");n.head&&r.appendChild(n.head.cloneNode(!0));var s=n.body.cloneNode(!1);s.appendChild(i),r.appendChild(s);var a=e.browser.msie?"opacity:0.001;background-color:rgb(255,255,255);":"",l=e('<style type="text/css" media="print">#printUIBlocker { display:none; } </style>'),c=e('<iframe class="printUIBlocker" style="z-index:1000;border:none;margin:0;padding:0;position:absolute;width:100%;height:100%;top:0;left:0;opacity:0.0;" src="about:blank"></iframe>'),u=e('<div class="printUIBlocker" style="z-index:1001;border:none;margin:0;padding:0;width:100%;height:100%;top:0;left:0;position:fixed;'+a+'"></div>'),d=e(s);l.appendTo(d),c.appendTo(d),u.appendTo(d),e(r).find("script").remove(),o=(new XMLSerializer).serializeToString(r)}return o},VST.Models.Book.prototype.getPrintXMLForSelection=function(){var e=VST.window||window,t=VST.document||document,n=this.getPrintLimit();if(0==n)return VST.log("print not allowed"),null;if(this.hasPrintLimit()&&this.limitSelection(n,"print"),e.getSelection){var o=e.getSelection();if(o&&!o.isCollapsed&&o.rangeCount>0){var i=o.getRangeAt(0);return this.getPrintXMLForRange(i)}}else if(t.selection){var r=t.selection.createRange();return this.getPrintXMLForRange(r)}return null},VST.Models.Book.prototype.getPrintXMLForPageRange=function(e,t){var n=(VST.window||window,VST.document||document),o=n.createRange();if(o.selectNodeContents(n.body),e>=t&&t>=0)return null;if(0==e&&(e=-1),e>=0||t>=0)for(var i=this.createPageBreakIterator(n),r=null,s=0;(r=i.nextNode())&&!(s==e&&(o.setStartBefore(r),0>t));){if(s==t){o.setEndBefore(r);break}++s}return this.getPrintXMLForRange(o)},VST.Models.Book.prototype.getPrintSetupInfo=function(){var e=VST.window||window,t=VST.document||document,n={pageBreaks:new Array,currentPageIndex:0,hasSelection:!1,selectionStartIndex:null,selectionEndIndex:null,error:null};try{var o=this.createPageBreakIterator(t);this.hasPrintLimit()&&this.limitSelection(this.getPrintLimit(),"print");var i=null;if(e.getSelection){var r=e.getSelection();r&&!r.isCollapsed&&r.rangeCount>0&&(i=r.getRangeAt(0),n.selectionStartIndex=0,n.selectionEndIndex=0,n.hasSelection=!0)}var s=null,a=VST.sharedEpubModule.FindDOMNodeAndOffsetIntersectingViewportRect(t.body,{top:0,left:0,bottom:10,right:e.innerWidth}),l=null;a&&(l=t.createRange(),l.setStart(t.body,0),l.setEnd(a.node,a.offset));for(var c=0,u=t.createRange();s=o.nextNode();){u.selectNode(s),l&&l.compareBoundaryPoints(Range.START_TO_START,u)<=0&&l.compareBoundaryPoints(Range.START_TO_END,u)>0&&(n.currentPageIndex=c),i&&(u.compareBoundaryPoints(Range.START_TO_START,i)<=0?(n.selectionStartIndex=c,n.selectionEndIndex=c):u.compareBoundaryPoints(Range.END_TO_START,i)<0&&(n.selectionEndIndex=c)),++c;var d=null;o.titleForNode?d=o.titleForNode(s):(d=s.getAttribute("title"))||(d=s.textContent),n.pageBreaks.push(d)}}catch(e){n.error=e.message}return JSON.stringify(n)}}.call(window,t),function(e){VST.Models.Highlight=function(e){e=e||{};var t=e.book,n=e.offset,o=e.selectedText,i=e.cfi||e.CFI;e.id||e.sync_id,e.color,this.getBook=function(){return t},this.getOffset=function(){return n},this.getCFI=function(){return i},this.getSelectedText=function(){return o}},VST.Models.Highlight.Settings={highlightClass:"vsthighlight",noteIconClass:"vstnoteindicator"},VST.Models.Highlight.init=function(e,t){null==t&&(t=document),null==e&&(e=window),this.setupEventHandlers(e,t)},VST.Models.Highlight.setupEventHandlers=function(e,t){this.watchForSelection(e,t),this.watchHovers(e,t),this.watchForHighlightClicks(e,t)},VST.Models.Highlight.watchHovers=function(t,n){var o="."+VST.Models.Highlight.Settings.highlightClass;e(n).delegate(o,"mouseover",function(e){VST.fire(VST.Event.fromjQueryEvent("highlight:mouseover",e),this)}).delegate(o,"mouseout",function(e){VST.fire(VST.Event.fromjQueryEvent("highlight:mouseout",e),this)})},VST.Models.Highlight.watchForHighlightClicks=function(t,n){var o="."+VST.Models.Highlight.Settings.highlightClass,i=function(t){return e(t).hasClass(VST.Models.Highlight.Settings.noteIconClass)?"noteicon:click":"highlight:click"};navigator.epubReadingSystem&&navigator.epubReadingSystem.isDesktop()?e(n).delegate(o,"dblclick",function(e){VST.Book.clearSelection(),VST.fire(VST.Event.fromjQueryEvent(i(this),e),this)}):e(n).delegate(o,"click",function(e){VST.fire(VST.Event.fromjQueryEvent(i(this),e),this)})},VST.Models.Highlight.makeHighlightFromSelection=function(e){VST.Handler.fire("highlight:makeHighlightFromSelection",e,this)},VST.Models.Highlight.defaultSelectionHandler=function(e,t){t=t||{};var n;setTimeout(function(){var o=VST.Utils.getSelectedText();""===o?(n=VST.Event.fromjQueryEvent("book:selectionCancelled",e,t),VST.EventDispatcher.fire(n)):(n=VST.Event.fromjQueryEvent("book:selectionMade",e,t),VST.EventDispatcher.fire(n,o))},10)},VST.Models.Highlight.watchForSelection=function(t,n){var o,i=VST.Handler.get("selection",this.defaultSelectionHandler);e(n).delegate("body","mouseup",function(e){clearTimeout(o),i(e,{originalEventType:"mouseup"})}),e(n).keyup(function(e){i(e,{originalEventType:"keyup"})}),"ontouchstart"in t&&e(n).bind("selectionchange",function(e){o&&clearTimeout(o),o=setTimeout(function(){i(e,{originalEventType:"selectionchange"})},500)})}}.call(window,t),function(){VST.Models.Page=function(e){e=e||{};var t=e.title||e.page,n=e.path,o=e.url,i=e.linear,r=e.cfi,s=e.index||e.number,a=e.cfiWithoutAssertions,l=e.chapterTitle,c=document.createElement("a");c.href=n;var u=c.pathname;o&&(c.href=o,o=c.pathname),/^\//.test(u)||(u="/"+u),/^\//.test(o)||(o="/"+o),this.getPath=function(){return u},this.getURL=function(){return o},this.getTitle=function(){return t},this.getCFI=function(){return r},this.isLinear=function(){return null==i||i},this.getIndex=function(){return s},this.getCFIWithoutAssertions=function(){return a},this.getChapterTitle=function(){return l}}}.call(window,t),function(){var e=function(e){null==e&&(e={});for(key in e)this[key]=e[key];if("undefined"!=typeof this.location&&(this.location=this.location+""),"undefined"==typeof this.timestamp){var t,n=new Date;t=n.toISOString?n.toISOString():n.valueOf(),this.timestamp=t}for(var o=["score","maxscore"],i=o.length-1;i>=0;i--){var r=o[i];this[r]=Number(this[r]),isNaN(this[r])&&(this[r]=0)}};VST.Models.Score=e}.call(window,t),function(){VST.Models.User=function(){},VST.Models.User.prototype.hasBook=function(e,t){VST.Handler.fire("user:hasBook",[e,t],this)},VST.Models.User.prototype.getFirstName=function(e){VST.EventDispatcher.fireBefore("user:getFirstName"),VST.Handler.fire("user:getFirstName",e,this)},VST.Models.User.prototype.getLastName=function(e){VST.EventDispatcher.fireBefore("user:getLastName"),VST.Handler.fire("user:getLastName",e,this)},VST.Models.User.prototype.getFullName=function(e){VST.EventDispatcher.fireBefore("user:getFullName"),VST.Handler.fire("user:getFullName",e,this)},VST.Models.User.prototype.getInfo=function(e){VST.Handler.fire("user:getInfo",e,this)},VST.Models.User.prototype.books=function(e,t){VST.EventDispatcher.fireBefore("user:getBooks"),VST.Handler.fire("user:books",[e,t],this)},VST.Models.User.prototype.getBooks=VST.Models.User.prototype.books,VST.Models.User.prototype.getScoreURL=function(e){VST.EventDispatcher.fireBefore("user:getScoreURL"),VST.Handler.fire("user:getScoreURL",e,this)},VST.User=new VST.Models.User}.call(window,t)}.call(this,$),VST.$=$.noConflict(!0);var VSTEPUBModule=function(window,document){function logMessage(e){"undefined"!=typeof VST&&VST.Logger.info(e)}function logError(e){"undefined"!=typeof VST&&VST.Logger.error(e)}function EscapeCFIAssertion(e){return e.replace(/[\[\]\^\(\)\,\;]/g,"^$&")}function UnescapeCFIAssertion(e){return e.replace(/\^([\[\]\^\(\)\,\;])/g,"$1")}function ParseCFIAssertion(e){if("["!=e.charAt(0))return null;var t=e.search(/[^\^]\]/);return-1==t?null:{endOffset:t+2,
assert:UnescapeCFIAssertion(e.slice(1,t+1))}}function StripCFIAssertions(e){return e.replace(/\[(.*?)[^\^]\]/g,"")}function CreateNextNodeRegex(){return new RegExp("(?:\\/(\\d+))(?:(?:\\[(.*?[^\\^])\\])?)|(?:!)|(?:\\:(\\d+))|(?:@([\\d.]+):([\\d.]+))","g")}function TestCommand(command,expectedResult,testResults){var cmdObject=null;cmdObject="string"==typeof command?{test:function(){return eval(command)},title:command}:command;var result=cmdObject.test(),success=!0;if("string"==typeof expectedResult)result!=expectedResult?(testResults.TestFail("Test "+cmdObject.title+" failed",expectedResult,result),success=!1):(logMessage(cmdObject.title+" returned "+result+" as expected - YAY!"),testResults.TestSuccess());else for(expectedKey in expectedResult){var test=cmdObject.title+"."+expectedKey,actual=result[expectedKey],expected=expectedResult[expectedKey];actual!=expected?(testResults.TestFail("Test "+test+" failed",expected,actual),success=!1):(logMessage(test+" returned "+actual+" as expected - YAY!"),testResults.TestSuccess())}return success}function TestResults(){this.successCount=0,this.failCount=0,this.messages=[]}function TestCFIAssertionUtilities(e){TestCommand('EscapeCFIAssertion("abcd1234");',"abcd1234",e),TestCommand('EscapeCFIAssertion("test[some]^weird;(stuff),");',"test^[some^]^^weird^;^(stuff^)^,",e),TestCommand('UnescapeCFIAssertion("abcd1234");',"abcd1234",e),TestCommand('UnescapeCFIAssertion("test^[some^]^^weird^;^(stuff^)^,");',"test[some]^weird;(stuff),",e),TestCommand('ParseCFIAssertion("[test^[some^]^^weird^;^(stuff^)^,]/2/3/4[abcd1234]/1:3").assert',"test[some]^weird;(stuff),",e),TestCommand('var s = "[test^[some^]^^weird^;^(stuff^)^,]/2/3/4[abcd1234]/1:3"; s.slice(ParseCFIAssertion(s).endOffset)',"/2/3/4[abcd1234]/1:3",e),TestCommand('StripCFIAssertions("/2[test^[some^]^^weird^;^(stuff^)^,]/2/3/4[abcd1234]/1:3");',"/2/2/3/4/1:3",e)}function TestNextNodeRegex(e){var t=CreateNextNodeRegex(),n="/4/2/6[chapter02]/12[sec^[01^]]/2[test^[some^]^^weird^;^(stuff^)^,]/1:3",o=function(){var e;if(null!=(e=t.exec(n)))switch(e[0].charAt(0)){case"/":var o={};return o.targetIndex=parseInt(e[1]),e[2]&&(o.id=UnescapeCFIAssertion(e[2])),o;case":":return{offset:parseInt(e[3])}}return null};TestCommand({test:o,title:"testFindNextNode 1"},{targetIndex:"4"},e),TestCommand({test:o,title:"testFindNextNode 2"},{targetIndex:"2"},e),TestCommand({test:o,title:"testFindNextNode 3"},{targetIndex:"6",id:"chapter02"},e),TestCommand({test:o,title:"testFindNextNode 4"},{targetIndex:"12",id:"sec[01]"},e),TestCommand({test:o,title:"testFindNextNode 5"},{targetIndex:"2",id:"test[some]^weird;(stuff),"},e),TestCommand({test:o,title:"testFindNextNode 6"},{targetIndex:"1"},e),TestCommand({test:o,title:"testFindNextNode 7"},{offset:"3"},e)}function RunAutomatedTests(){var e=new TestResults;TestCFIAssertionUtilities(e),TestNextNodeRegex(e);var t=e.ResultSummary();window.console&&window.console.log&&window.console.log(t);var n=t+"\n"+e.JoinMessages();return window.alert(n),0==testResults.failCount}function IEVersion(){if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){if(document.documentMode)return document.documentMode;return new Number(RegExp.$1)}return null}function AdjustClientRect(e){if(!e)return null;if(IEVersion()>=8){var t=screen.deviceXDPI/screen.logicalXDPI,n=screen.deviceYDPI/screen.logicalYDPI;e.left/=t,e.top/=n,e.right/=t,e.bottom/=n}return e}function AdjustClientX(){return IEVersion()>=8&&(x/=screen.deviceXDPI/screen.logicalXDPI),x}function AdjustClientY(e){return IEVersion()>=8&&(e/=screen.deviceXDPI/screen.logicalXDPI),e}function ShowToolTipText(e,t){tooltip||(tooltip=document.createElement("div"),tooltip.setAttribute("class","vstskip"),window.VSTWindowController&&window.VSTWindowController.tooltipStyle?tooltip.setAttribute("style",window.VSTWindowController.tooltipStyle):tooltip.setAttribute("style","position:absolute; background:#FFFFAA; box-shadow: 2px 2px 5px #888; width: auto; display:none; font-family:sans-serif; font-size:9pt; padding: 2px; z-index:1000; color:black; font-weight:normal;"),document.body.appendChild(tooltip)),tooltip.style.width="auto",tooltip.innerHTML=t;var n=e.pageX+10,o=e.pageY+10;tooltip.style.top=o+"px",tooltip.style.left=n+"px",tooltip.style.display="block";var i=tooltip.offsetWidth;i>250&&(tooltip.style.width="250px",i=250),n+i>document.body.clientWidth&&(n=document.body.clientWidth-i,tooltip.style.left=n+"px"),currentToolTipGUID=null}function HideToolTip(){tooltip.style.display="none",currentToolTipGUID=null}function DoShowHighlightToolTip(e,t,n,o){if((t.length>0||n.length>0)&&currentToolTipGUID!=o){var i=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,"<br/>").replace(/[\n\r]/g,"<br/>"),r=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r\n/g,"<br/>").replace(/[\n\r]/g,"<br/>"),s="";i.length>0&&(s="<b>"+i+"</b>"),r.length>0&&(s.length>0&&(s+="<br/>"),s+=r),ShowToolTipText(e,s),currentToolTipGUID=o}}function ShowHighlightToolTip(e,t,n){if(window.VSTWindowController)if(window.VSTWindowController.noteTextForGUID){var o=window.VSTWindowController.noteTextForGUID(n),i="";window.VSTWindowController.markerInfoForGUID&&(i=window.VSTWindowController.markerInfoForGUID(n),window.VSTWindowController.currentMarkerInfo&&(i=window.VSTWindowController.currentMarkerInfo)),DoShowHighlightToolTip(e,o,i,n)}else window.VSTWindowController.showHighlightToolTipForGUIDAsync&&(window.VSTWindowController.showHighlightToolTipForGUIDCallback=function(t,o){DoShowHighlightToolTip(e,t,o,n)},window.VSTWindowController.showHighlightToolTipForGUIDAsync(n))}function HideHighlightToolTip(e,t){currentToolTipGUID==t&&HideToolTip()}function FindDocumentRoot(e){for(var t=e.firstChild;null!=t&&1!=t.nodeType;)t=t.nextSibling;return t}function CFILocation(e,t,n){this.node=e,this.document=t,n&&(this.offset=n),this.afterNode=!1}function InitFirstBodyNode(){sOriginalFirstBodyNode||(sOriginalFirstBodyNode=document.body.firstChild)}function DontHighlightMathML(){sDontHighlightMathML=!0}function NodeHasClass(e,t){if(e.className){var n=t?new RegExp("\\b"+t+"\\b"):null;return e.className.baseVal?n.test(e.className.baseVal):n.test(e.className)}return!1}function NodeIsHighlightSpan(e){return e&&1==e.nodeType&&NodeHasClass(e,"vstignore")}function NodeShouldBeSkipped(e){if(e&&1==e.nodeType){if(NodeHasClass(e,"vstskip"))return!0;if(NodeHasClass(e,"vstignore")&&!e.hasChildNodes())return!0}return!1}function NodeChildrenShouldBeSkipped(e){if(e&&1==e.nodeType){if(NodeHasClass(e,"vstdonthighlight"))return!0;if(sDontHighlightMathML){if("http://www.w3.org/1998/Math/MathML"==e.namespaceURI&&"math"==e.localName)return!0;if("http://www.w3.org/2000/svg"==e.namespaceURI&&"svg"==e.localName)return!0;if(NodeHasClass(e,"MathJax"))return!0}}return!1}function IsNodeInSkippedSubtree(e,t){for(var n=e;n;){if(NodeShouldBeSkipped(n))return!0;if(n!=e&&NodeChildrenShouldBeSkipped(e))return!0;if(t)return t(e);n=n.parentNode}return!1}function FindFirstLegalAncestor(e){for(var t=e,n=e,o=!1;n;)NodeShouldBeSkipped(n)?o=!0:NodeChildrenShouldBeSkipped(n)?(t=n,o=!1):o&&9!=n.nodeType&&(t=n,o=!1),n=n.parentNode;return o&&(t=null),t}function CFIDOMWalker(e,t,n){n||(n=e.ownerDocument),this.Initialize(e,t,n)}function CreateCFIDOMWalkerForChildren(e,t){var n=new CFIDOMWalker(e,0,t);return null==n.node?null:(n.WalkChildren(),n)}function FindParentNode(e){for(var t=e.parentNode;t&&NodeIsHighlightSpan(t);)t=t.parentNode;return t&&9==t.nodeType&&(t=null),t}function IsTextNode(e){if(!e)return!1;var t=e.nodeType;return 3===t||4===t||5===t}function walkCFISubpath(e,t){for(var n,o=CreateNextNodeRegex();null!=(n=o.exec(t));){var i=e.node,r=e.document;switch(n[0].charAt(0)){case"/":var s=parseInt(n[1]),a=null,l=null;if(e.WalkChildren(),e.FindNodeAtIndex(s),n[2]&&(a=UnescapeCFIAssertion(n[2]),l=r.getElementById(a),e.node!==l&&(e.node=l,l)))break;if(e.index!=s||!e.node){var c=o.lastIndex,u=!0;null!=(n=o.exec(t))&&(u=!1);var d=new CFILocation(i,r);if(e.node?s<e.index&&(d.node=e.node):(s!=e.index+1&&(u=!1),d.afterNode=!0),!u){for(var h="",f=0;c>f;++f)h+=" ";d.error="child not found: "+t}return d}break;case"!":if(!e.WalkContentDocumentChildren()){var d=new CFILocation(i,r);return d.error="iframe reference child not found: "+t,d}break;case":":if(e.CurrentNodeIsText()){var g=parseInt(n[3]),d=e.FindNodeAtOffset(g);return d||(logError("Could not find offset "+g+" in cfi "+t),d=new CFILocation(i,r),d.error="Could not find offset "+g+" in cfi "+t),d}break;case"@":var d=new CFILocation(e.node,e.document);return d.posX=parseFloat(n[4]),d.posY=parseFloat(n[5]),d;default:logError("programming error - unknown match "+n[0]+" in "+t)}}var d=new CFILocation(e.node,e.document);return d}function locateCFISubpathFromNode(e,t,n){return walkCFISubpath(new CFIDOMWalker(t,0,n),e)}function locateCFI(e){var t=FindDocumentRoot(document);return t?locateCFISubpathFromNode(e,t,document):(logError("Error- no root node"),null)}function ScrollToLocation(e,t){var n=t||VST.scrollElement;if(e.node){var o=e.node,i=o.ownerDocument;if(!i)return null;var r=i.defaultView||i.parentWindow,s=null;if(null!=e.offset||1!=o.nodeType){var a=i.createRange(),l=0;null!=e.offset&&(l=e.offset),l>0&&o.nodeValue.length>0&&l>=o.nodeValue.length&&(l=o.nodeValue.length-1),a.setStart(o,l),a.setEnd(o,Math.max(0,Math.min(o.nodeValue.length-1,l+1)));var c=a.getClientRects();c.length>0&&(s=AdjustClientRect(c[0]))}for(;!s&&o;){if(null!=o.getClientRects){var c=o.getClientRects();c.length>0&&(s=AdjustClientRect(c[0]))}s||(o=o.parentNode)}if(s){var u=s.left+r.pageXOffset,d=s.top+r.pageYOffset;null!=e.posX&&(u+=e.posX),null!=e.posY&&(d+=e.posY),t?t.scrollTo?t.scrollTo(u,d):(t.scrollTop=d,t.scrollLeft=u):n.scrollTo?n.scrollTo(u,d):(n.scrollTop=d,n.scrollLeft=u);try{if(!VST.scrollElement.nodeName)for(;r&&r!=n;){var h=r.parent,f=r.frameElement;if(!h||!f)break;var g=f.getBoundingClientRect();g=AdjustClientRect(g),u-=r.pageXOffset,d-=r.pageYOffset,u+=g.left+h.pageXOffset,d+=g.top+h.pageYOffset,h.scrollTo(u,d),r=h}}catch(e){VST.Logger.debug("exception caught when scrolling",e)}}}}function ScrollToCFI(e,t,n,o){if(o=void 0===o||o,sScrollToCFIPaused){var i=e,r=n||VST.scrollElement;return VST.Logger.info("Saving CFI "+i+" to scroll later"),sSavedCFIScroll=function(){VST.Logger.info("resuming scrolling, scrolling to "+i),ScrollToCFI(i,null,r)},void(t&&sCFIScrollCompletion.push(t))}var s=locateCFI(e);if(s){ScrollToLocation(s,n);var a=s.node;a&&(IsTextNode(a)&&(a=a.parentNode),a&&a.setAttribute&&a.focus&&(a.getAttribute("tabindex")||(a.setAttribute("tabindex","0"),setTimeout(function(){a.removeAttribute("tabindex")},2500)),o&&a.focus()))}t&&t()}function PauseScrollToCFI(){VST.Logger.info("pausing scroll to CFI"),sScrollToCFIPaused=!0}function ResumeScrollToCFI(){if(sScrollToCFIPaused&&(sScrollToCFIPaused=!1,sSavedCFIScroll&&(sSavedCFIScroll(),sSavedCFIScroll=null,sCFIScrollCompletion.length>0))){var e,t=sCFIScrollCompletion.length;for(e=0;t>e;++e)sCFIScrollCompletion[e]();sCFIScrollCompletion=new Array}}function NodeStackForLocation(e,t){if(!t||!t.node||t.error)return null;var n=new Array;if(n.push(t),t.node!=e)for(var o=t.node.parentNode,i=t.document;null!=o&&o!=e;){var r=new CFILocation(o,i);n.push(r),o=o.parentNode}return n}function FindHighlightGUIDInClassString(e){var t;return null!=(t=e.match(/\bhighlight_([^\ ]+)\b/))?t[1]:null}function CreateHighlightSpan(e,t,n){var o=e.createElement("span");if(o.setAttribute("style","background-color:"+t),n&&n.length>0){o.className="vsthighlight vstignore "+n;var i=FindHighlightGUIDInClassString(n);i&&(o.onmouseover=function(e){ShowHighlightToolTip(e,this,i)},o.onmouseout=function(){HideHighlightToolTip(this,i)})}else o.className="vsthighlight vstignore";return o}function CreateNoteSpan(e,t,n){var o=e.createElement("span");return o.className="vstnoteindicator vstskip "+n,o}function SplitTextLocation(e){if(e&&1!=e.node.nodeType&&null!=e.offset&&e.offset>0){for(var t=e.offset,n=e.node,o=n.nodeValue,i=e.document;t>=o.length;){do{var r=n;if(!(n=n.nextSibling)){var s=new CFILocation(r,i);return s.afterNode=!0,s}if(1==n.nodeType){var s=new CFILocation(n,i,0);return s}}while(n.nodeType<3||n.nodeType>5);t-=o.length,o=n.nodeValue}var a=n.parentNode,l=o.slice(0,t),c=o.slice(t),u=i.createTextNode(c);a.insertBefore(u,n.nextSibling),n.nodeValue=l,n=u;var s=new CFILocation(n,i,0);return s}return e}function AllowHighlightingSpanInNode(e){var t=!0;if("http://www.w3.org/1998/Math/MathML"==e.namespaceURI){var n=e.localName;"mtext"!=n&&"mi"!=n&&"mn"!=n&&"mo"!=n&&(t=!1)}else{var n=e.localName||e.nodeName;("table"==(n=n.toLowerCase())||"tr"==n||"thead"==n||"tbody"==n||"tfoot"==n||"colgroup"==n||"col"==n)&&(t=!1)}return t}function DoCreateHighlightsInNodeRange(e,t,n,o,i,r,s){if(!IsNodeInSkippedSubtree(n))for(var a=null,l=e,c=s,u=AllowHighlightingSpanInNode(n);l!=t&&null!=l;){var d=l.nextSibling;if(1==l.nodeType)a=null,DoCreateHighlightsInNodeRange(l.firstChild,null,l,o,i,r);else if(u&&l.nodeType>=3&&l.nodeType<=5){if(null==a&&l.nodeValue.length>0&&(a=CreateHighlightSpan(o,i,r),n.insertBefore(a,l),c)){var h=noteIconHandler(o,i,r);n.insertBefore(h,a),c=!1}a&&(a.appendChild(l),l==sOriginalFirstBodyNode&&(sOriginalFirstBodyNode=a))}l=d}}function HighlightDOMLocationStacks(e,t,n,o,i){var r=e&&e.length>0?e.pop():null,s=t&&t.length>0?t.pop():null;if(r||s){var a=r?r.document:s.document,l=r?r.node:null,c=s?s.node:null,u=l?l.parentNode:c.parentNode;if(!u)return void logError("HighlightDOMLocationStacks- parent node is null");if(!IsNodeInSkippedSubtree(u)){var d=e&&e.length>0?e:null,h=t&&t.length>0?t:null;r=SplitTextLocation(r),s=SplitTextLocation(s);var l=null,c=null;if(!r||(l=r.node,!r.afterNode||(l&&(l=l.nextSibling),l))){if(s&&(c=s.node)&&s.afterNode&&(c=c.nextSibling),l||(l=u.firstChild),!l&&!c)return void logError("HighlightDOMLocationStacks- beginNode and endNode are both null");if(l==c)(d||h)&&HighlightDOMLocationStacks(d,h,n,o,i);else{var f=l;d&&(f=f.nextSibling),DoCreateHighlightsInNodeRange(f,c,u,a,n,o,i&&!d),d&&HighlightDOMLocationStacks(d,null,n,o,i),h&&HighlightDOMLocationStacks(null,h,n,o,!1)}}}}}function CFIRangeNode(e,t,n,o,i,r){this.basePath=e.split("!").reverse()[0],this.begin=t,this.end=n,this.color=o,this.additionalClass=i,this.hasNote=r}function exitContentRange(){VST.contentRangeBundle&&(VST.contentRangeBundle.map(function(e){try{e&&e.show()}catch(e){}}),VST.contentRangeBundle=[])}function CFIRangeTreeNode(e,t){this.basePath=e,this.children=t}function TestHighlightCFIRange(e,t,n,o,i,r){o||(o="yellow"),new CFIRangeNode(e,t,n,o,i,r).Highlight(FindDocumentRoot(document),document)}function UnhighlightAll(e){function t(e,t){var n,o=document.getElementsByClassName(e),i=o.length;for(n=0;i>n;++n){var r=o[n];r&&r.className&&("vsthighlight tombstone vstignore"==r.className||t&&!NodeHasClass(r,t)||(r.removeAttribute("style"),r.className="vsthighlight tombstone vstignore"))}}t("vsthighlight",e),t("vstnoteindicator",e)}function BuildHighlightRangeTreeLevel(e,t,n,o){var i,r=new Array,s=t.length;for(i=0;s>i;++i){var a=t[i];if("string"==typeof a);else{var l=a.base,c=a.color?a.color:n,u=a.additionalClass?a.additionalClass:o;if(null!=a.children){var d=BuildHighlightRangeTreeLevel(l,a.children,c,u);r.push(d)}else{var h=a.begin,f=a.end,d=new CFIRangeNode(l,h,f,c,u,a.hasNote);r.push(d)}}}return new CFIRangeTreeNode(e,r)}function BuildHighlightRangeTree(e,t,n){return BuildHighlightRangeTreeLevel("",e,t,n)}function HighlightRanges(e,t,n){BuildHighlightRangeTree(e,t,n).Highlight(FindDocumentRoot(document),document)}function TestHighlightRanges(){HighlightRanges([{base:"/4/2/30/2/1",begin:":3",end:":10"},{base:"/4/2/30/4/1",begin:":0",end:":5",hasNote:!0}],"yellow","search"),HighlightRanges([{base:"/4/2/32",children:[{base:"/2",begin:"/1:0",end:"/1:10",hasNote:!0},{base:"/4",begin:"/1:10",end:"/1:16",color:"red",hasNote:!0}],color:"yellowgreen"},{base:"/4/2/34",begin:"/2/1:0",end:"/2/1:3",hasNote:!0}],"lightblue","other")}function HideElement(e){var t=document.createElement("div");e.parentNode.insertBefore(t,e),t.appendChild(e),t.setAttribute("style","display:none"),t.className="vstignore"}function ProcessEPUBSwitches(e){var t,n={},o=e.length;for(t=0;o>t;++t)n[e[t]]=!0;var i,r=document.getElementsByTagNameNS("http://www.idpf.org/2007/ops","switch"),s=r.length;for(i=0;s>i;++i)for(var a=r[i],l=a.firstChild,c=!1;l;){if("http://www.idpf.org/2007/ops"==l.namespaceURI)if("case"==l.localName)if(c)HideElement(l);else{var u=l.getAttribute("required-namespace");u.length>0&&n[u]&&(c=!0),c||HideElement(l)}else"default"==l.localName&&c&&HideElement(l);l=l.nextSibling}}function BeginMathJaxLayout(){PauseScrollToCFI()}function EndMathJaxLayout(){if(!sSavedCFIScroll){var e=window.location.hash;if(e&&("#"==e.charAt(0)&&(e=e.slice(1)),e.length>0&&!/^epubcfi/.test(e))){var t=document.getElementById(e);if(!t){var n=document.getElementsByName(e);n.length>0&&(t=n[0])}if(t){ScrollToLocation(new CFILocation(t,document))}}}ResumeScrollToCFI()}function LoadMathJax(e,t){if(0!=document.getElementsByTagNameNS("http://www.w3.org/1998/Math/MathML","math").length){InitFirstBodyNode(),DontHighlightMathML(),null==t&&(t="VSTEPUBModule.ConfigMathJax(); MathJax.Hub.Startup.onload();");var n=document.createElement("script");n.type="text/x-mathjax-config",window.opera?n.innerHTML=t:n.text=t;var o=document.createElement("script");o.type="text/javascript",o.src=e;var i=document.getElementsByTagName("head")[0];i.appendChild(n),i.appendChild(o),BeginMathJaxLayout()}}function ConfigMathJax(){MathJax.Hub.Config({jax:["input/TeX","input/MathML","input/AsciiMath","output/CommonHTML"],extensions:["tex2jax.js","mml2jax.js","asciimath2jax.js","MathMenu.js","MathZoom.js","AssistiveMML.js"],TeX:{extensions:["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]},showMathMenu:!1}),MathJax.Hub.Register.StartupHook("End Typeset",function(){EndMathJaxLayout()})}function GetCFIForNode(e,t,n){for(var o="",i=e;NodeIsHighlightSpan(i);)i=FindParentNode(i);for(;i;){var r=FindParentNode(i);if(r){var s=CreateCFIDOMWalkerForChildren(r);if(!s)break;for(var a=0;;){if(s.node==i){var l=s.index,c="";if(n)++l,n=!1;else{if(s.CurrentNodeIsText()){if(o.length>0)return logError("Error: found text node not at the root of a CFI"),null;a+=t,o="/"+l+":"+a;break}if(s.node.getAttribute){var u=s.node.getAttribute("id");u&&u.length>0&&(c="["+EscapeCFIAssertion(u)+"]")}}o="/"+l+c+o;break}if(s.CurrentNodeIsText()?a+=s.node.nodeValue.length:s.CurrentNodeIsElement()&&(a=0),null==s.NextNode())return logError("Error: Node "+i+" not found. Partial CFI found: "+o),null}}i=r}return o}function InterpretRangeEndpoint(e,t,n){var o=!1,i=0,r={};if(t>0)switch(e.nodeType){case 1:t<e.childNodes.length?e=e.childNodes[t]:e.childNodes.length>0&&(e=e.childNodes[e.childNodes.length-1],o=!0);break;case 3:case 4:case 5:i=t}var s=FindFirstLegalAncestor(e);return s!=e&&(r.legalAncestor=s,r.originalNode=e,e=s,i=0,o=!n),r.node=e,r.textOffset=i,r.afterNode=o,r}function GetCFIForRangeEndpoint(e,t,n){var o=InterpretRangeEndpoint(e,t,n);return GetCFIForNode(o.node,o.textOffset,o.afterNode)}function IsLegalHighlightRange(e){if(e.collapsed)return!1;var t=InterpretRangeEndpoint(e.startContainer,e.startOffset,!1),n=InterpretRangeEndpoint(e.endContainer,e.endOffset,!0);return!(t.legalAncestor&&n.legalAncestor&&t.legalAncestor==n.legalAncestor)}function HasHighlightableSelection(){if(window.getSelection){var e=window.getSelection();if(e&&e.rangeCount>0){var t=e.getRangeAt(0);if(t)return IsLegalHighlightRange(t)}}else if(document.selection){var t=document.selection.createRange();if(t){var n=getTextRangeStartContainer(t),o=getTextRangeEndContainer(t);return t.startContainer=n.container,t.startOffset=n.offset,t.endContainer=o.container,t.endOffset=o.offset,IsLegalHighlightRange(t)}}return!1}function FindRangeWithCommonBase(e,t){for(var n,o,i=CreateNextNodeRegex(),r=CreateNextNodeRegex(),s=0,a=0;;){var n=i.exec(e),o=r.exec(t),l=!1;if(n&&o&&n[0]==o[0]&&(l=!0),!l)return{base:e.slice(0,s),begin:e.slice(s),end:t.slice(a)};s=i.lastIndex,a=r.lastIndex}return{base:e,begin:"",end:""}}function GetCFIRangeForSelection(){var e=null;if(window.getSelection){var t=window.getSelection();if(t&&t.rangeCount>0){var n=t.getRangeAt(0);if(n&&IsLegalHighlightRange(n)){var o=GetCFIForRangeEndpoint(n.startContainer,n.startOffset,!1),i=GetCFIForRangeEndpoint(n.endContainer,n.endOffset,!0);e=FindRangeWithCommonBase(o,i)}}}else if(document.selection){var n=document.selection.createRange();if(n)var r=getTextRangeStartContainer(n),s=getTextRangeEndContainer(n),o=(n.parentElement().innerText.indexOf(n.text),GetCFIForRangeEndpoint(r.container,r.offset,!1)),i=GetCFIForRangeEndpoint(s.container,s.offset,!0),e=FindRangeWithCommonBase(o,i)}return e}function getTextRangeStartContainer(e){var t=e.duplicate(),n=e.duplicate();t.collapse(!0),t.moveEnd("character",1);var o=t.parentElement();n.moveToElementText(o),n.setEndPoint("EndToEnd",t);for(var i=n.text,r=null,s=n.text.length,a=o.firstChild;a;a=a.nextSibling)if(3==a.nodeType){var l=a.nodeValue,c=i.indexOf(l);if(0!=c||i==l){r=a;break}i=i.substring(l.length),s-=l.length}else s-=a.innerText.length;return{container:r,offset:s-1}}function getTextRangeEndContainer(e){var t=e.duplicate(),n=e.duplicate();t.collapse(!1),t.moveStart("character",t.text.length);var o=t.parentElement();return n.moveToElementText(o),n.setEndPoint("StartToStart",t),getTextRangeStartContainer(n)}function IsPointInHighlightableSelectedText(e,t){if(window.getSelection){var n=window.getSelection();if(n&&n.rangeCount>0){var o=n.getRangeAt(0);if(o&&IsLegalHighlightRange(o)){var i,r=o.getClientRects(),s=r.length;for(i=0;s>i;++i){var a=AdjustClientRect(r.item(i));if(e>=a.left&&e<=a.right&&t>=a.top&&t<=a.bottom)return!0}}}}else if(document.selection)var o=document.selection.createRange();return!1}function ClearSelection(){if(window.getSelection){var e=window.getSelection();e&&e.removeAllRanges()}else document.selection&&document.selection.empty()}function TestHighlightSelection(e){var t=GetCFIRangeForSelection();e||(e="lightblue"),logMessage("Highlighting ("+t.base+", "+t.begin+", "+t.end+")"),HighlightRanges([t],e,"test"),ClearSelection()}function GetCFIRangeStringForSelection(){var e=GetCFIRangeForSelection();return e?e.base+","+e.begin+","+e.end:""}function GetSelectionText(){if(window.getSelection){var e=window.getSelection();if(e)return e.toString()}else document.selection;return""}function GetSpeechText(){function e(t){var n="";if(t.getSelection){var o=t.getSelection();if(o&&(n=o.toString()),0==n.length){var i=t.frames;if(i){var r,s=i.length;for(r=0;s>r&&(n=e(i[r]),0==n.length);++r);}}}else document.selection;return n}var t=e(window);return 0==t.length&&VST&&VST.Utils&&(t=VST.Utils.getElementText(document.body)),t}function HighlightGUIDForNode(e){for(var t=e;t;){if(1==e.nodeType){var n=FindHighlightGUIDInClassString(e.className);if(n)return n}t=t.parentNode}return null}function HighlightGUIDForPoint(e,t){return HighlightGUIDForNode(document.elementFromPoint(e,t))}function FindDOMNodeAndOffsetIntersectingViewportRect(e,t,n,o){function i(e,t){return Math.max(e.top,t.top)<Math.min(e.bottom,t.bottom)&&Math.max(e.left,t.left)<Math.min(e.right,t.right)}function r(e,t){var n,o=e.getClientRects(),r=o.length;for(n=0;r>n;++n)if(i(AdjustClientRect(o[n]),t))return!0;return!1}function s(e,t){var n=VST.Utils.getRangeObject();if(!n||!n.setStart)return null;var o=0,i=e.length;if(n.setStart(e,0),n.setEnd(e,i),!r(n,t))return null;for(o=0;i>o;++o)if(n.setStart(e,o),n.setEnd(e,o+1),r(n,t))return{node:e,offset:o};return null}function a(e,t){var n=((e.left-t.left)/(t.right-t.left)*100).toPrecision(3),o=((e.top-t.top)/(t.bottom-t.top)*100).toPrecision(3);return isNaN(n)&&(n=0),isNaN(o)&&(o=0),n>100&&(n=100),0>n&&(n=0),o>100&&(o=100),0>o&&(o=0),{positionX:n,positionY:o}}var l,c=e,u=e.childNodes,d=u.length;for(l=0;d>l;++l){var h=u[l];if(!(IsTextNode(h)&&n||IsNodeInSkippedSubtree(h,o)))if(IsTextNode(h)){var f=s(h,t);if(f)return f}else if(1==h.nodeType){var g=h.getBoundingClientRect();if(i(g,t)){var f=FindDOMNodeAndOffsetIntersectingViewportRect(h,t,n);if(f)return f;var p=a(t,g);return{node:h,positionX:p.positionX,positionY:p.positionY}}g.top<=t.top&&(c=h)}}if(c){var g=c.getBoundingClientRect(),p=a(t,g);return{node:c,positionX:p.positionX,positionY:p.positionY}}return null}function GetNodeForScreenY(e,t,n){return GetNodeForScreen(0,e,t,n)}function GetNodeForScreen(e,t,n,o){var i={top:t+25,left:e,bottom:t+50,right:window.innerWidth},r=FindDOMNodeAndOffsetIntersectingViewportRect(document.body,i,n,o);return r?r.node:null}function GetNodeForCurrentScrollPosition(e,t){return VST.scrollElement!==VST.window?GetNodeForScreenY(VST.scrollElement.scrollTop,e,t):GetNodeForScreenY(0,e,t)}function GetCFIForScreenY(e,t){return GetCFIForScreen(0,e,t)}function GetCFIForScreen(e,t,n){var o={top:t,left:e,bottom:t+50,right:window.innerWidth},i=FindDOMNodeAndOffsetIntersectingViewportRect(document.body,o,!0,n);if(i){if(null!=i.offset)return GetCFIForRangeEndpoint(i.node,i.offset);var r=GetCFIForRangeEndpoint(i.node,0);return null!=i.positionX&&null!=i.positionY&&(r=r+"@"+i.positionX+":"+i.positionY),r}return null}function GetCFIForCurrentScrollPosition(e){return VST.scrollElement!==VST.window?GetCFIForScreenY(VST.scrollElement.scrollTop,e):GetCFIForScreenY(0,e)}function GetCFIForPoint(e,t){return GetCFIForScreen(e,t)}function GetChapterOffsetForCurrentScrollPosition(){var e=GetNodeForCurrentScrollPosition(!0);if(!e)return null;var t;if(t=e.getAttribute("o"))return parseInt(t,10);for(;e=e.parentNode;)if(t=e.getAttribute("o"))return t;return null}function Init(e){e||(e={mathJaxURL:"http://cdn.mathjax.org/mathjax/latest/MathJax.js"});try{ProcessEPUBSwitches(["http://www.w3.org/1998/Math/MathML"])}catch(e){}if(e.mathJaxURL)try{LoadMathJax(e.mathJaxURL,e.mathJaxConfig)}catch(e){}e.noteIconHandler&&(noteIconHandler=e.noteIconHandler);try{if(!e.skipNoteCSS){var t=document.createElement("style");t.innerHTML=".vstnoteindicator          { float: right; width: 16px; height: 16px; background: transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAACXBIWXMAAAsTAAALEwEAmpwYAAAABGdBTUEAANjr9RwUqgAAACBjSFJNAABuJwAAc68AAPY3AACApQAAcCMAAN0CAAAwPgAAFrLOXXcKAAADAFBMVEXbyAfVyo7+/v794CD/7Tr42Q7NrFGrog798wz///8KCgoLCwsMDAwNDQ0ODg4PDw8QEBARERESEhITExMUFBQVFRUWFhYXFxcYGBgZGRkaGhobGxscHBwdHR0eHh4fHx8gICAhISEiIiIjIyMkJCQlJSUmJiYnJycoKCgpKSkqKiorKyssLCwtLS0uLi4vLy8wMDAxMTEyMjIzMzM0NDQ1NTU2NjY3Nzc4ODg5OTk6Ojo7Ozs8PDw9PT0+Pj4/Pz9AQEBBQUFCQkJDQ0NERERFRUVGRkZHR0dISEhJSUlKSkpLS0tMTExNTU1OTk5PT09QUFBRUVFSUlJTU1NUVFRVVVVWVlZXV1dYWFhZWVlaWlpbW1tcXFxdXV1eXl5fX19gYGBhYWFiYmJjY2NkZGRlZWVmZmZnZ2doaGhpaWlqampra2tsbGxtbW1ubm5vb29wcHBxcXFycnJzc3N0dHR1dXV2dnZ3d3d4eHh5eXl6enp7e3t8fHx9fX1+fn5/f3+AgICBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJydnZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+wsLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7////pEhBPAAAACnRSTlP///////////8AsswszwAAAE9JREFUeNqsjzkSgDAMxDYDtnb//2GKcARqZDfWqLHyQWkWOgp2XWuiULbnWVN44QdRL7G5RBR2zxHwKrAZUTiDwnSeogQ9EqVvxvz2wzEAF6QHkH6VgZIAAAAASUVORK5CYII=) no-repeat top right; }";var n=document.createElement("style");n.innerHTML="span.vsthighlight { display:inline !important; font-family: inherit !important; font-style: inherit !important; font-size: inherit !important; font-weight: inherit !important; width:auto !important; color:inherit !important; }";var o=document.getElementsByTagName("head")[0];o.appendChild(t),o.appendChild(n)}}catch(e){}}TestResults.prototype.TestFail=function(e,t,n){this.failCount+=1,e&&this.AddErrorMessage(e),t&&(this.AddErrorMessage("Expected: "+t),n?this.AddErrorMessage("Actual: "+n):this.AddErrorMessage("Actual: (null)"))},TestResults.prototype.TestSuccess=function(e){this.successCount+=1,e&&this.AddMessage(e)},TestResults.prototype.AddMessage=function(e){this.messages.push(e),logMessage(e)},TestResults.prototype.AddErrorMessage=function(e){this.messages.push(e),logError(e)},TestResults.prototype.JoinMessages=function(){return this.messages.join("\n")},TestResults.prototype.ResultSummary=function(){return"Succeeded: "+this.successCount+"; Failed: "+this.failCount};var currentToolTipGUID=null,tooltip=null;CFILocation.prototype.toString=function(){var e="CFILocation, node: "+this.node;return null!=this.node.nodeValue&&(e+=" value: "+this.node.nodeValue),e+=" document: "+this.document,this.offset&&(e+=" offset: "+this.offset),this.afterNode&&(e+=" (after node)"),this.error&&(e+=" error: "+this.error),e};var sOriginalFirstBodyNode=null,sDontHighlightMathML=!0;CFIDOMWalker.prototype.Initialize=function(e,t,n){this.node=e,this.index=t,this.document=n,this.backToNodeStack=new Array;for(var o=this.node.parentNode;NodeIsHighlightSpan(o);)o.nextSibling&&this.backToNodeStack.push(o.nextSibling),o=o.parentNode;this.backToNodeStack.reverse(),0==t&&this.NextNode()},CFIDOMWalker.prototype.FirstChild=function(){if(sOriginalFirstBodyNode&&this.node==document.body&&this.node==sOriginalFirstBodyNode.parentNode)return sOriginalFirstBodyNode;for(var e=this.node.firstChild;e&&NodeShouldBeSkipped(e);)e=e.nextSibling;return e},CFIDOMWalker.prototype.toString=function(){return"CFIDOMWalker, node: "+this.node+" index: "+this.index+" document: "+this.document},CFIDOMWalker.prototype.Clone=function(){return new CFIDOMWalker(this.node,this.index,this.document)},CFIDOMWalker.prototype.WalkChildren=function(){return!!this.FirstChild()&&(this.Initialize(this.FirstChild(),0,this.document),!0)},CFIDOMWalker.prototype.CreateChildWalker=function(){var e=this.FirstChild();return e?new CFIDOMWalker(e,0,this.document):null},CFIDOMWalker.prototype.WalkContentDocumentChildren=function(){var e=this.node.contentDocument;if(!e)return!1;var t=FindDocumentRoot(e);return!!t&&(this.Initialize(t,0,e),!0)},CFIDOMWalker.prototype.CreateContentDocumentChildWalker=function(){var e=this.Clone();return e.WalkContentDocumentChildren()?e:null},CFIDOMWalker.prototype.NextNode=function(){for(0!=this.index&&(this.node=this.node.nextSibling),null==this.node&&this.backToNodeStack.length>0&&(this.node=this.backToNodeStack.pop());this.node;)if(NodeShouldBeSkipped(this.node))this.node=this.node.nextSibling;else{if(!NodeIsHighlightSpan(this.node))break;var e=this.node.nextSibling;e&&this.backToNodeStack.push(e),this.node=this.FirstChild()}return this.node&&(this.index|=1,1==this.node.nodeType&&++this.index),this.node},CFIDOMWalker.prototype.NextCFIIndex=function(){for(var e=this.index;this.index==e&&null!=this.node||this.CurrentNodeIsIgnored();)this.NextNode();return this.node},CFIDOMWalker.prototype.FindNodeAtIndex=function(e){for(;this.node&&this.index<e;)this.NextCFIIndex();return this.node},CFIDOMWalker.prototype.CurrentNodeIsElement=function(){return!!this.node&&1===this.node.nodeType},CFIDOMWalker.prototype.CurrentNodeIsText=function(){return IsTextNode(this.node)},CFIDOMWalker.prototype.CurrentNodeIsIgnored=function(){if(!this.node)return!1;var e=this.node.nodeType;return!(1===e||3===e||4===e||5===e)},CFIDOMWalker.prototype.CurrentNodeHasContentDocument=function(){return!!this.node&&null!=this.node.contentDocument},CFIDOMWalker.prototype.NextTextNode=function(){if(this.CurrentNodeIsText()){for(this.NextNode();this.CurrentNodeIsIgnored();)this.NextNode();if(this.CurrentNodeIsText())return this.node}return null},CFIDOMWalker.prototype.FindNodeAtOffset=function(e){if(!this.CurrentNodeIsText())return null;for(var t,n=e,o=0;this.CurrentNodeIsText();){if(n-=o,t=this.node,this.index,(o=this.node.nodeValue.length)>n){var i=new CFILocation(this.node,this.document,n);return i}this.NextTextNode()}n>o&&(logError("Offset out of range: "+n),n=o);var i=new CFILocation(t,this.document,n);return i.afterNode=!0,i};var sSavedCFIScroll=null,sCFIScrollCompletion=new Array,sScrollToCFIPaused=!1;CFIRangeNode.prototype.limitContentRange=function(){VST.contentRangeBundle=[];var e=FindDocumentRoot(document),t=document,n=locateCFISubpathFromNode(this.basePath,e,t);if(!n||n.error)return logError("CFIRangeNode base subpath not found: "+this.basePath),null;var o=n.node,i=locateCFISubpathFromNode(this.begin,o,n.document),r=locateCFISubpathFromNode(this.end,o,n.document);if(i&&i.document!=n.document)return void logError("CFIRangeNode Highlight Error: fromLocation not in same document as base subpath");if(r&&r.document!=n.document)return void logError("CFIRangeNode Highlight Error: toLocation not in same document as base subpath");var s=i.node.parentElement
;for(VST.contentRangeBundle.push($(i.node).prevAll()),$(i.node).prevAll().hide();s;)s.contains(r.node)?(VST.contentRangeBundle.push($(s).siblings()),$(s).siblings().hide()):(VST.contentRangeBundle.push($(s).prevAll()),$(s).prevAll().hide()),s=s.parentElement;var s=r.node.parentElement;for(VST.contentRangeBundle.push($(r.node).nextAll()),$(r.node).nextAll().hide();s;)s.contains(i.node)?(VST.contentRangeBundle.push($(s).siblings()),$(s).siblings().hide()):(VST.contentRangeBundle.push($(s).nextAll()),$(s).nextAll().hide()),s=s.parentElement;return{height:document.body.clientHeight,width:document.body.clientWidth}},CFIRangeNode.prototype.Highlight=function(e,t){var n=locateCFISubpathFromNode(this.basePath,e,t);if(!n||n.error)return logError("CFIRangeNode base subpath not found: "+this.basePath),null;var o=n.node,i=locateCFISubpathFromNode(this.begin,o,n.document),r=locateCFISubpathFromNode(this.end,o,n.document);if(i&&i.document!=n.document)return void logError("CFIRangeNode Highlight Error: fromLocation not in same document as base subpath");if(r&&r.document!=n.document)return void logError("CFIRangeNode Highlight Error: toLocation not in same document as base subpath");if(1!=o.nodeType&&(i.node!=o||r.node!=o))for(o=o.parentNode;NodeIsHighlightSpan(o);)o=o.parentNode;var s=NodeStackForLocation(o,i),a=NodeStackForLocation(o,r);s&&a&&HighlightDOMLocationStacks(s,a,this.color,this.additionalClass,this.hasNote)},CFIRangeTreeNode.prototype.Highlight=function(e,t){var n=locateCFISubpathFromNode(this.basePath,e,t);if(!n||n.error)return logError("CFIRangeTreeNode base subpath not found: "+this.basePath),null;var o,i=n.node,r=n.document,s=this.children.length;for(o=0;s>o;++o)this.children[o].Highlight(i,r)};var noteIconHandler=CreateNoteSpan;return{Init:Init,ScrollToCFI:ScrollToCFI,UnhighlightAll:UnhighlightAll,BuildHighlightRangeTree:BuildHighlightRangeTree,HighlightRanges:HighlightRanges,TestHighlightRanges:TestHighlightRanges,TestHighlightCFIRange:TestHighlightCFIRange,ProcessEPUBSwitches:ProcessEPUBSwitches,LoadMathJax:LoadMathJax,ConfigMathJax:ConfigMathJax,TestHighlightSelection:TestHighlightSelection,HasHighlightableSelection:HasHighlightableSelection,RunAutomatedTests:RunAutomatedTests,GetCFIForNode:GetCFIForNode,GetCFIRangeForSelection:GetCFIRangeForSelection,GetCFIRangeStringForSelection:GetCFIRangeStringForSelection,GetSelectionText:GetSelectionText,ClearSelection:ClearSelection,HighlightGUIDForPoint:HighlightGUIDForPoint,HighlightGUIDForNode:HighlightGUIDForNode,StripCFIAssertions:StripCFIAssertions,IsPointInHighlightableSelectedText:IsPointInHighlightableSelectedText,GetCFIForCurrentScrollPosition:GetCFIForCurrentScrollPosition,GetCFIForScreenY:GetCFIForScreenY,GetCFIForPoint:GetCFIForPoint,FindDOMNodeAndOffsetIntersectingViewportRect:FindDOMNodeAndOffsetIntersectingViewportRect,locateCFI:locateCFI,exitContentRange:exitContentRange,FindHighlightGUIDInClassString:FindHighlightGUIDInClassString,GetSpeechText:GetSpeechText,GetNodeForCurrentScrollPosition:GetNodeForCurrentScrollPosition,GetNodeForScreenY:GetNodeForScreenY,GetNodeForScreen:GetNodeForScreen,GetChapterOffsetForCurrentScrollPosition:GetChapterOffsetForCurrentScrollPosition,CFIRangeNode:CFIRangeNode,locateCFISubpathFromNode:locateCFISubpathFromNode}},CallJS=function(scriptForEval){return eval(scriptForEval)};(function(e){var t=function(e){var t=o.getIFrameContainer(),n=t.find("iframe"),i=n[0];i&&(i.contentWindow.location.href="about:blank"),n.remove(),t.append("<iframe id='epub-content' src='"+e+"' allowTransparency='true' scrolling='auto' frameBorder='0' width='100%' height='100%' allowfullscreen='true' webkitallowfullscreen='true' mozallowfullscreen='true'></iframe>")},n=function(e){var t=VST.$(VST.document),e=e||VST.sharedEpubModule.GetCFIForCurrentScrollPosition(),n={cfi:e,cfiwithoutAssertions:VST.sharedEpubModule.StripCFIAssertions(e),scrollTop:VST.Utils.scrollTop(),scrollLeft:VST.Utils.scrollLeft(),scrollHeight:VST.scrollElement.scrollHeight||t.outerHeight(),scrollWidth:VST.scrollElement.scrollWidth||t.outerWidth()};VST.fire("page:navigate",n)},o={touch:!0,iframe:"#epub-container",bind:function(){},unbind:function(){},trigger:function(){},noscroll:function(e){return e.preventDefault(),!1},getContainerDimensions:function(t){var n=this.getIFrameContainer();data={width:n.width(),height:n.height(),scale:scale,offsetX:Math.max(n.scrollLeft(),e(e("#epub-content").get(0).contentWindow).scrollLeft()),offsetY:Math.max(n.scrollTop(),e(e("#epub-content").get(0).contentWindow).scrollTop())};var o=new Jigsaw.Response({status:"ok",data:data});return t&&t(o),data},focus:function(e){if(!(VST.$(VST.document).find(":focus").length>0)){var t=this.getIFrameContainer();t.contentWindow||(t=t.find("#epub-content").get(0)),t.contentWindow.focus(),e&&e()}},setCursor:function(t){return"object"==typeof t?(e(VST.document.body).css("cursor",t.fallback+", auto"),e(VST.document.body).css("cursor",t.retina+", auto")):"string"==typeof t&&e(VST.document.body).css("cursor",t+", auto"),e(VST.document.body).find(".vsthighlight").css("cursor","inherit"),!0},resetCursor:function(){return e(VST.document.body).css("cursor",""),e(VST.document.body).find(".vsthighlight").css("cursor","pointer"),!0},touchEventsEnabled:function(t,n){if(n!=undefined&&(Jigsaw.touch=n,n?Browser.isIOS()?(e("#scroll-stopper").css("display","none"),document.getElementById("epub-content").contentWindow.document.body.removeEventListener("touchmove",this.noscroll)):e("#epub-content").css("overflow","auto"):Browser.isIOS()?(e("#scroll-stopper").css("display","block"),document.getElementById("epub-content").contentWindow.document.body.addEventListener("touchmove",this.noscroll)):e("#epub-content").css("overflow","hidden")),t){t(new Jigsaw.Response({status:"ok",data:Jigsaw.touch}))}return Jigsaw.touch},getIFrameContainer:function(){return e("#epub-container")},goToNextPage:function(){VST.Book.goToNextPage()},goToPreviousPage:function(){VST.Book.goToPreviousPage()},getCFIForNode:function(e){return VST.sharedEpubModule.GetCFIForNode(e)},locateCFI:function(e){return VST.sharedEpubModule.locateCFI(e)},stripCFIAssertions:function(e){return VST.sharedEpubModule.StripCFIAssertions(e)},compareCFIs:function(e,t){return VST.Utils.compareCFIs(e,t)},getCFIForPoint:function(e,t){return VST.sharedEpubModule.GetCFIForPoint(e,t)},navigateTo:function(e,n){n&&Jigsaw.once("page:ready",n),VST.window.location.pathname===e?VST.Book.getCurrentPage(function(e,t){var n=t?null:t.getCFI();Jigsaw.trigger("page:ready",{cfi:n})}):t(e)},scrollToPosition:function(t){var n=VST.scrollElement.scrollTop||VST.scrollElement.scrollY||e(VST.scrollElement).scrollTop(),o=e(VST.scrollElement).height(),i=0,r=e(t).offset().top,s=e(t).height()||0;i=r<n?r-10:r>n+o-10-s?r-10:n;var a=VST.scrollElement;e.isWindow(a)&&(a=e(a.document).find("html, body")),e(a).stop(!0,!0).animate({scrollTop:i},500)},navigateToNode:function(t,o){return!!t&&(n(o),e(t).is(":visible")?Jigsaw.scrollToPosition(t,o):(e(t).show(),Jigsaw.scrollToPosition(t,o),e(t).hide()),t.getAttribute("tabindex")||t.setAttribute("tabindex","0"),VST.autofocus&&(t.focus(),setTimeout(function(){t.removeAttribute("tabindex")},2500)),!0)},navigateToHighlight:function(t,n){t.syncId||(t={syncId:t});var o=e(VST.document).find("."+VST.Models.Highlight.Settings.highlightClass+".highlight_"+t.syncId);if(o.length>0&&Jigsaw.navigateToNode(o.get(0),VST.sharedEpubModule.GetCFIForNode(o.get(0))))return n();Jigsaw.navigationRequested();var i=VST.Book.buildAPIURL("highlights/"+t.syncId);return(t.subscription||t.subscribed)&&(i+="/shared"),Jigsaw.navigateTo(i,function(){VST.once("highlights:render",function(){n()})})},navigationRequested:function(){Jigsaw.trigger("book:navigationRequested")}};this.Jigsaw=VST.Jigsaw=o}).call(window,VST.$),function(){var e=function(e){return function(o,i){/selectionMade/.test(o)&&n(),VST.Logger.info("firing (original handler)",o,"with: ",i,"in: ",window.location.hostname),e.apply(this,arguments),delete o.originalEvent,delete o.target,i&&i.nodeName&&/highlight|note/.test(o)&&(i=t(i));try{Jigsaw.trigger.apply(Jigsaw,arguments)}catch(e){VST.Logger.error("error firing event: ",o,e)}}}(VST.fire);VST.EventDispatcher.fire=VST.EventDispatcher.trigger=VST.trigger=VST.fire=e;var t=function(e){var t,n,o;"svg"===e.tagName?(n=e.nextElementSibling,o=e.className.baseVal):(n=e,o=e.className),t={top:n.offsetTop-VST.Utils.scrollTop(),left:n.offsetLeft-VST.Utils.scrollLeft(),width:n.offsetWidth,height:n.offsetHeight};var i={syncId:e.getAttribute("data-guid"),markerId:e.getAttribute("data-marker-guid"),noteText:e.getAttribute("data-note-text"),shared:"true"==e.getAttribute("data-subscription"),position:t};return i.syncId||(matches=o.match(/highlight_([^\s]+)/))&&(i.syncId=matches[1]),i},n=function(){if(VST.Book){var e=VST.Book.getCopyLimit();e>0&&(VST.Book.limitSelection(e,"copy"),VST.trigger("book:selectionLimited",{limit:e}))}},o=function(e){if(!e||!e.commonAncestorContainer)return!1;var t=e.commonAncestorContainer,n=!1;for(1!==t.nodeType&&(t=t.parentElement);!n&&t;)/\bvstdonthighlight\b/i.test(t.className)&&(n=!0),t=t.parentElement;return n};VST.bind("book:selectionMade",function(e,t){if(data={selectedText:t},"pdf"==VST.Book.getFormat()||"pbk"==VST.Book.getFormat())data.selectionRect=VST.PictureBook.selection.getBoundingClientRect();else{var n=VST.Utils.getRangeObject(),i=n.getBoundingClientRect(),r=n.getClientRects(),s={},a=VST.Utils.scrollTop();s.width=i.width,s.left=i.left,s.right=i.right;for(var l=n.startContainer;1!==l.nodeType&&(l=l.parentNode););var c=VST.$(l).offset(),u=function(e,t,n){return n[0].top>=t.top&&n[0].bottom>=t.top?(e.top=n[0].top-a,e.bottom=n[n.length-1].bottom-a):(e.top=n[0].top,e.bottom=n[n.length-1].bottom),e.height=s.bottom-s.top,e};if(s=u(s,c,r),s.bottom<0&&s.top<0){var d=VST.$(VST.scrollElement);VST.$(d).scrollTop(d.scrollTop()+s.bottom-100);var h=n.getClientRects();c=VST.$(l).offset(),s=u(s,c,h)}data.selectionRect=s}e.originalEvent&&(data.eventPosition={top:e.originalEvent.clientY,left:e.originalEvent.clientX}),VST.Book.isPBK()||(data.cfi=VST.sharedEpubModule.GetCFIRangeStringForSelection(),data.disableHighlights=!!o(VST.Utils.getRangeObject())),VST.lastHighlightDataForSelection=data.highlightAttrs=VST.Highlights.getHighlightDataForCurrentSelection(),VST.trigger("book:selectionWithPosition",data)}),VST.bind("page:ready",function(){VST.lastKnownScrollPosition=undefined}),VST.bind("page:scroll:raw",function(){var e=VST.scrollElement.pageYOffset||VST.scrollElement.scrollTop||VST.scrollElement.scrollY,t=VST.scrollElement.pageXOffset||VST.scrollElement.scrollLeft||VST.scrollElement.scrollX;void 0===e&&(e=0),void 0===t&&(t=0);var n={scrollTop:e,scrollHeight:VST.scrollElement.scrollHeight||VST.$(VST.document).outerHeight(),scrollLeft:t,scrollWidth:VST.scrollElement.scrollWidth||VST.$(VST.document).outerWidth()};Browser.isSafari()&&(e<=1&&VST.lastKnownScrollPosition&&VST.lastKnownScrollPosition>10&&(VST.scrollElement.scrollTop=VST.lastKnownScrollPosition,$(VST.scrollElement).css("display","none"),VST.scrollFixTimeout&&clearTimeout(VST.scrollFixTimeout),VST.scrollFixTimeout=setTimeout(function(){$(VST.scrollElement).css("display",""),VST.scrollElement.scrollTop=VST.lastKnownScrollPosition},750)),e>10&&(VST.lastKnownScrollPosition=e)),VST.trigger("page:scroll:fullspeed",n)})}.call(this),function(){var e;e=VST.$,this.EpubBook={highlightOneHighlight:function(e,t,n){var o,i,r,s,a,l;if(null==n&&(n=!1),o=e.cfi,VST.sharedEpubModule.StripCFIAssertions(o.split("!")[0])===VST.sharedEpubModule.StripCFIAssertions(t))return o=o.split("!").slice(1).join("!"),l=o.split(","),r=e.vstColorDark.replace("#",""),a="highlight_"+e.syncId+" "+VST.Models.Highlight.Settings.highlightClass+" vstcolor"+e.vstColor.replace("#","")+" vstcolordark"+r,n?(a+=" vst-shared-highlight",i=e.vstColorDark):i=e.vstColor,s={base:l[0],begin:l[1],end:l[2],hasNote:e.hasNote,color:i,additionalClass:a},VST.sharedEpubModule.HighlightRanges([s],i,a)},highlightsForPage:function(){return function(e,t){return e.filter(function(e){return VST.sharedEpubModule.StripCFIAssertions(e.cfi).split("!")[0]===t})}}(),highlightCurrentHighlights:function(){return Jigsaw.socket.highlightsEnabled(function(t){return function(n){if(n)return VST.Book.getCurrentPage(function(n,o){var i,r;return i=null!=o?o.getCFI():void 0,r=VST.sharedEpubModule.StripCFIAssertions(i),VST.Book.getHighlights(function(n,o){var i,s,a,l,c,u,d;if(!n){for(t.highlights=t.highlightsForPage(o.highlights,r),t.subscribedHighlights=o.subscribedHighlights,u=t.highlights,s=0,l=u.length;s<l;s++)i=u[s],t.highlightOneHighlight(i,r);for(d=t.subscribedHighlights,a=0,c=d.length;a<c;a++)i=d[a],t.highlightOneHighlight(i,r,!0);t,e(VST.document).find(".vst-shared-highlight").each(function(){if("svg"!==this.nodeName)return i=e(this),VST.sharedEpubModule.FindHighlightGUIDInClassString(this.className),i.css({backgroundColor:"transparent",borderBottom:"2px solid "+i.css("background-color")}),i.hasClass("vst-shared-highlight")?i.attr("data-subscription",!0):void 0});try{t.auditHighlights(t.highlights)}catch(e){return}}return VST.trigger("highlights:render")})})}}(this))},auditHighlights:function(e){return function(t){var n,o,i,r,s,a,l,c,u,d,h,f,g,p,m,T;for(e.sortedHighlights=t.sort(function(e,t){return VST.Utils.compareCFIs(e.cfi,t.cfi)}),n=[],p=e.sortedHighlights,l=0,c=p.length;l<c;l++)if(a=p[l],a.cfi){if(f&&f.cfi===a.cfi);else if(o={},i=a.cfi.split("!"),o.contentDoc=i[0],o.relative=i[1],m=o.relative.split("/"),o.paragraphNode=m.slice(0,-1).join("/")+"/",h=m.slice(-1)[0].split(","),o.textNode=h[0],o.offset=h.slice(1).join(","),f&&o.contentDoc===g.contentDoc&&o.paragraphNode===g.paragraphNode)if(o.textNode===g.textNode);else{for("",r={error:!0};o.textNode%2==1&&r.error&&(r=VST.sharedEpubModule.locateCFISubpathFromNode(o.paragraphNode+o.textNode,VST.document.firstElementChild,VST.document.firstElementChild),u=r.node,d=u.innerText||u.textContent,T=d.indexOf(a.selectedText),!(o.textNode<=1));)(r.error||T<0)&&(o.textNode-=2);d===a.selectedText||T>=0&&(s=o.contentDoc+"!"+o.paragraphNode+o.textNode+",:"+T+",:"+(T+a.selectedText.length))!==a.cfi&&n.push({name:"SVGHighlightIssueV2",isbn:a.isbn,cfi:VST.sharedEpubModule.StripCFIAssertions(a.cfi),syncId:a.syncId,selectedText:a.selectedText,correctedCFI:VST.sharedEpubModule.StripCFIAssertions(s),timestamp:(new Date).getTime()})}f=a,g=o}if(n.length>0)return Jigsaw.socketMethods.local.addEvents.method(n),n}}(this)}}.call(this),function(){VST.$,VST.Dash={contentReady:function(e,t,n){if(VST.Loading.contentReady(e,t,n),VST.Loading.isMainReadingWindow(e))return this.highlightCurrentHighlights(null!=n?n.cfi:void 0)},highlightRenderer:function(e){return new VST.Dash.HighlightRenderer(e,VST.document.body.children[0].getAttribute("o"))},highlightCurrentHighlights:function(){return Jigsaw.socket.highlightsEnabled(function(){return function(e){if(e)return VST.Book.getCurrentPage(function(e,t){return VST.Book.getHighlights(function(e,n){var o,i,r,s,a,l,c,u,d,h,f;for(f=[],l=n.highlights,i=0,s=l.length;i<s;i++)o=l[i],o.chapterCfi===t.getCFI()&&f.push(o);for(u=new VST.Dash.HighlightRenderer(f,VST.document.body.children[0].getAttribute("o")),u.render(VST.document.body),h=[],c=n.subscribedHighlights,r=0,a=c.length;r<a;r++)o=c[r],o.chapterCfi===t.getCFI()&&h.push(o);return d=new VST.Dash.HighlightRenderer(h,VST.document.body.children[0].getAttribute("o"),!0),d.render(VST.document.body),VST.trigger("highlights:render")})})}}())}}}.call(this),function(){var e;e=VST.$,VST.Handler.set("selection",function(e,t){var n,o,i;return n=VST.Models.Highlight.defaultSelectionHandler,VST.Book&&VST.Book.isPBK()?(i=VST.PictureBook.selection.getSelectedText(),i&&""!==i?(o=VST.Event.fromjQueryEvent("book:selectionMade",e,t),VST.EventDispatcher.fire(o,i)):n(e,t)):n(e,t)}),VST.Handler.set("VST.Utils.getSelectedText",function(){return VST.Book.isPBK()?VST.PictureBook.selection.getSelectedText():VST.Utils.defaultGetSelectedTextHandler()}),VST.PictureBook={contentReady:function(e,t,n){if(VST.Loading.isMainReadingWindow(e))return this.insertNextAndPreviousPage(n),this.watchImageLoad(e,t),this.words=n.words,delete this.normalizedWords,delete this.alreadyNormal,delete this.gRenderer,delete this.selection,this.gRenderer=new this.GlyphRenderer(t,n.glyphs),this.selection=new this.TextSelection(t,this.gRenderer,this.words),this.lRenderer=new this.LinkRenderer(n.links),VST.Loading.contentReady(e,t,n),this.highlightCurrentHighlights(n.index,this.gRenderer),this.lRenderer.render()},insertNextAndPreviousPage:function(e){var t,n,o;if(null==e&&(e={}),t=document.getElementById("epub-container"),n=Jigsaw.getContainerDimensions().width,o="?width="+this.bestWidthForContainerWidth(n),e.prevPage&&!document.getElementById("prev-page")&&t.appendChild(this.createIframe("prev-page",e.prevPage.absoluteURL+o)),e.nextPage&&!document.getElementById("next-page"))return t.appendChild(this.createIframe("next-page",e.nextPage.absoluteURL+o))},createIframe:function(e,t){var n;return n=document.createElement("iframe"),n.setAttribute("id",e),n.setAttribute("src",t),n.setAttribute("allowtransparency","true"),n.setAttribute("frameborder","0"),n.setAttribute("scrolling","auto"),n.setAttribute("height","100%"),n.setAttribute("width","100%"),n.style.display="none",n},fitToHeightOnPageResize:function(){var e;if("height"===VST.fitMode)return e=VST.$(VST.document),e.find("img#pbk-page").css({height:Jigsaw.getContainerDimensions().height+"px",width:"auto"})},fitToHeight:function(){return this.fitToHeightOnPageResize(),VST.unbind("page:resize",this.fitToWidthOnPageResize),VST.unbind("page:resize",this.fitToHeightOnPageResize),VST.bind("page:resize",this.fitToHeightOnPageResize),VST.trigger("page:resize"),VST.fitMode="height",zoomPDF("normal"),VST.fire("page:transform",Jigsaw.getContainerDimensions())},fitToWidthOnPageResize:function(){var e;if("width"===VST.fitMode)return e=VST.$(VST.document),e.find("img#pbk-page").css({height:"auto",width:"100%"})},fitToWidth:function(){return this.fitToWidthOnPageResize(),VST.unbind("page:resize",this.fitToWidthOnPageResize),VST.unbind("page:resize",this.fitToHeightOnPageResize),VST.bind("page:resize",this.fitToWidthOnPageResize),VST.trigger("page:resize"),VST.fitMode="width",zoomPDF("normal"),VST.fire("page:transform",Jigsaw.getContainerDimensions())},watchImageLoad:function(t,n){var o,i,r;try{e(VST.document).find("#pbk-page")}catch(e){return}if(o=n.getElementById("pbk-page"),i=function(t){return function(){var i,r,s,a,l,c;try{e(VST.document).find("#pbk-page")}catch(e){return}if(n=VST.document,o=n.getElementById("pbk-page"),e(n).find(".pbk-overlay").css({height:o.height+"px",width:o.width+"px",marginBottom:"-"+o.height+"px"}),r=Jigsaw.getContainerDimensions(),c=r.width,a=e("#epub-content").css("transform"),l=a.match(/-?[\d\.]+/g),l&&(s=l[0],c*=s),i=t.bestWidthForContainerWidth(c),parseInt(o.getAttribute("data-width"),10)!==i)return o.setAttribute("data-width",i),o.setAttribute("src",o.getAttribute("src").replace(/\/(\d+)$/,"/"+i))}}(this),o)return o.onload=i,e(t).off("resize"),Jigsaw.unbind("page:resize"),VST.unbind("page:transform"),e(t).on("resize",i),Jigsaw.bind("page:resize",i),r=null,VST.bind("page:transform",function(){return clearTimeout(r),r=setTimeout(i,250)})},bestWidthForContainerWidth:function(t){var n,o,i,r,s,a,l,c,u;if(c=[800,1600,2e3],VST.document){i=VST.document;try{s=e(i).find("#pbk-page")}catch(e){return}s=i.getElementById("pbk-page"),a=s.width,a>t&&(t=a),o=s.getBoundingClientRect().width,o>t&&(t=o)}for(n=c[c.length-1],r=l=c.length-1;l>=0;r=l+=-1)u=c[r],t<u&&(n=u);return n},renderOneHighlight:function(e){return this.hRenderer.renderOneHighlight(e)},prettifyNoteIcon:function(e,t){return this.hRenderer.prettifyNoteIcon(e,t)},findTermsWithoutNormalization:function(e,t){var n,o,i,r,s,a;for(r=[],o=0,i=t.length;o<i;o++)for(a=t[o],s=new RegExp(a,"gi");n=s.exec(this.words);)r.push([n.index,n.index+a.length-1]);return r},highlightNodes:function(t,n,o){var i,r,s,a,l,c,u,d;if(null==o&&(o=""),d=VST.document.getElementById("pbk-search"),t.length>0){for(c=[],s=0,a=t.length;s<a;s++)u=t[s],c.push(function(){var t,s,a,c;for(c=[],r=t=s=u[0],a=u[1];(s<=a?t<=a:t>=a)&&(i=this.gRenderer.glyphs[r]);r=s<=a?++t:--t)l=this.gRenderer.createNode(i),l.style.background=n,l.style.opacity="0.3",l.setAttribute("data-glyph",r),e(l).addClass(o),c.push(d.appendChild(l));return c}.call(this));return c}},highlightTerms:function(e,t,n){var o,i,r,s,a,l,c,u,d,h,f,g,p,m;for(null==n&&(n=""),m=VST.document.getElementById("pbk-search"),VST.Utils.isArray(e)||(e=[e]),p=[],r=0,a=e.length;r<a;r++)g=e[r],p.indexOf(g)<0&&p.push(g);if(e=p,this.words.normalize){for(d=[],this.normalizedWords=this.normalizedWords||this.words.normalize(),this.alreadyNormal=this.words.length===this.normalizedWords.length,s=0,l=e.length;s<l;s++)if(g=e[s],!(g.length<=2))for(g=g.normalize(),h=new RegExp("\\b"+g+"\\b","gi");i=h.exec(this.normalizedWords);)if(this.alreadyNormal)d.push([i.index,i.index+g.length-1]);else{for(o=this.normalizedWords.slice(0,i.index),c=this.words.slice(0,Math.min(2*i.index,this.words.length-1));o.normalize()!==c.normalize()&&c.length>0;)c=c.substring(0,c.length-1);for(f=i.index+c.length-o.length,u=this.words.slice(f,f+2*g.length);g.length!==u.normalize().length&&u.length>0;)u=u.substring(0,u.length-1);d.push([f,f+u.length-1])}}else d=this.findTermsWithoutNormalization(m,e,t);return this.highlightNodes(d,t,n)},unhighlightTerms:function(){var e,t;if(t=VST.document.getElementById("pbk-search")){for(e=[];t.hasChildNodes();)e.push(t.removeChild(t.lastChild));return e}},highlightCurrentHighlights:function(e,t){return VST.Book.getHighlights(function(n){return function(o,i){var r,s,a,l,c,u,d,h,f,g;if(!o){for(f=[],u=i.highlights,s=0,l=u.length;s<l;s++)r=u[s],r.startPage===e&&f.push(r);for(t||(t=n.gRenderer),n.hRenderer=new n.HighlightRenderer(f,t),n.hRenderer.render(),g=[],d=i.subscribedHighlights,a=0,c=d.length;a<c;a++)r=d[a],r.startPage===e&&g.push(r);return h=new n.HighlightRenderer(g,t,!0),h.render(),VST.trigger("highlights:render")}}}(this))}}}.call(this),function(){var e;e=VST.$,VST.Highlights={addHighlightCSS:function(){var e;return e=VST.document.createElement("style"),e.setAttribute("type","text/css"),e.innerText=".vsthighlight { cursor: pointer; } .disabledHighlight { background: #ECECEC !important; border-color: #B3B3B3 !important; cursor: default !important; } .disabledHighlight.vst-shared-highlight { background: transparent !important; }",VST.document.body.appendChild(e)},getHighlightDataForCurrentSelection:function(){var e,t,n,o,i,r,s,a,l,c,u,d,h;if(e={},VST.Book.isPBK()?e.selected_text=VST.PictureBook.selection.getSelectedText():e.selected_text=VST.Utils.getSelectedText(),""===e.selected_text)return null;if(VST.Book.isEpub())e.cfi=VST.currentPageData.cfi.split("!")[0]+"!",e.cfi+=VST.sharedEpubModule.GetCFIRangeStringForSelection();else if(VST.Book.isDash()){if(e.selected_text=e.selected_text.replace(/\n+/g,"").replace(/\s+/," "),c=VST.Utils.getSelectionObject(),c.parentElement);else if(a=VST.Utils.getRangeObject(),u=a.startContainer,u.getAttribute&&(s=u.getAttribute("o")))e.chapter_offset=parseInt(s,10)+a.startOffset;else for(i=u;i=i.parentNode;)if(o=i.getAttribute("o")){o=parseInt(o,10),h=u.textContent,r=i.textContent,n=r.indexOf(h),e.chapter_offset=n>=0?o+n+a.startOffset:o+a.startOffset;break}e.end_offset=e.chapter_offset+e.selected_text.length,e.selection_length=e.selected_text.length,e.chapter_title=VST.currentPageData.chapterTitle}else l=VST.PictureBook.selection,e.start_label=VST.currentPageData.page,e.end_label=VST.currentPageData.page,e.chapter_offset=l.startIndex,e.end_offset=e.chapter_offset+e.selected_text.length,e.start_page=VST.currentPageData.index,e.end_page=VST.currentPageData.index,d=l.centerCoordinatesForStart(),t=l.centerCoordinatesForEnd(),e.start_x=d.x,e.start_y=d.y,e.end_x=t.x,e.end_y=t.y,e.chapter_title=VST.currentPageData.chapterTitle;return e},setNodeAttributes:function(e,t){if(t.chapterOffset&&e.setAttribute("data-offset",t.chapterOffset),t.endOffset&&e.setAttribute("data-end-offset",t.endOffset),t.syncId&&e.setAttribute("data-guid",t.syncId),t.markerId&&e.setAttribute("data-marker-guid",t.markerId),t.noteText&&e.setAttribute("data-note-text",t.noteText),t.subscribed)return e.setAttribute("data-subscription",t.subscribed)},findNoteIconNode:function(t){return e(VST.document).find("."+VST.Models.Highlight.Settings.noteIconClass+".highlight_"+t)[0]},updateHighlight:function(t,n){var o,i,r,s,a,l;if(l=e(VST.document).find("."+VST.Models.Highlight.Settings.highlightClass+".highlight_"+t),l.length>0){for(l.css({backgroundColor:n.vstColor}),i=0,r=l.length;i<r;i++)a=l[i],this.setNodeAttributes(a,n);if(o=this.findNoteIconNode(t),n.hasNote){if(o&&o.setAttribute("style","display:none;"),s=this.noteIconNode(n),VST.Book.isPBK()&&VST.PictureBook.prettifyNoteIcon(s,n),l[0].parentNode.insertBefore(s,l[0]),o)return o.parentNode.removeChild(o)}else if(o)return o.parentNode.removeChild(o)}},removeAllHighlights:function(){return this.removeHighlight()},removeHighlight:function(t){var n,o,i,r,s,a,l,c,u;for(i="."+VST.Models.Highlight.Settings.highlightClass,t&&(i+=".highlight_"+t),l=e(VST.document).find(i).get().reverse(),u=[],r=0,s=l.length;r<s;r++){if(a=l[r],c=a.parentNode,/\bvstnoteindicator\b/.test(a.className.baseVal||a.className));else for(;a.childNodes.length>0;)n=a.childNodes[0],o=n.cloneNode(!0),c.insertBefore(o,a),a.removeChild(n);u.push(c.removeChild(a))}return u},highlightClass:function(e){return"vstignore vstskip vsthighlight highlight_"+e},noteIconNode:function(e,t,n){var o,i,r,s,a,l;n||(n=VST.document),t||(t=""),t+=" vstignore vsthighlightshared highlight_"+e.syncId+" "+VST.Models.Highlight.Settings.noteIconClass,a=VST.Models.Highlight.Settings,a.svgIcon?(s=n.createElement("span"),l=n.createElementNS("http://www.w3.org/2000/svg","svg"),l.setAttribute("height","13"),l.setAttribute("width","11"),l.setAttribute("viewBox","0 0 8 10"),l.setAttribute("style","vertical-align: top; position:absolute; top: 0; left: 0;"),l.innerHTML="<title>notes_icon</title> <g fill='"+e.vstColorDark+"' fill-rule='evenodd'> <path d='M6.62 8.585H1.38v-7.17h5.24v7.17zM6.547.111H1.455a1.38 1.38 0 0 0-1.38 1.38v7.02a1.38 1.38 0 0 0 1.38 1.378h5.09a1.38 1.38 0 0 0 1.38-1.379V1.49A1.38 1.38 0 0 0 6.545.111z'/> <path d='M2.182 6.581h3.636v-.727H2.182zm0-2.182h3.636v-.727H2.182z'/> </g>",s.appendChild(l)):s=n.createElement(a.tag||"span"),r="background: "+e.vstColor+"; position: absolute; left: 10px;",a.svgIcon?s.setAttribute("style",r+"margin-top: 3px; border-radius: 2px; width: 11px !important; height: 13px !important;"):s.setAttribute("style",r+"width: 11px !important; height: 11px; border: 3px solid "+e.vstColorDark+";"),i=a.attributes;for(o in i)s.setAttribute(o,i[o]);return s.setAttribute("class",t+" "+VST.Models.Highlight.Settings.highlightClass+" vstskip"),s},noteIconHandler:function(e,t,n){var o,i,r;return o=t,(i=n.match(/vstcolordark([^\s]+)/))&&(o="#"+i[1]),(r=n.match(/vstcolor([^\s]+)/))&&(t="#"+r[1]),VST.Highlights.noteIconNode({vstColor:t,vstColorDark:o},n,e)},renderCurrentHighlights:function(){var e;return VST.Book.isPBK()?VST.PictureBook.highlightCurrentHighlights(null!=(e=VST.currentPageData)?e.index:void 0):VST.Book.isDash()?VST.Dash.highlightCurrentHighlights():EpubBook.highlightCurrentHighlights()},focusHighlight:function(t){return t?(e(VST.document).find("."+VST.Models.Highlight.Settings.highlightClass).addClass("disabledHighlight"),e(VST.document).find("."+VST.Models.Highlight.Settings.highlightClass+".highlight_"+t).removeClass("disabledHighlight")):e(VST.document).find("."+VST.Models.Highlight.Settings.highlightClass).removeClass("disabledHighlight")},redrawHighlights:function(t){if(e(VST.document).find("."+VST.Models.Highlight.Settings.highlightClass).removeClass("disabledHighlight"),this.removeAllHighlights(),this.renderCurrentHighlights(),t)return t()}}}.call(this),function(){VST.Dash=VST.Dash||{},VST.Dash.HighlightRenderer=function(e,t,n){this.highlights=e,this.numberOfHighlightsOpen=0,this.offset=parseInt(t,10),this.subscribed=!!n,this.render=function(e){for(var t=0;t<this.highlights.length;t++)this.renderOneHighlight(e,this.highlights[t],0)},this.renderOneHighlight=function(e,t,n){var o=t.chapterOffset,i=t.endOffset;this.offset=parseInt(e.getAttribute("o")||n||this.offset,10);for(var r=0;r<e.childNodes.length;r++){var s=e.childNodes[r];if(1===s.nodeType)this.renderOneHighlight(s,t);else{if(/^\s*$/.test(s.nodeValue))continue;var a=this.getNodeValueLength(s),l=this.shouldStartInNode(o,i,s),c=this.shouldContinueInNode(o,i);(l||c)&&(r+=this.insertHighlight(t,s,l)),this.offset+=a}}},this.getNodeValueLength=function(e){return e.nodeValue.replace(/\n|\r|\n\r/g,"").replace(/\s+/g," ").length},this.shouldStartInNode=function(e,t,n){return e>=this.offset&&e<this.getNodeValueLength(n)+this.offset},this.shouldContinueInNode=function(e,t){return e<this.offset&&t>this.offset},this.insertHighlight=function(e,t,n){var o=t.parentNode,i=e.chapterOffset-this.offset;i<0&&(i=0);var r=e.endOffset-this.offset-i;r>t.nodeValue.length&&(r=t.nodeValue.length);var s=i+r,a=t.nodeValue.substr(0,i),l=t.nodeValue.substr(i,r),c=t.nodeValue.substr(s),o=t.parentNode,u=t.ownerDocument,d=u.createTextNode(c),h=u.createTextNode(a),f=u.createElement("span"),g="background-color: ",p=VST.Models.Highlight.Settings.highlightClass+" vstignore vstskip highlight_"+e.syncId;this.subscribed&&(g="border-bottom: 2px solid ",p+=" vsthighlightshared"),f.setAttribute("class",p);var m=this.subscribed?e.vstColorDark:e.vstColor;f.setAttribute("style",g+m),VST.Highlights.setNodeAttributes(f,e),f.setAttribute("data-subscription",this.subscribed),f.setAttribute("aria-label","highlighted text"),f.textContent=l,o.replaceChild(d,t),o.insertBefore(f,d),o.insertBefore(h,f);var T=1;if(0!=a.length&&T++,0!=c.length&&T++,n&&e.hasNote){T++;var v=VST.Highlights.noteIconNode(e,p);o.insertBefore(v,f)}return T}}}.call(this),function(){VST.PictureBook=VST.PictureBook||{},VST.PictureBook.HighlightRenderer=function(e,t,n){this.highlights=e,this.subscriptions=!!n,this.renderer=t,this.glyphs=t.glyphs,this.render=function(){for(var e=0;e<this.highlights.length;e++){var t=this.highlights[e];this.renderOneHighlight(t)}},this.renderOneHighlight=function(e){var t=VST.document.getElementById("pbk-penguins"),n=e.chapterOffset,o=e.endOffset;t.childNodes[n];if(e.hasNote){var i=VST.Highlights.noteIconNode(e,VST.Highlights.highlightClass(e.syncId));t.appendChild(this.prettifyNoteIcon(i,e))}for(var r=n;r<o;r++){var s=this.glyphs[r];if(!s)break;var a=this.renderer.createNode(s);t.appendChild(this.prettifyNode(a,e))}},this.prettifyNode=function(e,t){var n=this.subscriptions?" vst-shared-highlight":"",o=this.subscriptions?" border-bottom: 2px solid "+t.vstColorDark+";":" background-color: "+t.vstColor+"; opacity: 0.3;";return e.setAttribute("data-subscription",this.subscriptions),e.setAttribute("style",e.getAttribute("style")+o),e.setAttribute("class",e.getAttribute("class")+" "+VST.Highlights.highlightClass(t.syncId)+n),e.setAttribute("data-guid",t.syncId),e.setAttribute("data-has-note",t.hasNote),e},this.prettifyNoteIcon=function(e,t){var n=this.findFirstLegitGlyphInHighlight(t);if(n)return e.setAttribute("style",e.getAttribute("style")+" top: "+n.t+"%"),e},this.findFirstLegitGlyphInHighlight=function(e){for(var t,n=e.chapterOffset,o=n+e.selectedText.length;n<o;n++)if(t=this.glyphs[n],!t.dup&&t.r+t.l+.001<100)return t;return t}}}.call(this,VST.$),function(e){VST.PictureBook=VST.PictureBook||{},VST.PictureBook.TextSelection=function(t,n,o){this.fuzzySelect=!1,this.doc=t,this.words=o,this.image=t.getElementById("pbk-page"),this.renderer=n,this.glyphs=this.renderer.glyphs,this.touchStartTimeout=null,this.noSelectMouseMoves=0,this.selectionWrapper=t.getElementById("pbk-selection"),this.extrasWrapper=t.getElementById("pbk-extras"),this.startPos,this.endPos,this.selecting=!1,this.setupTextarea(t);var i=this;e(t).off(".pbksel").on("mousedown.pbksel",function(e){i.onMouseDown(e)}).on("touchstart.pbksel",function(e){i.onTouchStart(e)}).on("mousemove.pbksel touchmove.pbksel",function(e){i.onMouseMove(e)}).on("mouseup.pbksel mouseleave.pbksel touchend.pbksel",function(e){i.onMouseUp(e)}),this.deselectAll=function(){for(delete this.startIndex,delete this.endIndex,this.textarea.value=null;this.selectionWrapper.hasChildNodes();)this.selectionWrapper.removeChild(this.selectionWrapper.lastChild)},this.selectGlyph=function(e){var t=e.cloneNode(!0);this.selectionWrapper.appendChild(t)},this.selectRange=function(e,t){if(null==t&&(t=e),t<e){var n=t;t=e,e=n}if(null!=this.startIndex&&null!=this.endIndex){var o={number:0},i={number:0};e>this.startIndex&&(o.from="start",o.number=e-this.startIndex),t<this.endIndex&&(o.from="end",o.number=this.endIndex-t),
e<this.startIndex&&(i.from="start",i.number=this.startIndex-e),t>this.endIndex&&(i.from="end",i.number=t-this.endIndex);for(var r=0;r<o.number;r++)"start"===o.from?this.selectionWrapper.firstChild&&this.selectionWrapper.removeChild(this.selectionWrapper.firstChild):this.selectionWrapper.lastChild&&this.selectionWrapper.removeChild(this.selectionWrapper.lastChild);for(var r=0;r<i.number;r++)if("start"===i.from){var s=this.glyphs[this.startIndex-r],a=this.renderer.createNode(s),l=this.selectionWrapper.firstChild;l?this.selectionWrapper.insertBefore(a,this.selectionWrapper.firstChild):this.selectionWrapper.appendChild(a)}else{var s=this.glyphs[this.endIndex+r],a=this.renderer.createNode(s);this.selectionWrapper.appendChild(a)}}else for(var r=this.startIndex;r<=this.endIndex;r++){var s=this.glyphs[r];if(!s)break;var a=this.renderer.createNode(s);this.selectionWrapper.appendChild(a)}this.startIndex=e,this.endIndex=t},this.centerForStart=function(){return this.centerForGlyphIndex(this.startIndex)},this.centerCoordinatesForStart=function(){return this.centerCoordinatesForGlyphIndex(this.startIndex)},this.centerForEnd=function(){return this.centerForGlyphIndex(this.endIndex)},this.centerCoordinatesForEnd=function(){return this.centerCoordinatesForGlyphIndex(this.endIndex)},this.findGlyphIndexForPosition=function(e){for(var t=0;t<this.glyphs.length;t++){var n=this.glyphs[t];if(!n.dupped&&(e.leftP>=n.l&&e.leftP<=n.r&&e.topP>=n.t&&e.topP<=n.b))return t}},this.createRectFromPositions=function(e,t){return{topP:e.topP<=t.topP?e.topP:t.topP,bottomP:e.topP<=t.topP?t.topP:e.topP,leftP:e.leftP<=t.leftP?e.leftP:t.leftP,rightP:e.leftP<=t.leftP?t.leftP:e.leftP}},this.findFirstGlyphInRect=function(e){for(var t=0;t<this.glyphs.length;t++){var n=this.glyphs[t];if(this.isGlyphInRect(e,n))return t}},this.findLastGlyphInRect=function(e){for(var t=this.glyphs.length-1;t>=0;t--){var n=this.glyphs[t];if(this.isGlyphInRect(e,n))return t}},this.isGlyphInRect=function(e,t){var n=this.centerForGlyph(t);return!!(n.x>e.leftP&&n.x<e.rightP&&n.y>e.topP&&n.y<e.bottomP)},this.centerForGlyph=function(e){return{x:(e.l+e.r)/2,y:(e.t+e.b)/2}},this.centerForGlyphIndex=function(e){var t=this.glyphs[e];return t?this.centerForGlyph(t):{}},this.centerCoordinatesForGlyph=function(e){var t=this.centerForGlyph(e),n=this.renderer.pageWidth(),o=this.renderer.pageHeight();return{x:n*(t.x/100),y:o*(t.y/100)}},this.centerCoordinatesForGlyphIndex=function(e){var t=this.glyphs[e];return t?this.centerCoordinatesForGlyph(t):{}},this.findClosestGlyphIndexForPosition=function(e){for(var t,n=Infinity,o=0;o<this.glyphs.length;o++){var i=this.glyphs[o],r={x:(i.l+i.r)/2,y:(i.t+i.b)/2},s=Math.sqrt(Math.pow(e.leftP-r.x,2)+Math.pow(e.topP-r.y,2));s<n&&(t=o,n=s)}return t},this.extractEventToUseForPosition=function(e){var t=e;return e.originalEvent.touches&&(t=e.originalEvent.touches.length>0?e.originalEvent.touches[0]:e.originalEvent),t},this.normalizedEventPosition=function(e){var t=this.image.getBoundingClientRect(),n=e.pageY-t.top-VST.window.pageYOffset,o=e.pageX-t.left-VST.window.pageXOffset,i=n/t.height*100;return{left:o,top:n,leftP:o/t.width*100,topP:i}},this.pagePositionFromGlyph=function(e,t){t=t||this.image.getBoundingClientRect();var n=t.width*(e.l/100)+t.left,o=t.width*(e.r/100)+t.left,i=t.height*(e.t/100)+t.top,r=t.height*(e.b/100)+t.top;return{left:n,right:o,top:i,bottom:r,height:r-i,width:o-n}},this.pixelRectFromPercentageRect=function(e){return{top:this.image.height*((e.top||e.t)/100),left:this.image.width*((e.left||e.l)/100),bottom:this.image.height*((e.bottom||e.b)/100),right:this.image.width*((e.right||e.r)/100)}},this.findStartGlyph=function(){for(var e=0;e<this.glyphs.length;e++)this.glyphs[e]},this.rangeIsSelected=function(){return this.startIndex>=0&&this.endIndex>=0},this.onTouchStart=function(e){clearTimeout(this.touchStartTimeout);var t=this;this.touchStartTimeout=setTimeout(function(){t.onMouseDown(e)},300)},this.onMouseDown=function(e){this.deselectAll(),this.selecting=!0;var t=this.extractEventToUseForPosition(e);this.startPos=this.normalizedEventPosition(t),this.mouseDownIndex=this.findGlyphIndexForPosition(this.startPos),this.noSelectMouseMoves=0},this.onMouseMove=function(e){if(clearTimeout(this.touchStartTimeout),this.selecting){e.preventDefault(),e.stopImmediatePropagation();var t=this.extractEventToUseForPosition(e);if(this.endPos=this.normalizedEventPosition(t),this.fuzzySelect){var n=this.createRectFromPositions(this.startPos,this.endPos),o=this.findFirstGlyphInRect(n),i=this.findLastGlyphInRect(n);o&&i&&this.selectRange(o,i)}else{var i=this.findGlyphIndexForPosition(this.endPos);if(null==i)return;(null==this.mouseDownIndex||isNaN(this.mouseDownIndex))&&(this.mouseDownIndex=i>0?i-1:0),this.selectRange(this.mouseDownIndex,i)}}else this.noSelectMouseMoves++},this.onMouseUp=function(){this.selecting?(this.selecting=!1,this.rangeIsSelected()&&(this.setTextareaText(this.startIndex,this.endIndex),"ontouchstart"in window&&VST.trigger("book:selectionMade",this.getSelectedText()),this.textarea.select())):(clearTimeout(this.touchStartTimeout),"ontouchstart"in window&&0===this.noSelectMouseMoves&&this.deselectAll()),this.noSelectMouseMoves=0}},VST.PictureBook.TextSelection.prototype.getBoundingClientRect=function(){if(!this.rangeIsSelected())return null;for(var e={top:0,left:0,top:0,bottom:0,height:0,width:0},t=this.startIndex,n=this.endIndex,e={},o=t;o<=n;o++){var i=this.pagePositionFromGlyph(this.glyphs[o]);(!e.left||i.left<e.left)&&(e.left=i.left),(!e.top||i.top<e.top)&&(e.top=i.top),(!e.right||i.right>e.right)&&(e.right=i.right),(!e.bottom||i.bottom>e.bottom)&&(e.bottom=i.bottom)}return e.height=e.bottom-e.top,e.width=e.right-e.left,e},VST.PictureBook.TextSelection.prototype.getSelectedText=function(){return null==this.startIndex||null==this.endIndex?"":this.words.slice(this.startIndex,this.endIndex+1)},VST.PictureBook.TextSelection.prototype.setTextareaText=function(){this.textarea.value=this.getSelectedText(),this.positionTextArea()},VST.PictureBook.TextSelection.prototype.positionTextArea=function(){if(null!=this.startIndex){var e=this.glyphs[this.startIndex];null!=e&&(this.textarea.style.top=e.t+"%")}},VST.PictureBook.TextSelection.prototype.setupTextarea=function(e){if(!this.textarea){var t=e.createElement("textarea");t.setAttribute("id","pbk-words"),t.setAttribute("style","position: absolute; top: 0; left: -9999em;"),this.extrasWrapper.appendChild(t),this.textarea=t}}}.call(this,VST.$),function(){VST.PictureBook=VST.PictureBook||{},VST.PictureBook.GlyphRenderer=function(e,t){this.doc=e,this.glyphs=t.glyphs,this.rects=t.rects,this.createNode=function(e,t){var n=this.doc.createElement("span");return t=t||"",t+=" pbk-glyph",e.dup&&(t+=" duplicate"),n.setAttribute("class",t),n.setAttribute("style","position: absolute; left: "+e.l+"%; right: "+(100-e.r)+"%; top: "+e.t+"%; bottom: "+(100-e.b)+"%;"),n},this.createGlyphNode=this.createNode,this.pageWidth=function(){return this.rects.page.r-this.rects.page.l},this.pageHeight=function(){return this.rects.page.b-this.rects.page.t},this.topPositionFromPercentage=function(e){return this.pageHeight*(e/100)},this.leftPositionFromPercentage=function(e){return this.pageWidth*(e/100)}}}.call(this,VST.$),function(){VST.PictureBook.LinkRenderer=function(e){e&&(this.links=e.links),this.renderOneLink=function(e){this.container.appendChild(this.createNode(e))},this.createNode=function(e){var t=VST.document.createElement("a");return t.className="pbk-link",t.setAttribute("style","background:rgba(0,0,0,0); left: "+e.l+"%; right: "+(100-e.r)+"%; top: "+e.t+"%; bottom: "+(100-e.b)+"%;"),t.setAttribute("href",e.url),t},this.render=function(){if(this.links){this.container=VST.document.getElementById("pbk-penguins");for(var e=0;e<this.links.length;e++)this.renderOneLink(this.links[e])}}}}.call(this,VST.$),function(){var e,t,n,o;e=function(e,t){var n,o,i;return Jigsaw.socket.noteIcon(function(e){return VST.Models.Highlight.Settings=VST.$.extend({},{tag:"span"},VST.Models.Highlight.Settings,e)}),i=document.getElementById("epub-content").documentWindow,Browser.isIOS()&&(i=document.getElementById("epub-container")),VST.init(e,t,VSTEPUBModule(e,t),i),VST.sharedEpubModule.Init({alwaysUseMathJax:!0,skipNoteCSS:!0,noteIconHandler:VST.Highlights.noteIconHandler,mathJaxURL:"https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js",mathJaxConfig:"parent.MathJax = MathJax; VST.sharedEpubModule.ConfigMathJax(); MathJax.Hub.Startup.onload();"}),o=function(){return setTimeout(function(){return VST.Loading.scrollToHash()},0)},VST.$(e).off("hashchange ready load",o).on("hashchange ready load",o).trigger("hashchange"),n=function(){return VST.Loading.scrollToHash},VST.unbind("highlights:render",n),VST.bind("highlights:render",n),t.createNodeIterator?VST.Utils.throttlePageScrollEvent():VST.Utils.fireScrollOnlyOnStop()},n=function(e){return e.navigator.epubReadingSystem=e.parent.navigator.epubReadingSystem,e.epubReadingSystem=e.navigator.epubReadingSystem},o=function(e){var t,n;null==e&&(e={}),t=0,n=function(){return VST.fire("page:ready",e)};try{$(VST.document).find("body")}catch(e){t=250}return setTimeout(n,t)},t=function(e){return VST.currentPageData=e},VST.Loading={isMainReadingWindow:function(e){var t;return t=document.getElementById("epub-content"),t.contentWindow===e},contentReady:function(i,r,s){var a,l,c;if(null==s&&(s={}),this.isMainReadingWindow(i)&&null!=i.parent&&window.location===i.parent.location)return n(i,r),e(i,r),s.cfi?(a=!0,(c=this.relativeCFIFromHash())&&(s.cfi=s.cfi+"!"+c,s.cfiwithoutAssertions=s.cfiwithoutAssertions+"!"+VST.sharedEpubModule.StripCFIAssertions(c))):(a=!1,s.cfi=this.fullCFIFromHash(),s.cfi&&(s.cfiwithoutAssertions=VST.sharedEpubModule.StripCFIAssertions(s.cfi))),l=function(){return function(){var e;return s.scrollHeight=VST.scrollElement.scrollHeight||VST.$(VST.document).outerHeight(),s.scrollTop=VST.scrollElement.scrollY||VST.scrollElement.pageYOffset||0,e=r.body.getBoundingClientRect(),s.boundingRectWidth=e.width,s.boundingRectHeight=e.height,s.cfi?VST.fire("page:load",s):VST.once("internal:getCurrentPage:after",function(){return VST.fire("page:load",s)})}}(),"complete"===r.readyState?l():VST.once("internal:page:load",l),null!=VST.Book&&VST.Book.getISBN()===VST.currentBookData.isbn||(VST.Book=new VST.Models.Book(VST.currentBookData)),VST.Utils.getQueryParam(i,"create")&&VST.fire("viewer:create",VST.currentBookData),a?(o(s),t(s)):VST.Book.getCurrentPage(function(e,n){return s.page=n.getTitle(),s.cfi=s.cfi||n.getCFI(),s.cfi&&(s.cfiwithoutAssertions=VST.sharedEpubModule.StripCFIAssertions(s.cfi)),o(s),t(s),VST.fire("internal:getCurrentPage:after")}),VST.Highlights.addHighlightCSS(),VST.TTS.addTTSCSS()},initNextPage:function(){var e,t,n,o;if(n=document.getElementById("next-page"))return e=document.getElementById("epub-content"),this.removePreviousPage(),this.makePreviousPage(e),this.makeCurrentPage(n),o=n.contentWindow,t=o.document,this.callBookTypeContentReady(o,t)},initPreviousPage:function(){var e,t,n,o;if(n=document.getElementById("prev-page"))return e=document.getElementById("epub-content"),this.removeNextPage(),this.makeNextPage(e),this.makeCurrentPage(n),o=n.contentWindow,t=o.document,this.callBookTypeContentReady(o,t)},removePreviousPage:function(){var e;if(e=document.getElementById("prev-page"))return e.parentNode.removeChild(e)},removeNextPage:function(){var e;if(e=document.getElementById("next-page"))return e.parentNode.removeChild(e)},makeCurrentPage:function(e){return e.setAttribute("id","epub-content"),e.style.display="block"},makePreviousPage:function(e){return e.setAttribute("id","prev-page"),e.style.display="none"},makeNextPage:function(e){return e.setAttribute("id","next-page"),e.style.display="none"},callBookTypeContentReady:function(e,t){var n;return n=e.innerPageData,VST.Book.isEpub()?VST.Epub.contentReady(e,t,n):VST.Book.isPBK()?VST.PictureBook.contentReady(e,t,n):VST.Dash.contentReady(e,t,n)},scrollToHash:function(){var e,t,n,o,i,r,s,a,l,c,u,d,h;if((u=this.hashQueryObject())&&(u.cfi&&(c=u.cfi.split("!"),t=c.length>1?c[c.length-1]:c[0],VST.sharedEpubModule.ScrollToCFI(t)),u.highlight&&(i=VST.$(VST.document.body).find("[data-guid="+u.highlight+"]:first"),this.scrollToElement(i)),u.offset&&(l=VST.$(VST.document.body).find("[o="+u.offset+"]:first"),l.length>0?this.scrollToElement(l):(e=VST.$(VST.document.body).find("[o]"),a=parseInt(u.offset,10),h=this.scrollToElement,e.each(function(t){if(parseInt(this.getAttribute("o"),10)>a)return h(VST.$(e[t-1])),!1}))),u.eid&&(n=parseInt(u.eid,10),o=VST.$(VST.document.body).find("[eid="+n+"], [eid="+(n-1)+"], [eid="+(n+1)+"]").first(),this.scrollToElement(o)),u.page&&VST.Book&&VST.Book.hasPageBreaks())){r=VST.Book.createPageBreakIterator(VST.document),s=null;try{for(d=[];s=r.nextNode();){if(s.getAttribute("title")===u.page){this.scrollToElement(s);break}d.push(void 0)}return d}catch(e){e}finally{return}}},scrollToElement:function(e){var t,n,o;if(e=VST.$(e),e.length>0)return o=VST.$(VST.scrollElement),t=e.position().top,e[0].getAttribute("tabindex")||e[0].setAttribute("tabindex","0"),n=function(){return e[0].removeAttribute("tabindex")},o.scrollTop(t),VST.autofocus&&(e.focus(),setTimeout(n,2500)),VST.bind("page:load",function(){if(o.scrollTop(t),e[0].getAttribute("tabindex")||e[0].setAttribute("tabindex","0"),VST.autofocus)return e.focus(),setTimeout(n,2500)})},hashQueryObject:function(){var e;try{e=VST.window.location.hash}catch(e){return null}return e&&""!==e?QueryString.parse(e):null},fullCFIFromHash:function(){var e;return e=VST.Loading.hashQueryObject(),e&&e.cfi?e.cfi:null},relativeCFIFromHash:function(){var e,t,n,o,i,r,s,a;if(!(a=VST.Loading.hashQueryObject()))return null;if(a.cfi)return s=a.cfi.split("!"),s.length>1?s[s.length-1]:s[0];if(a.highlight)return n=VST.$(VST.document.body).find("[data-guid="+a.highlight+"]:first"),VST.sharedEpubModule.GetCFIForNode(n[0]);if(a.offset)return r=VST.$(VST.document.body).find("[o="+a.offset+"]:first"),VST.sharedEpubModule.GetCFIForNode(r[0]);if(a.eid)return e=parseInt(a.eid,10),t=VST.$(VST.document.body).find("[eid="+e+"], [eid="+(e-1)+"], [eid="+(e+1)+"]").first(),VST.sharedEpubModule.GetCFIForNode(t[0]);if(a.page&&VST.Book&&VST.Book.hasPageBreaks()){o=VST.Book.createPageBreakIterator(VST.document),i=null;try{for(;i=o.nextNode();)if(i.getAttribute("title")===a.page)return VST.sharedEpubModule.GetCFIForNode(i)}catch(e){e}finally{return null}}}},VST.Epub={contentReady:function(e,t,n){var o;if(VST.Loading.isMainReadingWindow(e))return VST.once("page:ready",function(){return EpubBook.highlightCurrentHighlights(),$(VST.$(t).find("video, audio")).bind("contextmenu",function(e){return e.preventDefault(),!1})}),VST.Loading.contentReady(e,t,n),o=t.documentElement,""===o.style.width&&""===o.style.minWidth&&(""===o.style.minWidth&&(o.style.minWidth="100%"),""===o.style.width&&(o.style.width="1px"),""===o.style["-webkit-text-size-adjust"]&&(o.style["-webkit-text-size-adjust"]="100%"),VST.$(t).find("a").css({"word-wrap":"break-word"})),VST.$(t).find("head").append('<style type="text/css" media="print">body > * { display: none !important; height: 0px !important; width: 0px !important; overflow: hidden; }body:before { content: "To print, please use the print page range feature within the application."; display: block !important;}</style>')}}}.call(this),function(){VST.bind("page:ready",function(){return VST.ClickHandlers.watchLinkClicks()}),VST.ClickHandlers={isNewWindowLink:function(e){return!!e.getAttribute("target")},isExternalLink:function(e,t){return t.hostname&&t.hostname.length>0&&e.location.hostname!==t.hostname},isAnchorURL:function(e){return 0===e.indexOf("#")},isJavascriptURL:function(e){return/^javascript/i.test(e)},isBlankHref:function(e){return!(e&&""!==e)},shouldIgnoreHref:function(e){var t,n;return n=e.split("/"),t=n[n.length-1],!(!/\./.test(t)||/\.x?html/i.test(e))},isIntraBookLink:function(e){return e.indexOf("#epubcfi")>-1},watchLinkClicks:function(){var e;return e=this,VST.$(VST.document).delegate("a","click.vstClick",function(t){var n,o,i,r;if(!(t.altKey||t.ctrlKey||t.metaKey||t.isDefaultPrevented()))if(r=VST.window,o=this.getAttribute("href"),e.isBlankHref(o));else if(e.isJavascriptURL(o));else if(e.isAnchorURL(o));else{if(e.isExternalLink(r,this)||e.isNewWindowLink(this))return t.preventDefault(),r.open(this.href);if(!e.shouldIgnoreHref(o))return e.isIntraBookLink(o)?(i=/\(([^)]+)\)/,n=i.exec(o)[1],Jigsaw.socketMethods.local.goToCFI.method(n)):(t.preventDefault(),Jigsaw.navigationRequested(),Jigsaw.navigateTo(this.href))}})}}}.call(this),$.extend($.expr[":"],{offsetGTE:function(e,t,n){return parseInt($(e).attr("o"))>=parseInt(n[3])},offsetLTE:function(e,t,n){return parseInt($(e).attr("o"))<=parseInt(n[3])}}),function(e){function t(e){return e=e.replace(/[-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),e.replace(/(^\s*)|(\s*$)/g,"")}e.extend({highlight:function(t,n,o,i,r){if(3===t.nodeType){var s=t.data.match(n);if(s){var a=document.createElement(o||"strong");a.className=i||"highlight",r&&a.setAttribute("style","background: "+r);var l=t.splitText(s.index);l.splitText(s[0].length);var c=l.cloneNode(!0);return a.appendChild(c),l.parentNode.replaceChild(a,l),1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName)&&(t.tagName!==o.toUpperCase()||t.className!==i))for(var u=0;u<t.childNodes.length;u++)u+=e.highlight(t.childNodes[u],n,o,i,r);return 0}}),e.fn.unhighlight=function(t){var n={className:"highlight",element:"strong"};return e.extend(n,t),this.find(n.element+"."+n.className).each(function(){var e=this.parentNode;e.replaceChild(this.firstChild,this),e.normalize()}).end()},e.fn.highlight=function(n,o){var i={className:"highlight",element:"strong",caseSensitive:!1,wordsOnly:!1};if(e.extend(i,o),n.constructor===String&&(n=[n]),n=e.grep(n,function(e){return""!=e}),0==n.length)return this;escapedWords=[];for(var r=n.length-1;r>=0;r--)escapedWords.unshift(t(n[r]));var s=i.caseSensitive?"":"i",a="("+escapedWords.join("|")+")";i.wordsOnly&&(a="\\b"+a+"\\b"),a=a.replace(/\s/g,"([\\s]+)");var l=new RegExp(a,s);return this.each(function(){e.highlight(this,l,i.element,i.className,i.color)})}}(VST.$);var QueryString={};!function(e){e.parse=function(e){return"string"!=typeof e?{}:(e=e.trim().replace(/^(\?|#)/,""),e?e.trim().split("&").reduce(function(e,t){var n=t.replace(/\+/g," ").split("="),o=n[0],i=n.slice(1).join("=");return o=decodeURIComponent(o),i=i===undefined?null:decodeURIComponent(i),e.hasOwnProperty(o)?Array.isArray(e[o])?e[o].push(i):e[o]=[e[o],i]:e[o]=i,e},{}):{})},e.stringify=function(e){return e?Object.keys(e).sort().map(function(t){var n=e[t];return Array.isArray(n)?n.sort().map(function(e){return encodeURIComponent(t)+"="+encodeURIComponent(e)}).join("&"):encodeURIComponent(t)+"="+encodeURIComponent(n)}).join("&"):""}}(QueryString),VST.TTS={_:{currentRate:1,currentPitch:1,currentVolume:1,currentVoice:window.speechSynthesis&&window.speechSynthesis.getVoices()[0],currentLang:"en-US"}},VST.TTS._.messageDump=[],VST.TTS._.messageHistory=[],function(e){e._.chunkElement=function(e){var t=VST.$(e).contents(),n=VST.$(e).text().length;if(t.length>0&&(n>250||t.length>5)){for(var o=[],i=0;i<t.length;i++){if(t.length<12&&t[i].className&&t[i].className.match("vstignore|vstskip|vsthighlight"))return[e];o=3===t[i].nodeType?o.concat(t[i]):o.concat(VST.TTS._.chunkElement(t[i]))}return o}return[e]},e._.updateProp=function(e,t,n){VST.TTS._[e]=n;var o=VST.TTS._.messageDump;o.length>0&&(o[o.length-1][t]=n)},e.addTTSCSS=function(){var e=VST.document.createElement("style");e.setAttribute("type","text/css"),e.innerText=".tts-highlight { background: yellow !important; }",VST.document.body.appendChild(e)},e.unhighlightElements=function(){VST.Book.isPBK()?VST.$(VST.document).find(".tts-highlight").remove():VST.$(VST.document).find(".tts-highlight").removeClass("tts-highlight")},e.highlightElement=function(e){if(VST.TTS.unhighlightElements(),VST.Book.isPBK()){var t=VST.document.getElementById("pbk-search"),n=VST.PictureBook.findTermsWithoutNormalization(t,[VST.$(e).text().trim()],"#FF0000");VST.PictureBook.highlightNodes(n,"transparent","tts-highlight")}else{3===e.nodeType&&(e=VST.$(e).parent()),VST.$(e).addClass("tts-highlight");var o=VST.$(e).position().top;VST.scrollElement.scrollTo(0,o-20)}},e.readElement=function(e,t){var n=VST.$(e).text().trim();if(n.length>0){VST.TTS._.messageHistory.push(e),VST.TTS.highlightElement(e);var o=new SpeechSynthesisUtterance(n);o.rate=VST.TTS._.currentRate,o.pitch=VST.TTS._.currentPitch,o.volume=VST.TTS._.currentVolume,o.voice=VST.TTS._.currentVoice,o.lang=VST.TTS._.currentLang,VST.TTS._.messageDump.push(o),o.onend=function(){VST.TTS.unhighlightElements(),t&&t()},window.speechSynthesis.speak(o)}else t&&t()},e.setVoice=function(e){var t=window.speechSynthesis&&window.speechSynthesis.getVoices();VST.TTS._.updateProp("currentVoice","voice",t[e])},e.setRate=function(e){VST.TTS._.updateProp("currentRate","rate",e)},e.setPitch=function(e){VST.TTS._.updateProp("currentPitch","pitch",e)},e.setVolume=function(e){VST.TTS._.updateProp("currentVolume","volume",e)},e.setLang=function(e){VST.TTS._.updateProp("currentLang","lang",e)},e.startReading=function(){if($(window).unload(function(){return VST.TTS.cancel(),!0}),VST.TTS._.currentQueue.length>0){var e=VST.TTS._.currentQueue.shift();VST.TTS.readElement(e,function(){VST.TTS.startReading()})}else VST.TTS.sendStatus(),VST.TTS.cancel()},e.startAtTop=function(){var e=VST.$(VST.document).find("body");VST.Book.isPBK()&&(e=VST.document.getElementById("pdf-ax-text"));var t=VST.TTS._.chunkElement(e);VST.TTS.cancel(),VST.TTS._.currentQueue=t,VST.TTS.startReading()},e.pause=function(){window.speechSynthesis.pause()},e.resume=function(){window.speechSynthesis.resume()},e.prev=function(){VST.TTS._.messageDump[VST.TTS._.messageDump.length-1].onend=undefined,window.speechSynthesis.cancel(),VST.TTS._.currentQueue.unshift(VST.TTS._.messageHistory.pop()),VST.TTS._.currentQueue.unshift(VST.TTS._.messageHistory.pop()),VST.TTS.startReading()},e.next=function(){VST.TTS._.messageDump[VST.TTS._.messageDump.length-1].onend=undefined,window.speechSynthesis.cancel(),VST.TTS.startReading()},e.cancel=function(){window.speechSynthesis.cancel(),VST.TTS._.currentQueue=[],VST.TTS.unhighlightElements()}}(VST.TTS),function(e,t){e.Handler.set("book:retrieveActivityData",function(e,n){null!=n&&null!=e&&t.ajax({url:this.buildAPIURL("/activities"),type:"GET",dataType:"json",data:e,success:function(e){n(e)},error:function(e,o,i){var r={errors:[]},s={status:e.status+"",title:o,detail:i};try{var a=t.parseJSON(e.responseText);r=t.extend(r,a)}catch(e){}r.errors.push(s),n(r)}})}),e.Handler.set("book:sendActivityData",function(e,n){null!=e&&t.ajax({url:this.buildAPIURL("/activities"),type:"POST",contentType:"application/json; charset=UTF-8",dataType:"json",data:JSON.stringify(e),success:function(e){n&&n(e)},error:function(e,o,i){if(n){var r={errors:[]},s={status:e.status+"",title:o,detail:i};try{var a=t.parseJSON(e.responseText);r=t.extend(r,a)}catch(e){}r.errors.push(s),n(r)}}})})}.call(this,VST,VST.$),function(e){e.Handler.set("book:getCurrentPageURL",function(){return e.window.location.pathname.replace(/\/?books\/[^\/]+\/(epub|cfi)/,"")}),e.Handler.set("book:getTOC",function(t){var n=function(t){e.ajax({url:this.buildAPIURL("/toc"),dataType:"json",success:function(e){t&&t(undefined,e)}},t)};e.Utils.multi("getTOC",n,function(e,n){t(e,n)},this)}),e.Handler.set("book:getPages",function(t){if(this.activePagesAjaxRequest=this.activePagesAjaxRequest||undefined,"undefined"!=typeof this.pages)t&&t(undefined,this.pages);else{var n=function(e,n){t(undefined,n)};if(e.EventDispatcher.once("book:getPages",n),!this.activePagesAjaxRequest){var o=this,i=function(t){o.activePagesAjaxRequest=undefined,e.EventDispatcher.fire("book:getPages",t)};this.activePagesAjaxRequest=e.ajax({url:o.buildAPIURL("/pages"),success:function(n){if(t){for(var r=[],s=0;s<n.length;s++){var a=n[s];a.url=a.absoluteURL,r.push(new e.Models.Page(a))}o.setPages(r),i(r)}},dataType:"json"},i)}}}),e.Handler.set("book:goToNextPage",function(t){Jigsaw.navigationRequested();var n=this;e.eventWrapper("book:nextPage",function(){n.getNextPage(function(o,i){if(i){var r=n.buildURL(i.getPath());Jigsaw.navigateTo(r,function(){t(undefined,i)})}else t(new e.Error("page not found"))})})}),e.Handler.set("book:goToPreviousPage",function(t){Jigsaw.navigationRequested();var n=this;e.eventWrapper("book:previousPage",function(){n.getPreviousPage(function(o,i){if(i){var r=n.buildURL(i.getPath());Jigsaw.navigateTo(r,function(){t(undefined,i)})}else t(new e.Error("page not found"))})})}),e.Handler.set("book:getNextPage",function(e){var t=this;this.getPages(function(n,o){for(var i,r=t.getCurrentPageURL().toUpperCase(),s=0;s<o.length;s++)if(r==o[s].getPath().toUpperCase()){i=s+1;break}e&&(i<o.length?e(undefined,o[i]):e(undefined,undefined))})}),e.Handler.set("book:getPreviousPage",function(e){var t,n=this.getCurrentPageURL().toUpperCase();this.getPages(function(o,i){for(var r=0;r<i.length;r++)if(n==i[r].getPath().toUpperCase()){t=r-1;break}e&&(t>=0?e(undefined,i[t]):e(undefined,undefined))})}),e.Handler.set("book:getNextPageURL",function(e){this.getNextPage(function(t,n){e&&(n?e(undefined,n.getPath()):e(undefined,undefined))})}),e.Handler.set("book:getPreviousPageURL",function(e){this.getPreviousPage(function(t,n){e&&(n?e(undefined,n.getPath()):e(undefined,undefined))})}),e.Handler.set("book:getCurrentPage",function(e){var t,n=this.getCurrentPageURL().toUpperCase();this.getPages(function(o,i){for(var r=0;r<i.length;r++)if(n==i[r].getPath().toUpperCase()){t=i[r];break}e&&e(undefined,t)})}),e.Handler.set("book:hasNextPage",function(e){this.getNextPage(function(t,n){e&&(n?e(undefined,!0):e(undefined,!1))})}),e.Handler.set("book:hasPreviousPage",function(e){this.getPreviousPage(function(t,n){e&&(n?e(undefined,!0):e(undefined,!1))})}),e.Handler.set("book:getPageBreaks",function(t){var n=this;return this.hasPageBreaks()?this.pageBreakList&&this.pageBreakList.length>0?t(undefined,this.pageBreakList):void e.ajax({url:this.buildAPIURL("/pagebreaks"),dataType:"json",success:function(e){n.setPageBreaks(e),t&&t(undefined,e)}},t):t(new e.Error("Book does not have pagebreaks"))}),e.Handler.set("book:getHighlights",function(t){var n=function(t){e.ajaxEventWrapper("getHighlights",{url:this.buildAPIURL("/highlights"),success:function(e){t(undefined,e)},dataType:"json"},t)};e.Utils.multi("getHighlights",n,function(e,n){t(e,n)},this)})}.call(window,VST,VST.$),function(e,t){e.Handler.set("book:getScores",function(n,o){null!=o&&null!=n&&(e.Utils.isArray(n)||(n=[n]),t.ajax({url:this.buildAPIURL("/scores"),type:"GET",dataType:"json",data:{score_ids:n},success:function(e){o(null,e)},statusCode:{404:function(){o(new e.Error("scores not found"))}},error:function(t,n,i){/not found/i.test(i)||o(new e.Error(i))}}))}),e.Handler.set("book:reportScores",function(n,o){null!=n&&(e.Utils.isArray(n)||(n=[n]),t.ajax({url:this.buildAPIURL("/scores"),type:"POST",dataType:"json",data:{scores:n},success:function(e){o&&o(null,e)},error:function(t,n,i){o&&o(new e.Error(i))}}))})}.call(this,VST,VST.$),function(e){e.Handler.set("user:books",function(t,n){e.ajax({url:"/books",type:"GET",data:t,dataType:"json",success:function(e){n&&n(undefined,e)},error:function(t,o,i){n&&n(new e.Error(i))}},n)}),e.Handler.set("user:getInfo",function(t){if(t){var n=function(t){e.ajax({url:"/user",success:function(e){t(undefined,e)},error:function(n){t(new e.Error(n))},dataType:"json"},t)};e.Utils.multi("getUserInfo",n,t,this)}})}.call(this,VST,VST.$),function(){this.Browser={init:function(){},isIE:function(){},isIE11:function(){},isChrome:function(){},isSafari:function(){return-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")},isFirefox:function(){},isOld:function(){},isLimited:function(){},isAndroid:function(){},isIOS:function(){return/(iPhone|iPad|iPod)/.test(navigator.userAgent)},isSurface:function(){return window.navigator.pointerEnabled||window.navigator.msPointerEnabled},isIPhone:function(){},isIPad:function(){},isMobile:function(){}}}.call(this,jQuery),function(e,t,n,o,i,r){function s(e,t){var n=typeof e[t];return"function"==n||!("object"!=n||!e[t])||"unknown"==n}function a(e,t){return!("object"!=typeof e[t]||!e[t])}function l(e){return"[object Array]"===Object.prototype.toString.call(e)}function c(){var e="Shockwave Flash",t="application/x-shockwave-flash";if(!S(navigator.plugins)&&"object"==typeof navigator.plugins[e]){var n=navigator.plugins[e].description;n&&!S(navigator.mimeTypes)&&navigator.mimeTypes[t]&&navigator.mimeTypes[t].enabledPlugin&&(N=n.match(/\d+/g))}if(!N){var o;try{o=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),N=Array.prototype.slice.call(o.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),o=null}catch(e){}}if(!N)return!1;var i=parseInt(N[0],10),r=parseInt(N[1],10);return I=i>9&&r>0,!0}function u(){if(!G){G=!0;for(var e=0;e<z.length;e++)z[e]();z.length=0}}function d(e,t){if(G)return void e.call(t);z.push(function(){e.call(t)})}function h(){var e=parent;if(""!==j)for(var t=0,n=j.split(".");t<n.length;t++)e=e[n[t]];return e.easyXDM}function f(t){return e.easyXDM=O,j=t,j&&(U="easyXDM_"+j.replace(".","_")+"_"),D}function g(e){return e.match(B)[3]}function p(e){return e.match(B)[4]||""}function m(e){var t=e.toLowerCase().match(B);if(!t)return"";var n=t[2],o=t[3],i=t[4]||"";return("http:"==n&&":80"==i||"https:"==n&&":443"==i)&&(i=""),n+"//"+o+i}function T(e){if(e=e.replace(M,"$1/"),!e.match(/^(http||https):\/\//)){var t="/"===e.substring(0,1)?"":n.pathname;"/"!==t.substring(t.length-1)&&(t=t.substring(0,t.lastIndexOf("/")+1)),e=n.protocol+"//"+n.host+t+e}for(;L.test(e);)e=e.replace(L,"");return e}function v(e,t){var n="",o=e.indexOf("#");-1!==o&&(n=e.substring(o),e=e.substring(0,o));var i=[];for(var s in t)t.hasOwnProperty(s)&&i.push(s+"="+r(t[s]));return e+(_?"#":-1==e.indexOf("?")?"?":"&")+i.join("&")+n}function S(e){return void 0===e}function y(e,t,n){var o;for(var i in t)t.hasOwnProperty(i)&&(i in e?(o=t[i],"object"==typeof o?y(e[i],o,n):n||(e[i]=t[i])):e[i]=t[i]);return e}function b(){var e=t.body.appendChild(t.createElement("form")),n=e.appendChild(t.createElement("input"));n.name=U+"TEST"+R,E=n!==e.elements[n.name],t.body.removeChild(e)}function x(e){S(E)&&b();var n;n=E?t.createElement('<iframe name="'+e.props.name+'" allowfullscreen="allowfullscreen" />'):t.createElement("IFRAME"),n.id=n.name=e.props.name,delete e.props.name,n.allowFullscreen="allowfullscreen","string"==typeof e.container&&(e.container=t.getElementById(e.container)),e.container||(y(n.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=t.body);var o=e.props.src;if(e.props.src="javascript:false",y(n,e.props),n.border=n.frameBorder=0,n.allowTransparency=!0,e.container.appendChild(n),e.onLoad&&P(n,"load",e.onLoad),e.usePost){var i,r=e.container.appendChild(t.createElement("form"));if(r.target=n.name,r.action=o,r.method="POST","object"==typeof e.usePost)for(var s in e.usePost)e.usePost.hasOwnProperty(s)&&(E?i=t.createElement('<input name="'+s+'"/>'):(i=t.createElement("INPUT"),i.name=s),i.value=e.usePost[s],r.appendChild(i));r.submit(),r.parentNode.removeChild(r)}else n.src=o;return e.props.src=o,n}function V(e,t){"string"==typeof e&&(e=[e]);for(var n,o=e.length;o--;)if(n=e[o],n=new RegExp("^"==n.substr(0,1)?n:"^"+n.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),n.test(t))return!0;return!1}function w(o){var i,r=o.protocol;if(o.isHost=o.isHost||S($.xdm_p),_=o.hash||!1,o.props||(o.props={}),o.isHost)o.remote=T(o.remote),o.channel=o.channel||"default"+R++,o.secret=Math.random().toString(16).substring(2),S(r)&&(r=m(n.href)==m(o.remote)?"4":s(e,"postMessage")||s(t,"postMessage")?"1":o.swf&&s(e,"ActiveXObject")&&c()?"6":"Gecko"===navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?"5":o.remoteHelper?"2":"0");else if(o.channel=$.xdm_c.replace(/["'<>\\]/g,""),o.secret=$.xdm_s,o.remote=$.xdm_e.replace(/["'<>\\]/g,""),r=$.xdm_p,o.acl&&!V(o.acl,o.remote))throw new Error("Access denied for "+o.remote);switch(o.protocol=r,r){case"0":if(y(o,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),o.isHost){if(!o.local){for(var a,l=n.protocol+"//"+n.host,u=t.body.getElementsByTagName("img"),d=u.length;d--;)if(a=u[d],a.src.substring(0,l.length)===l){o.local=a.src;break}o.local||(o.local=e)}var h={xdm_c:o.channel,xdm_p:0};o.local===e?(o.usePolling=!0,o.useParent=!0,o.local=n.protocol+"//"+n.host+n.pathname+n.search,h.xdm_e=o.local,h.xdm_pa=1):h.xdm_e=T(o.local),o.container&&(o.useResize=!1,h.xdm_po=1),o.remote=v(o.remote,h)}else y(o,{channel:$.xdm_c,remote:$.xdm_e,useParent:!S($.xdm_pa),usePolling:!S($.xdm_po),useResize:!o.useParent&&o.useResize})
;i=[new D.stack.HashTransport(o),new D.stack.ReliableBehavior({}),new D.stack.QueueBehavior({encode:!0,maxLength:4e3-o.remote.length}),new D.stack.VerifyBehavior({initiate:o.isHost})];break;case"1":i=[new D.stack.PostMessageTransport(o)];break;case"2":o.isHost&&(o.remoteHelper=T(o.remoteHelper)),i=[new D.stack.NameTransport(o),new D.stack.QueueBehavior,new D.stack.VerifyBehavior({initiate:o.isHost})];break;case"3":i=[new D.stack.NixTransport(o)];break;case"4":i=[new D.stack.SameOriginTransport(o)];break;case"5":i=[new D.stack.FrameElementTransport(o)];break;case"6":N||c(),i=[new D.stack.FlashTransport(o)]}return i.push(new D.stack.QueueBehavior({lazy:o.lazy,remove:!0})),i}function C(e){for(var t,n={incoming:function(e,t){this.up.incoming(e,t)},outgoing:function(e,t){this.down.outgoing(e,t)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},o=0,i=e.length;o<i;o++)t=e[o],y(t,n,!0),0!==o&&(t.down=e[o-1]),o!==i-1&&(t.up=e[o+1]);return t}function k(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var E,N,I,P,F,A=this,R=Math.floor(1e4*Math.random()),H=Function.prototype,B=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,L=/[\-\w]+\/\.\.\//,M=/([^:])\/\//g,j="",D={},O=e.easyXDM,U="easyXDM_",_=!1;if(s(e,"addEventListener"))P=function(e,t,n){e.addEventListener(t,n,!1)},F=function(e,t,n){e.removeEventListener(t,n,!1)};else{if(!s(e,"attachEvent"))throw new Error("Browser not supported");P=function(e,t,n){e.attachEvent("on"+t,n)},F=function(e,t,n){e.detachEvent("on"+t,n)}}var W,G=!1,z=[];if("readyState"in t?(W=t.readyState,G="complete"==W||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==W||"interactive"==W)):G=!!t.body,!G){if(s(e,"addEventListener"))P(t,"DOMContentLoaded",u);else if(P(t,"readystatechange",function(){"complete"==t.readyState&&u()}),t.documentElement.doScroll&&e===top){var J=function(){if(!G){try{t.documentElement.doScroll("left")}catch(e){return void o(J,1)}u()}};J()}P(e,"load",u)}var $=function(e){e=e.substring(1).split("&");for(var t,n={},o=e.length;o--;)t=e[o].split("="),n[t[0]]=i(t[1]);return n}(/xdm_e=/.test(n.search)?n.search:n.hash),q=function(){var e={},t={a:[1,2,3]},n='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(t).replace(/\s/g,"")===n?JSON:(Object.toJSON&&Object.toJSON(t).replace(/\s/g,"")===n&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(t=n.evalJSON(),t.a&&3===t.a.length&&3===t.a[2]&&(e.parse=function(e){return e.evalJSON()})),e.stringify&&e.parse?(q=function(){return e},e):null)};y(D,{version:"2.4.19.3",query:$,stack:{},apply:y,getJSONObject:q,whenReady:d,noConflict:f}),D.DomHelper={on:P,un:F,requiresJSON:function(n){a(e,"JSON")||t.write('<script type="text/javascript" src="'+n+'"></script>')}},function(){var e={};D.Fn={set:function(t,n){e[t]=n},get:function(t,n){if(e.hasOwnProperty(t)){var o=e[t];return n&&delete e[t],o}}}}(),D.Socket=function(e){var t=C(w(e).concat([{incoming:function(t,n){e.onMessage(t,n)},callback:function(t){e.onReady&&e.onReady(t)}}])),n=m(e.remote);this.origin=m(e.remote),this.destroy=function(){t.destroy()},this.postMessage=function(e){t.outgoing(e,n)},t.init()},D.Rpc=function(e,t){if(t.local)for(var n in t.local)if(t.local.hasOwnProperty(n)){var o=t.local[n];"function"==typeof o&&(t.local[n]={method:o})}var i=C(w(e).concat([new D.stack.RpcBehavior(this,t),{callback:function(t){e.onReady&&e.onReady(t)}}]));this.origin=m(e.remote),this.destroy=function(){i.destroy()},i.init()},D.stack.SameOriginTransport=function(e){var t,i,r,s;return t={outgoing:function(e,t,n){r(e),n&&n()},destroy:function(){i&&(i.parentNode.removeChild(i),i=null)},onDOMReady:function(){s=m(e.remote),e.isHost?(y(e.props,{src:v(e.remote,{xdm_e:n.protocol+"//"+n.host+n.pathname,xdm_c:e.channel,xdm_p:4}),name:U+e.channel+"_provider"}),i=x(e),D.Fn.set(e.channel,function(e){return r=e,o(function(){t.up.callback(!0)},0),function(e){t.up.incoming(e,s)}})):(r=h().Fn.get(e.channel,!0)(function(e){t.up.incoming(e,s)}),o(function(){t.up.callback(!0)},0))},init:function(){d(t.onDOMReady,t)}}},D.stack.FlashTransport=function(e){function i(e){o(function(){a.up.incoming(e,c)},0)}function s(n){var o=e.swf+"?host="+e.isHost,i="easyXDM_swf_"+Math.floor(1e4*Math.random());D.Fn.set("flash_loaded"+n.replace(/[\-.]/g,"_"),function(){D.stack.FlashTransport[n].swf=u=h.firstChild;for(var e=D.stack.FlashTransport[n].queue,t=0;t<e.length;t++)e[t]();e.length=0}),e.swfContainer?h="string"==typeof e.swfContainer?t.getElementById(e.swfContainer):e.swfContainer:(h=t.createElement("div"),y(h.style,I&&e.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),t.body.appendChild(h));var s="callback=flash_loaded"+r(n.replace(/[\-.]/g,"_"))+"&proto="+A.location.protocol+"&domain="+r(g(A.location.href))+"&port="+r(p(A.location.href))+"&ns="+r(j);h.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+i+"' data='"+o+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+o+"'></param><param name='flashvars' value='"+s+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+s+"' allowScriptAccess='always' wmode='transparent' src='"+o+"' height='1' width='1'></embed></object>"}var a,l,c,u,h;return a={outgoing:function(t,n,o){u.postMessage(e.channel,t.toString()),o&&o()},destroy:function(){try{u.destroyChannel(e.channel)}catch(e){}u=null,l&&(l.parentNode.removeChild(l),l=null)},onDOMReady:function(){c=e.remote,D.Fn.set("flash_"+e.channel+"_init",function(){o(function(){a.up.callback(!0)})}),D.Fn.set("flash_"+e.channel+"_onMessage",i),e.swf=T(e.swf);var t=g(e.swf),r=function(){D.stack.FlashTransport[t].init=!0,u=D.stack.FlashTransport[t].swf,u.createChannel(e.channel,e.secret,m(e.remote),e.isHost),e.isHost&&(I&&e.swfNoThrottle&&y(e.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),y(e.props,{src:v(e.remote,{xdm_e:m(n.href),xdm_c:e.channel,xdm_p:6,xdm_s:e.secret}),name:U+e.channel+"_provider"}),l=x(e))};D.stack.FlashTransport[t]&&D.stack.FlashTransport[t].init?r():D.stack.FlashTransport[t]?D.stack.FlashTransport[t].queue.push(r):(D.stack.FlashTransport[t]={queue:[r]},s(t))},init:function(){d(a.onDOMReady,a)}}},D.stack.PostMessageTransport=function(t){function i(e){if(e.origin)return m(e.origin);if(e.uri)return m(e.uri);if(e.domain)return n.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}function r(e){var n=i(e);n==c&&e.data.substring(0,t.channel.length+1)==t.channel+" "&&s.up.incoming(e.data.substring(t.channel.length+1),n)}var s,a,l,c;return s={outgoing:function(e,n,o){l.postMessage(t.channel+" "+e,n||c),o&&o()},destroy:function(){F(e,"message",r),a&&(l=null,a.parentNode.removeChild(a),a=null)},onDOMReady:function(){if(c=m(t.remote),t.isHost){var i=function(n){n.data==t.channel+"-ready"&&(l="postMessage"in a.contentWindow?a.contentWindow:a.contentWindow.document,F(e,"message",i),P(e,"message",r),o(function(){s.up.callback(!0)},0))};P(e,"message",i),y(t.props,{src:v(t.remote,{xdm_e:m(n.href),xdm_c:t.channel,xdm_p:1}),name:U+t.channel+"_provider"}),a=x(t)}else P(e,"message",r),l="postMessage"in e.parent?e.parent:e.parent.document,l.postMessage(t.channel+"-ready",c),o(function(){s.up.callback(!0)},0)},init:function(){d(s.onDOMReady,s)}}},D.stack.FrameElementTransport=function(i){var r,s,a,l;return r={outgoing:function(e,t,n){a.call(this,e),n&&n()},destroy:function(){s&&(s.parentNode.removeChild(s),s=null)},onDOMReady:function(){l=m(i.remote),i.isHost?(y(i.props,{src:v(i.remote,{xdm_e:m(n.href),xdm_c:i.channel,xdm_p:5}),name:U+i.channel+"_provider"}),s=x(i),s.fn=function(e){return delete s.fn,a=e,o(function(){r.up.callback(!0)},0),function(e){r.up.incoming(e,l)}}):(t.referrer&&m(t.referrer)!=$.xdm_e&&(e.top.location=$.xdm_e),a=e.frameElement.fn(function(e){r.up.incoming(e,l)}),r.up.callback(!0))},init:function(){d(r.onDOMReady,r)}}},D.stack.NameTransport=function(e){function t(t){var n=e.remoteHelper+(a?"#_3":"#_2")+e.channel;l.contentWindow.sendMessage(t,n)}function n(){a?2!=++u&&a||s.up.callback(!0):(t("ready"),s.up.callback(!0))}function i(e){s.up.incoming(e,f)}function r(){h&&o(function(){h(!0)},0)}var s,a,l,c,u,h,f,g;return s={outgoing:function(e,n,o){h=o,t(e)},destroy:function(){l.parentNode.removeChild(l),l=null,a&&(c.parentNode.removeChild(c),c=null)},onDOMReady:function(){a=e.isHost,u=0,f=m(e.remote),e.local=T(e.local),a?(D.Fn.set(e.channel,function(t){a&&"ready"===t&&(D.Fn.set(e.channel,i),n())}),g=v(e.remote,{xdm_e:e.local,xdm_c:e.channel,xdm_p:2}),y(e.props,{src:g+"#"+e.channel,name:U+e.channel+"_provider"}),c=x(e)):(e.remoteHelper=e.remote,D.Fn.set(e.channel,i));var t=function(){var i=l||this;F(i,"load",t),D.Fn.set(e.channel+"_load",r),function e(){"function"==typeof i.contentWindow.sendMessage?n():o(e,50)}()};l=x({props:{src:e.local+"#_4"+e.channel},onLoad:t})},init:function(){d(s.onDOMReady,s)}}},D.stack.HashTransport=function(t){function n(e){if(p){var n=t.remote+"#"+f+++"_"+e;(l||!T?p.contentWindow:p).location=n}}function i(e){h=e,a.up.incoming(h.substring(h.indexOf("_")+1),v)}function r(){if(g){var e=g.location.href,t="",n=e.indexOf("#");-1!=n&&(t=e.substring(n)),t&&t!=h&&i(t)}}function s(){c=setInterval(r,u)}var a,l,c,u,h,f,g,p,T,v;return a={outgoing:function(e){n(e)},destroy:function(){e.clearInterval(c),!l&&T||p.parentNode.removeChild(p),p=null},onDOMReady:function(){if(l=t.isHost,u=t.interval,h="#"+t.channel,f=0,T=t.useParent,v=m(t.remote),l){if(y(t.props,{src:t.remote,name:U+t.channel+"_provider"}),T)t.onLoad=function(){g=e,s(),a.up.callback(!0)};else{var n=0,i=t.delay/50;!function e(){if(++n>i)throw new Error("Unable to reference listenerwindow");try{g=p.contentWindow.frames[U+t.channel+"_consumer"]}catch(e){}g?(s(),a.up.callback(!0)):o(e,50)}()}p=x(t)}else g=e,s(),T?(p=parent,a.up.callback(!0)):(y(t,{props:{src:t.remote+"#"+t.channel+new Date,name:U+t.channel+"_consumer"},onLoad:function(){a.up.callback(!0)}}),p=x(t))},init:function(){d(a.onDOMReady,a)}}},D.stack.ReliableBehavior=function(){var e,t,n=0,o=0,i="";return e={incoming:function(r,s){var a=r.indexOf("_"),l=r.substring(0,a).split(",");r=r.substring(a+1),l[0]==n&&(i="",t&&t(!0)),r.length>0&&(e.down.outgoing(l[1]+","+n+"_"+i,s),o!=l[1]&&(o=l[1],e.up.incoming(r,s)))},outgoing:function(r,s,a){i=r,t=a,e.down.outgoing(o+","+ ++n+"_"+r,s)}}},D.stack.QueueBehavior=function(e){function t(){if(e.remove&&0===a.length)return void k(n);if(!l&&0!==a.length&&!s){l=!0;var i=a.shift();n.down.outgoing(i.data,i.origin,function(e){l=!1,i.callback&&o(function(){i.callback(e)},0),t()})}}var n,s,a=[],l=!0,c="",u=0,d=!1,h=!1;return n={init:function(){S(e)&&(e={}),e.maxLength&&(u=e.maxLength,h=!0),e.lazy?d=!0:n.down.init()},callback:function(e){l=!1;var o=n.up;t(),o.callback(e)},incoming:function(t,o){if(h){var r=t.indexOf("_"),s=parseInt(t.substring(0,r),10);c+=t.substring(r+1),0===s&&(e.encode&&(c=i(c)),n.up.incoming(c,o),c="")}else n.up.incoming(t,o)},outgoing:function(o,i,s){e.encode&&(o=r(o));var l,c=[];if(h){for(;0!==o.length;)l=o.substring(0,u),o=o.substring(l.length),c.push(l);for(;l=c.shift();)a.push({data:c.length+"_"+l,origin:i,callback:0===c.length?s:null})}else a.push({data:o,origin:i,callback:s});d?n.down.init():t()},destroy:function(){s=!0,n.down.destroy()}}},D.stack.VerifyBehavior=function(e){function t(){o=Math.random().toString(16).substring(2),n.down.outgoing(o)}var n,o,i;return n={incoming:function(r,s){var a=r.indexOf("_");-1===a?r===o?n.up.callback(!0):i||(i=r,e.initiate||t(),n.down.outgoing(r)):r.substring(0,a)===i&&n.up.incoming(r.substring(a+1),s)},outgoing:function(e,t,i){n.down.outgoing(o+"_"+e,t,i)},callback:function(){e.initiate&&t()}}},D.stack.RpcBehavior=function(e,t){function n(e){e.jsonrpc="2.0",r.down.outgoing(s.stringify(e))}function o(e,t){var o=Array.prototype.slice;return function(){var i,r=arguments.length,s={method:t};r>0&&"function"==typeof arguments[r-1]?(r>1&&"function"==typeof arguments[r-2]?(i={success:arguments[r-2],error:arguments[r-1]},s.params=o.call(arguments,0,r-2)):(i={success:arguments[r-1]},s.params=o.call(arguments,0,r-1)),c[""+ ++a]=i,s.id=a):s.params=o.call(arguments,0),e.namedParams&&1===s.params.length&&(s.params=s.params[0]),n(s)}}function i(e,t,o,i){if(!o)return void(t&&n({id:t,error:{code:-32601,message:"Procedure not found."}}));var r,s;t?(r=function(e){r=H,n({id:t,result:e})},s=function(e,o){s=H;var i={id:t,error:{code:-32099,message:e}};o&&(i.error.data=o),n(i)}):r=s=H,l(i)||(i=[i]);try{var a=o.method.apply(o.scope,i.concat([r,s]));S(a)||r(a)}catch(e){s(e.message)}}var r,s=t.serializer||q(),a=0,c={};return r={incoming:function(e){var o=s.parse(e);if(o.method)t.handle?t.handle(o,n):i(o.method,o.id,t.local[o.method],o.params);else{var r=c[o.id];o.error?r.error&&r.error(o.error):r.success&&r.success(o.result),delete c[o.id]}},init:function(){if(t.remote)for(var n in t.remote)t.remote.hasOwnProperty(n)&&(e[n]=o(t.remote[n],n));r.down.init()},destroy:function(){for(var n in t.remote)t.remote.hasOwnProperty(n)&&e.hasOwnProperty(n)&&delete e[n];r.down.destroy()}}},A.easyXDM=D}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent),function(){easyXDM.DomHelper.requiresJSON("/assets/easyXDM/json2-0e0bed69eef047ddf7305f397ea712946882d84801a6f903442070a0e9616bac.js"),Jigsaw.socketMethods={local:{},remote:{scrollTo:{},snippetHasNextPage:{},snippetHasPreviousPage:{},searchInSnippet:{}}},Jigsaw.socketOptions={};var e=function(e,t){return[function(n){if(e){if(t){var o={};o[t]=n,n=o}var i=new Jigsaw.Response({status:"ok",data:n});e(i)}},function(t){if(e){var n=t.data||{};n.message=t.message,n.status="error",n.data={};for(var o in t.data)"data"!==o&&(n.data[o]=t.data[o]);var i=new Jigsaw.Response(n);e(i)}}]};Jigsaw.addRemoteMethod=function(t,n,o){o=o||{};var i=o.handler||function(){this.socket[t].apply(this,arguments)};this.socketMethods.remote[t]={},n.prototype[t]=function(){var t=Array.prototype.slice.call(arguments),n=function(){},r=t[t.length-1];r&&"function"==typeof r&&(n=t.pop()),t=t.concat(e(n,o.dataAttr)),i.apply(this,t)}},Jigsaw.addLocalSocketMethods=function(e){for(var t in e)e.hasOwnProperty(t)&&(Jigsaw.socketMethods.local[t]=e[t])},Jigsaw.Utils={defaultCallbacks:e}}.call(this),function(){var e,t=Jigsaw.Viewer?Jigsaw.Viewer.prototype:Jigsaw,n=function(e){var t=e.name?e.name:e;return this.uuid&&(t+="."+this.uuid),t},o=function(e){var t=e.name?e.name:e;return this.uuid&&(t=t.replace("."+this.uuid,"")),t},i=function(e,i){t.bind=function(t,o){e(i).on(n.call(this,t),o)},t.once=function(t,o){e(i).one(n.call(this,t),o)},t.unbind=function(t,o){e(i).off(n.call(this,t),o)},Jigsaw.socketMethods.remote.trigger={},t.trigger=function(t,r,s){null==s&&(s=!0);var a=n.call(this,t);e(i).trigger(a,r),s&&this.socket.trigger(o.call(this,a),r)},Jigsaw.socketMethods.local.trigger={method:function(e,t){var o=n.call(this,e);(this.trigger||Jigsaw.trigger)(o,t,!1)}}},r=document;e="undefined"!=typeof Jigsaw$?Jigsaw$:$,"undefined"!=typeof VST&&VST.$&&(e=VST.$,r=VST.document||r),i.call(this,e,r)}.call(this),function(){var e=function(e){null==e&&(e={}),this.status=e.status||"ok",this.message=e.message,this.data=e.data,this.code=e.code,this.isSuccess=function(){return"ok"==this.status},this.code||(this.isSuccess()?this.code=200:this.code=500)};this.Jigsaw=this.Jigsaw||{},this.Jigsaw.Response=e}.call(window),function(){LESS_THAN=-1,EQUAL=0,GREATER_THAN=1;var e={compareCFIs:function(e,t){if(null==e&&(e=""),null==t&&(t=""),e=e.replace(/!$/,""),t=t.replace(/!$/,""),e===t)return EQUAL;for(var n=/[\/@~:!]/,o=/(\[.+\]|[^\d])/g,i=e.split(n),r=t.split(n),s=0;;s++){var a=i[s],l=r[s];if(null==a&&null==l)return EQUAL;if(null==a)return LESS_THAN;if(null==l)return GREATER_THAN;if(a!==l){if(a=parseInt(a.replace(o,""),10),l=parseInt(l.replace(o,""),10),a<l)return LESS_THAN;if(a>l)return GREATER_THAN}}}};this.Jigsaw.CFIUtils=e}.call(window),function(e){var t={};t[atob("eC12aXRhbHNvdXJjZS1rZWVwYWxpdmU=")]=(!!window.process).toString(),e.ajaxSetup({headers:t}),Jigsaw.socketOptions.onReady=function(){};var n=function(t){return function(n,o,i){var r;try{n.responseText&&(r=e.parseJSON(n.responseText))}catch(e){}t&&t(i,{code:n.status,responseStatus:o,errors:r})}},o=function(e){return function(t){e&&e(t)}},i=function(e,t){for(var n=e.length-1;n>=0;n--)if(e[n].label==t)return e[n]},r=function(e,t){for(var n=0;n<e.length;n++)if(e[n].label.toUpperCase().indexOf(t.toUpperCase())>=0)return e[n]},s=function(e){return e.replace(/[A-Z]/g,function(e){return"_"+e.toLowerCase()})},a=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[s(n)]=e[n]);return t},l=function(t,i,r){e.ajax({url:VST.Book.buildAPIURL("/highlights"),data:{highlight:t},dataType:"json",type:"POST",success:function(e){VST.Book.isDash()?(VST.sharedEpubModule.ClearSelection(),VST.Dash.highlightRenderer([e]).render(VST.document.body)):VST.Book.isEpub()?(VST.sharedEpubModule.ClearSelection(),EpubBook.highlightOneHighlight(e,VST.currentPageData.cfi.split("!")[0])):(VST.PictureBook.selection.deselectAll(),VST.PictureBook.renderOneHighlight(e)),o(i)(e)},error:n(r)})},c=function(t,i,r,s){e.ajax({url:"/search/"+t,dataType:"json",data:{q:i},type:"GET",success:o(r),error:n(s)})};isInSnippet=function(e){return e.indexOf&&-1!==e.indexOf("/")?(-1===e.indexOf("!")&&(e+="!/4"),u(e)):isPageInSnippet(e)},isPageInSnippet=function(e){return!(!e||!VST.snippetSettings)&&(VST.snippetSettings.start.indexOf&&-1!==VST.snippetSettings.start.indexOf("/")?u("/"+e+"!/4"):e>=VST.snippetSettings.start&&e<=VST.snippetSettings.end)};for(var u=function(e){if(!e||!VST.snippetSettings)return!1;try{return e=e.replace(/\/\d*[13579]:\d+$/,""),VST.snippetSettings.end&&Jigsaw.CFIUtils.compareCFIs(e,VST.snippetSettings.end)<=0&&VST.snippetSettings.start&&Jigsaw.CFIUtils.compareCFIs(e,VST.snippetSettings.start)>=0}catch(e){return!1}},d=function(e){h();var t=e.term||"",n=t,o=e.color||"yellow";return/(^'.+'$)|(^".+"$)/.test(t)?n=t.replace(/^['"]/,"").replace(/['"]$/,""):(n=t.split(" "),n.unshift(t)),!(t.length<1)&&(VST.Book.isPBK()?VST.PictureBook.highlightTerms(n,o,"vst-search-term"):VST.$(VST.document.body).highlight(n,{className:"vst-search-term",color:o,element:"span",wordsOnly:!0}),!0)},h=function(){VST.Book.isPBK()?VST.PictureBook.unhighlightTerms():VST.$(VST.document.body).unhighlight({className:"vst-search-term",element:"span"})},f=function(e,t,n){VST.$(VST.scrollElement).scrollTop(t),n&&n()},g=function(e,t){VST.Book.getCurrentPage(function(n,o){var i=o.getCFIWithoutAssertions(),r=VST.sharedEpubModule.StripCFIAssertions(e),s=r.split("!");if(s[0]===i){0===s.length&&s.push("/2");var a=VST.sharedEpubModule.locateCFI(s[1]);if(!a.error)return"#text"===a.node.nodeName&&(a.node=a.node.parentNode),Jigsaw.navigateToNode(a.node,e),t()}Jigsaw.navigationRequested();var l=VST.Book.buildURL("/cfi"+e);Jigsaw.navigateTo(l,function(){t&&t()})})},p=function(e,t,n){if(e.cfi)return g(e.cfi,t,n);Jigsaw.navigationRequested();var o=e.cfi?VST.Book.buildAPIURL("/vbk/cfi/"+e.cfi):VST.Book.buildAPIURL("/content/element/"+e.id);Jigsaw.navigateTo(o,function(){t&&t()})},m=function(e){return{pageIndex:e.getIndex(),cfi:e.getCFI(),chapterTitle:e.getChapterTitle()}},T=function(e,t){t=t||e.innerText;var n="";if(["h1","h2","h3","h4","h5","h6","p"].indexOf(e.tagName.toLowerCase())>=0)return"<"+e.tagName+">"+t+"</"+e.tagName+">";if(["a","span"].indexOf(e.tagName.toLowerCase())>=0)return t;if(["title"].indexOf(e.tagName.toLowerCase())>=0)return"<h2>"+t+"</h2>";if(n+="<p>",e.children.length>0)for(var o=0;o<e.children.length;o++)n+=T(e.children[o],t);else n+=t;return n+="</p>"},v=function(){var e=VST.snippetSettings;e.doNotNavigate=!0,b.enter(e)},S=function(e,t,n){Jigsaw.navigationRequested();VST.Book.getPageBreaks(function(o,s){if(o)return n(o.message);var a=i(s,e)||r(s,e);if(a){var l=a.cfi?VST.Book.buildURL("/cfi"+a.cfi):VST.Book.buildURL(a.url);return t&&t(a),Jigsaw.navigateTo(l,function(){})}n("page not found")})},y=function(t){e.isWindow(VST.scrollElement)&&e(VST.scrollElement.frameElement).attr("scrolling",t)},b={getTOC:function(e,t){VST.Book.getTOC(function(n,o){n?t(n.message,o):e(o)})},getSpine:function(e,t){VST.Book.getPages(function(n,o){if(n)t(n.message);else{pages=[];for(var i=0;i<o.length;i++){var r=o[i];pages.push({url:r.getPath(),linear:r.isLinear(),cfi:r.getCFI(),cfiWithoutAssertions:r.getCFIWithoutAssertions()})}e(pages)}})},getAncillaries:function(t,i){e.ajax({url:VST.Book.buildAPIURL("/ancillaries"),dataType:"json",success:o(t),error:n(i)})},getAncillariesSummary:function(t,i){e.ajax({url:"/ancillaries",dataType:"json",success:o(t),error:n(i)})},getAllAccessCodes:function(t,i){e.ajax({url:"/ancillaries/code",dataType:"json",success:o(t),error:n(i)})},getAncillariesForVbid:function(t,i,r){e.ajax({url:"/books/-id-/ancillaries".replace("-id-",t),type:"GET",dataType:"json",success:o(i),error:n(r)})},redeemAncillary:function(t,i,r){e.ajax({url:"/ancillaries/-id-/redeem".replace("-id-",t),type:"PUT",dataType:"json",success:o(i),error:n(r)})},getThumbnails:function(t,i){e.ajax({url:VST.Book.buildAPIURL("/thumbnails"),dataType:"json",success:o(t),error:n(i)})},getCitationInfo:function(t,i){e.ajax({url:VST.Book.buildAPIURL("/citation"),dataType:"json",success:o(t),error:n(i)})},getFigures:function(t,i,r){var a={};if(Array.prototype.slice.call(arguments,0).length<3)r=i,i=t,t={};else for(var l in t)t.hasOwnProperty(l)&&(a[s(l)]=t[l]);e.ajax({url:VST.Book.buildAPIURL("/figures"),dataType:"json",data:{data:a},type:"GET",success:o(i),error:n(r)})},getPageBreaks:function(e,t){VST.Book.getPageBreaks(function(n,o){n?t(n.message,o):e(o)})},getBookmarks:function(t,i){e.ajax({url:VST.Book.buildAPIURL("/bookmarks"),dataType:"json",type:"GET",success:o(t),error:n(i)})},setBookmark:function(t,i,r){var a=Array.prototype.slice.call(arguments,0),l={};if(a.length<3)r=i,i=t,l={chapter_title:VST.currentPageData.chapterTitle},VST.Book.isDash()?l.chapter_offset=VST.sharedEpubModule.GetChapterOffsetForCurrentScrollPosition():VST.Book.isEpub()?(l.epub_cfi=VST.currentPageData.cfi.split("!")[0]+"!"+VST.sharedEpubModule.GetCFIForCurrentScrollPosition(),delete l.chapter_title):(l.pbk_page=VST.currentPageData.index,l.pbk_label=VST.currentPageData.page);else for(var c in t)t.hasOwnProperty(c)&&(l[s(c)]=t[c]);e.ajax({url:VST.Book.buildAPIURL("/bookmarks"),dataType:"json",type:"POST",data:{bookmark:l},success:o(i),error:n(r)})},deleteBookmark:function(t,i,r){e.ajax({url:VST.Book.buildAPIURL("/bookmarks/"+t),dataType:"json",type:"DELETE",success:o(i),error:n(r)})},getHighlights:function(e,t){VST.Book.getHighlights(function(n,o){n?t(n.message,o):e(o)})},addHighlight:function(e,t,n){var o={};for(var i in e)e.hasOwnProperty(i)&&(o[s(i)]=e[i]);l(o,t,n)},deleteHighlight:function(t,i,r){VST.Highlights.removeHighlight(t),e.ajax({url:VST.Book.buildAPIURL("/highlights/"+t),dataType:"json",type:"DELETE",success:o(i),error:n(r)})},redrawHighlights:function(e){return VST.Highlights.redrawHighlights(e)},focusHighlight:function(e,t,n){return e.skipNavigation?VST.Highlights.focusHighlight(e.syncId):2===arguments.length?(VST.Highlights.focusHighlight(),t()):void Jigsaw.navigateToHighlight(e,function(){return VST.Highlights.focusHighlight(e.syncId)},n)},getHighlightSummary:function(t,i){e.ajax({url:"/highlights/summary",dataType:"json",type:"GET",success:o(t),error:n(i)})},getDetailedHighlightSummary:function(t,i){e.ajax({url:"/highlights",dataType:"json",type:"GET",success:o(t),error:n(i)})},getMarkers:function(t,i){e.ajax({url:"/markers",dataType:"json",type:"GET",success:o(t),error:n(i)})},createMarker:function(t,i,r){var a={};for(var l in t)t.hasOwnProperty(l)&&(a[s(l)]=t[l]);e.ajax({url:"/markers",dataType:"json",data:{marker:a},type:"POST",success:o(i),error:n(r)})},updateMarker:function(t,i,r,a){var l={};for(var c in i)i.hasOwnProperty(c)&&(l[s(c)]=i[c]);e.ajax({url:"/markers/"+t,dataType:"json",data:{marker:l},type:"PUT",success:o(r),error:n(a)})},getMarker:function(t,i,r){e.ajax({url:"/markers/"+t,dataType:"json",type:"GET",success:o(i),error:n(r)})},deleteMarker:function(t,i,r){var s={};t.id&&(t.mergeWith&&(s.merge_with=t.mergeWith),t=t.id),e.ajax({url:"/markers/"+t,dataType:"json",data:s,type:"DELETE",success:o(i),error:n(r)})},updateHighlight:function(t,i,r,a){var l={};for(var c in i)i.hasOwnProperty(c)&&(l[s(c)]=i[c]);e.ajax({url:VST.Book.buildAPIURL("/highlights/"+t),data:{highlight:l},dataType:"json",type:"PUT",success:function(e,n,i){VST.Highlights.updateHighlight(t,e),o(r)(e,n,i)},error:n(a)})},highlightCurrentSelection:function(e,t,n){var o=VST.Highlights.getHighlightDataForCurrentSelection()||VST.lastHighlightDataForSelection;if(o){for(var i in e)e.hasOwnProperty(i)&&(o[s(i)]=e[i]);l(o,t,n)}},clearSelection:function(e){VST.Book.isPBK()?VST.PictureBook.selection.deselectAll():VST.sharedEpubModule.ClearSelection(),e&&e()},manageHighlights:function(t,i,r){var a={highlights:{add:[],"delete":[]}};t.add=t.add||[],t["delete"]=t["delete"]||[];for(var l=0;l<t.add.length;l++){var c={};for(var u in t.add[l])t.add[l].hasOwnProperty(u)&&(c[s(u)]=t.add[l][u]);a.highlights.add.push(c)}for(var d=0;d<t["delete"].length;d++){var h={};for(var f in t["delete"][d])t["delete"][d].hasOwnProperty(f)&&(h[s(f)]=t["delete"][d][f]);a.highlights["delete"].push(h)}e.ajax({url:VST.Book.buildAPIURL("/highlights/publish"),dataType:"json",type:"POST",data:a,success:o(i),error:n(r)})},searchContent:function(e,t,n){c(VST.Book.getISBN(),e,t,n)},searchBook:function(e,t,n,o){c(e,t,n,o)},searchHighlights:function(t,i,r){e.ajax({url:VST.Book.buildAPIURL("/highlights/search"),dataType:"json",data:{q:t},type:"GET",success:o(i),error:n(r)})},getEPUBFile:function(t,o,i){e.ajax({url:VST.Book.buildURL(t),success:function(e,t,n){var i={content:e,type:n.getResponseHeader("content-type")};o(i)},error:n(i)})},goToCFI:function(e,t,n){g(e,t,n)},goToFigure:function(e,t){Jigsaw.navigationRequested();var n;n="string"==typeof e||e instanceof String?VST.Book.buildAPIURL("/content/id/"+e):e.uuid?VST.Book.buildAPIURL("/content/id/"+e.uuid):VST.Book.buildAPIURL("/cfi"+e.cfi),Jigsaw.navigateTo(n,function(){t&&t()})},goToURL:function(e,t){Jigsaw.navigationRequested();var n=VST.Book.buildURL(e);Jigsaw.navigateTo(n,function(){t()})},goToFullURL:function(e,t){Jigsaw.navigationRequested(),Jigsaw.navigateTo(e,function(){t()})},goToPage:function(e,t,n){S(e,t,n)},goToSearchResult:function(e,t,n){p(e,t,n)},goToBookmark:function(e,t){Jigsaw.navigationRequested();var n;VST.Book.isEpub()?(cfi=e.epub_cfi||e.epubCfi,n=VST.Book.buildURL("/cfi"+cfi)):n=VST.Book.isPBK()?VST.Book.buildURL("/pageid/"+e.pbkPage):VST.Book.buildURL("/offset/"+e.chapterOffset+"?c="+encodeURIComponent(e.chapterTitle)),Jigsaw.navigateTo(n,function(){t&&t()})},enter:function(e,t,n){if(e.exclusive&&e.end&&-1!==e.end.indexOf("/")){for(var o=VST.Utils.stripCFIAssertions(e.end).split(/@|~/)[0].split("/"),i=o.pop();-1!==i.indexOf(":");)i=i.pop();i=parseInt(i,10),i%2==0&&(e.end=o.concat(i-1).join("/"))}VST.sharedEpubModule.exitContentRange&&VST.sharedEpubModule.exitContentRange(),Jigsaw.socket.getContentRange(e,function(o){if(o.startPage||o.endPage||o.startBase&&o.startPath||o.endBase&&o.endPath)VST.Book.getCurrentPage(function(i,r){var s=function(e,t,n){var o={width:0,height:0};if(e.cfi&&(0===Jigsaw.CFIUtils.compareCFIs(t,e.startBase)&&(a=e.startPath),0===Jigsaw.CFIUtils.compareCFIs(t,e.endBase)&&(l=e.endPath),e=new VST.sharedEpubModule.CFIRangeNode("",a,l,"","",""),o=e.limitContentRange()),Jigsaw.unbind("page:ready",v),Jigsaw.bind("page:ready",v,!0),VST.fire("snippet:ready",o),n)return n()};e.page=o.page,e.cfi=o.cfi,VST.snippetSettings=e;var a="",l="",c=m(r),d=r.getCFIWithoutAssertions();if(!e.doNotNavigate&&(e.cfi&&!u(d)||e.page&&!isPageInSnippet(c.pageIndex)))if(Jigsaw.once("page:ready",function(){setTimeout(function(){s(o,g,t,n)},10)}),o.startPage||o.endPage){var h=o.startPage;h===undefined&&(h=o.endPage);var f=VST.Book.buildURL("/cfi/"+h);Jigsaw.navigateTo(f,function(){})}else{var g=o.startBase||o.endBase,p=VST.Book.buildURL("/cfi"+g);Jigsaw.navigateTo(p,function(){})}else s(o,d,t,n)});else if(n)return n()})},exit:function(e,t){VST.snippetSettings=undefined,Jigsaw.unbind("page:ready",v),VST.sharedEpubModule.exitContentRange(),VST.fire("snippet:exit"),t&&t()},goTo:function(){},snippetHasNextPage:function(e){VST.Book.getNextPage(function(t,n){var o=m(n);e(isInSnippet(o.pageIndex||o.cfi))})},snippetHasPreviousPage:function(e){VST.Book.getPreviousPage(function(t,n){var o=m(n);e(isInSnippet(o.pageIndex||o.cfi+"!/999998"))})},getPreview:function(e,t,n){var o=VST.sharedEpubModule.locateCFI(e);if(o.error)return n("node not found");for(var i=o.node,r=0,s=300,a="";r<s&&i;){for(;["body","head","div","section"].indexOf(i.tagName.toLowerCase())>=0;){for(var l=!1,c=0;c<i.childNodes.length;c++){if(l=!0,"#text"!==i.childNodes[c].nodeName){i=i.childNodes[c];break}l=!1}if(!l)break}if("#text"===i.nodeName||["script","meta","link","style","head"].indexOf(i.tagName.toLowerCase())<0){var u=i.innerText;u.length+r>s&&(u=u.substring(0,s-r)),r+=u.length,a+=T(i,u)}i=i.nextElementSibling?i.nextElementSibling:i.parentElement.nextElementSibling}t(a)},searchInSnippet:function(e,t,n,o){h(),d({term:e}),t=VST.Utils.stripCFIAssertions(t);var i,r=t.split("!")[0],s=!0;c(VST.Book.getISBN(),e,function(o){for(var a=[],l=0;l<o.length;l++){var c=o[l];if(u(c.cfi)||isPageInSnippet(c.id))for(var d=0;d<c.term_locs.length;d++){var h=jQuery.extend({},c);h.term_locs=[c.term_locs[d]],c.term_cfis&&(h.term_cfis=[c.term_cfis[d]]),h.siblingsCount=c.term_locs.length,h.termIndex=d,h.searchedTerm=e;var f=h.cfi||"/"+h.id,g=VST.Utils.stripCFIAssertions(f).split("!")[0],p=Jigsaw.CFIUtils.compareCFIs(f,t)>-1;s&&(r===g||p)&&(i=a.length,p&&(s=!1)),a.push(h)}}i=i||0,n({results:a,focusIndex:i})},o)},focusTerm:function(t,n){p(t,function(){0===VST.$(VST.document.body).find(".vst-search-term").length&&d({term:t.searchedTerm});var o=VST.$(VST.document.body).find(".vst-focused-term");o.removeClass("vst-focused-term"),o.css("background",o.data("old-background"));var i;if(t.term_cfis){for(var r=VST.sharedEpubModule.locateCFI(t.term_cfis[0].base),s=r.node.parentNode,a=s.getElementsByClassName("vst-search-term").length;a<t.siblingsCount;)s=s.parentNode,a=s.getElementsByClassName("vst-search-term").length;i=s.getElementsByClassName("vst-search-term")[t.termIndex],e(i).addClass("vst-focused-term"),e(i).data("old-background",e(i).css("background")),e(i).css("background","#ffa758")}else if(VST.Book.isPBK()&&t.term_locs){for(var l=VST.$(VST.document.body).find("#pbk-search").find(".pbk-glyph.vst-search-term"),c=t.term_locs[0].len,u=t.term_locs[0].pos,a=0;a<l.length;a++){var h=e(l[a]),f=h.data("glyph");f>=u&&f<u+c&&(h.addClass("vst-focused-term"),h.data("old-background",h.css("background")),h.css("background","#ffa758"))}i=VST.$(VST.document.body).find(".vst-focused-term");var g=function(){VST.unbind("page:transform",g);var t,n=function(t){var n=VST.scrollElement;e.isWindow(n)&&(n=e(n.document).find("html, body")),e(n).stop(),t=(t>100?t-100:0)+"px",e(n).animate({scrollTop:t},500)},o=0,r=setInterval(function(){o+=1,o>=10&&clearInterval(r),i&&i[0]&&0===i[0].getBoundingClientRect().top||(t=i&&i.offset()&&i.offset().top||-1)>=0&&(clearInterval(r),n(t))},100)};VST.bind("page:transform",g)}else i=VST.document.getElementsByClassName("vst-search-term")[t.termIndex],e(i).addClass("vst-focused-term"),e(i).data("old-background",e(i).css("background")),e(i).css("background","#ffa758");n&&n()})},isActive:function(e){return e(!!VST.snippetSettings)},highlightTerm:function(e,t,n){if(!d(e))return n("Term cannot be blank");t&&t()},unhighlightTerms:function(){h(),success&&success()},goToHighlight:function(e,t,n){Jigsaw.navigateToHighlight(e,t,n)},goToPreviousPage:function(e,t){VST.Book.goToPreviousPage(function(n,o){n?t(n.message):e(o)})},goToNextPage:function(e,t){VST.Book.goToNextPage(function(n,o){n?t(n.message):e(o)})},hasPreviousPage:function(e,t){VST.Book.hasPreviousPage(function(n,o){n?t(n.message):e(o)})},hasNextPage:function(e,t){VST.Book.hasNextPage(function(n,o){n?t(n.message):e(o)})},getNextPage:function(e,t){VST.Book.getNextPage(function(n,o){n?t(n.message):e(m(o))})},getPreviousPage:function(e,t){VST.Book.getPreviousPage(function(n,o){n?t(n.message):e(m(o))})},stripCFIAssertions:function(e){return VST.sharedEpubModule.StripCFIAssertions(e)},compareCFIs:function(e,t){return Jigsaw.Utils.CFIUtils.compareCFIs(e,t)},getContainerDimensions:function(){return Jigsaw.getContainerDimensions()},focus:function(){return Jigsaw.focus()},scrollTo:function(e,t){f(0,parseInt(e,10),t)},scrollToTop:function(e){f(0,0,e)},scrollToBottom:function(e){f(0,999999999,e)},touchEventsEnabled:function(e){
return Jigsaw.touchEventsEnabled("",e)},setCursor:function(e){return Jigsaw.setCursor(e)},resetCursor:function(){return Jigsaw.resetCursor()},getCFIForPoint:function(e,t){for(var n=VST.Utils.scrollTop(),o=VST.Utils.scrollLeft(),i=VST.document.elementFromPoint(e.x,e.y);-1!==i.className.indexOf("vstignore");)i=i.parentElement;t({cfi:VST.sharedEpubModule.GetCFIForNode(i),nodeRect:{top:i.offsetTop-n,left:i.offsetLeft-o,right:i.offsetLeft-o+i.offsetWidth,bottom:i.offsetTop-n+i.offsetHeight,width:i.offsetWidth,height:i.offsetHeight}})},getPositionForCFI:function(e,t,n){VST.Book.getCurrentPage(function(o,i){var r=i.getCFIWithoutAssertions(),s=e.split("!");if(1===s.length)e=s[0];else{if(VST.sharedEpubModule.StripCFIAssertions(s[0])!==r)return n("node not found");e=s[1]}var a=VST.sharedEpubModule.locateCFI(e);if(a.error)return n("node not found");var l=a.node,c=VST.Utils.scrollTop(),u=VST.Utils.scrollLeft();return t({cfi:e,nodeRect:{top:l.offsetTop-c,left:l.offsetLeft-u,right:l.offsetLeft-u+l.offsetWidth,bottom:l.offsetTop-c+l.offsetHeight,width:l.offsetWidth,height:l.offsetHeight}})})},searchMetadata:function(t,i,r){e.ajax({url:"/search/metadata",type:"GET",data:{q:t},dataType:"json",success:o(i),error:n(r)})},getBookList:function(e,t,n){Array.prototype.slice.call(arguments,0).length<3&&(n=t,t=e,e={});var o={};for(var i in e)e.hasOwnProperty(i)&&(o[s(i)]=e[i]);VST.User.getBooks(o,function(e,o){e?n(e.message):t(o)})},getBookInfo:function(t,i,r){e.ajax({url:"/books/:isbn".replace(":isbn",t),type:"GET",dataType:"json",success:o(i),error:n(r)})},getSubscriptions:function(t,i){e.ajax({url:"/user/subscriptions",type:"GET",dataType:"json",success:o(t),error:n(i)})},getUserInfo:function(e,t){VST.User.getInfo(function(i,r){i?n(t)(i.message):o(e)(r)})},requestUserActivation:function(t,i,r){e.ajax({url:"/activation_requests",type:"POST",dataType:"json",data:{redirect:t},success:o(i),error:n(r)})},getUserGroups:function(t,i){e.ajax({url:"/user/groups",dataType:"json",success:o(t),error:n(i)})},getUserFollowers:function(t,i){e.ajax({url:"/user/followers",dataType:"json",success:o(t),error:n(i)})},getUserFollowings:function(t,i){e.ajax({url:"/user/followings",dataType:"json",success:o(t),error:n(i)})},unfollowUser:function(t,i,r){e.ajax({url:"/user/followings/"+t,method:"delete",dataType:"json",success:o(i),error:n(r)})},blockUser:function(t,i,r){e.ajax({url:"/user/followers/"+t+"/blocks",method:"post",dataType:"json",success:o(i),error:n(r)})},unblockUser:function(t,i,r){e.ajax({url:"/user/blocks/"+t,method:"delete",dataType:"json",success:o(i),error:n(r)})},getBlocks:function(t,i){e.ajax({url:"/user/blocks",method:"get",dataType:"json",success:o(t),error:n(i)})},getCollections:function(t,i){e.ajax({url:"/collections",dataType:"json",success:o(t),error:n(i)})},ssoUser:function(t,i,r){e.ajax({url:"/user/sso",type:"POST",data:{redirect:t},dataType:"json",success:o(i),error:n(r)})},setFlag:function(t,i,r,s){e.ajax({url:"/user/flag",type:"POST",data:{name:t,enabled:i},dataType:"json",success:o(r),error:n(s)})},oldSSOUser:function(t,i,r){e.ajax({url:"/user/old_sso",type:"POST",data:{redirect:t},dataType:"json",success:o(i),error:n(r)})},createLTILaunch:function(t,i,r){Array.prototype.slice.call(arguments,0).length<3&&(r=i,i=t,t={});var s=t;!s.isbn&&VST.Book&&(s.isbn=VST.Book.getISBN()),e.ajax({url:"/user/lti",type:"POST",data:{launch:s},dataType:"json",success:o(i),error:n(r)})},printOnDemandURL:function(t,i){e.ajax({url:"/user/pod",type:"GET",dataType:"json",success:o(t),error:n(i)})},setUserInfo:function(t,i,r){var s=a(t);e.ajax({url:"/user",type:"PUT",data:{user:s},dataType:"json",success:o(i),error:n(r)})},getDevices:function(t,i){e.ajax({url:"/user/devices",type:"GET",dataType:"json",success:o(t),error:n(i)})},getPreferredLanguages:function(t,i){e.ajax({url:"/user/languages",type:"GET",dataType:"json",success:o(t),error:n(i)})},deactivateDevice:function(t,i,r){e.ajax({url:"/user/devices/"+t,type:"DELETE",dataType:"json",success:o(i),error:n(r)})},forgotPassword:function(t,i,r){var s=a(t);e.ajax({url:"/forgot",type:"POST",data:{forgot:s},dataType:"json",success:o(i),error:n(r)})},updateForgottenPassword:function(t,i,r){var s=a(t);e.ajax({url:"/forgot/"+t.token,type:"PUT",data:{user:s},dataType:"json",success:o(i),error:n(r)})},redeemCode:function(t,i,r){e.ajax({url:"/user/redeem",type:"POST",data:{code:t},dataType:"json",success:o(i),error:n(r)})},search:function(t,i,r,s){Array.prototype.slice.call(arguments,0).length<4&&(s=r,r=i,i={}),i.q=t,e.ajax({url:"/search",type:"GET",data:i,dataType:"json",success:o(r),error:n(s)})},sendMobileAppLinkText:function(t,i,r){e.ajax({url:"/bandwidth_messages/mobile_apps",type:"POST",data:{bandwidth_message:t},dataType:"json",success:o(i),error:n(r)})},sendMobileAppLinkEmail:function(t,i,r){e.ajax({url:"/emails/mobile_apps",type:"POST",data:{email:t},dataType:"json",success:o(i),error:n(r)})},generateCaptcha:function(t,i){e.ajax({url:"/captcha",type:"GET",dataType:"json",success:o(t),error:n(i)})},createUser:function(t,i,r){var s=a(t);e.ajax({url:"/user",type:"POST",data:{user:s,"g-recaptcha-response":s.recaptcha_response},dataType:"json",success:o(i),error:n(r)})},mergeAccount:function(t,i,r){e.ajax({url:"/user/merge",type:"POST",data:{user:t,secure_token:this.secureToken},dataType:"json",success:o(i),error:n(r)})},signOut:function(t,i){e.ajax({url:"/logout",type:"DELETE",dataType:"json",success:function(e){Jigsaw.trigger("user:signout"),o(t)(e)},error:n(i)})},updateLicense:function(t,i){e.ajax({url:"/user/update_license",type:"POST",data:{},dataType:"json",success:o(t),error:n(i)})},asyncUpdateLicense:function(t,i){e.ajax({url:"/user/async_license",type:"POST",data:{},dataType:"json",success:o(t),error:n(i)})},asyncLicenseStatus:function(t,i,r){e.ajax({url:"/user/"+t+"/async_license_status",dataType:"json",success:o(i),error:n(r)})},userExists:function(t,i,r){e.ajax({url:"/user/"+t+"/exists",dataType:"json",success:o(i),error:n(r)})},addEvents:function(t,i,r){t.length||(t=[t]),e.ajax({url:"/events",type:"POST",data:{events:t},dataType:"json",success:o(i),error:n(r)})},fitToHeight:function(){VST.Book.isPBK()&&VST.PictureBook.fitToHeight()},fitToWidth:function(){VST.Book.isPBK()&&VST.PictureBook.fitToWidth()},printPageRange:function(e,t,n){n("//"+VST.window.location.hostname+VST.Book.buildAPIURL("/print")+"?from="+e+"&to="+t)},subscribeTo:function(t,i,r){e.ajax({url:"/user/subscriptions",type:"POST",dataType:"json",data:{email:t},success:o(i),error:n(r)})},unsubscribeFrom:function(t,i,r){e.ajax({url:"/user/subscriptions/"+t,type:"DELETE",dataType:"json",success:o(i),error:n(r)})},befriendUser:function(t,i,r){var s=a(t);e.ajax({url:"/user/subscriptions/befriend",type:"POST",dataType:"json",data:s,success:o(i),error:n(r)})},unfriendUser:function(t,i,r){e.ajax({url:"/user/subscriptions/unfriend",type:"DELETE",dataType:"json",data:{email:t},success:o(i),error:n(r)})},getFriends:function(t,i){e.ajax({url:"/user/subscriptions/friends",type:"GET",dataType:"json",success:o(t),error:n(i)})},autoSubscribe:function(t,i){e.ajax({url:"/user/subscriptions/auto_subscribe",type:"POST",dataType:"json",success:o(t),error:n(i)})},copyHighlight:function(t,n){var o=".highlight_"+t,i=e(VST.document.body).find(o),r=VST.document.createRange();r.setStart(i[0],0),r.setEndAfter(i[i.length-1]),VST.window.getSelection().addRange(r);var s=VST.Book.getCopyLimit(),a=VST.Book.limitSelection(s,"copy");n(0==s?"Copying not allowed":a),VST.window.getSelection().removeAllRanges()},copySelection:function(e,t){VST.Book.handleCopy()?e(VST.Utils.getSelectedText()):t("copying not allowed")},getUniversalURL:function(t,o){var i=VST.Book.getFormat().toLowerCase();if("pbk"===i)return t(VST.Book.buildURL("/pageid/"+VST.currentPageData.index));if("epub"==i){var r=VST.currentPageData.cfi.split("!")[0]+"!"+VST.sharedEpubModule.GetCFIForCurrentScrollPosition(),s=VST.Book.buildURL("/epubcfi"+r);return s=s.replace("epub/",""),t(s)}var a=VST.sharedEpubModule.GetNodeForCurrentScrollPosition(!0),l=a.getAttribute("eid");!l&&a.parentElement&&(l=a.parentElement.getAttribute("eid")),l&&""!==l?e.ajax({url:VST.Book.buildURL("/eid/"+l),dataType:"json",type:"GET",success:function(e){t(VST.Book.buildURL("/id/"+e.pointer))},error:n(o)}):o("node not found")},_getDocumentHTML:function(){if(!VST.document)return null;var t;try{t=e(VST.document).find("html")}catch(e){return null}return t},_isIOS:function(){return/(iPhone|iPad|iPod)/.test(navigator.userAgent)},increaseZoomScale:function(t){var n=b._getDocumentHTML();b._isIOS()&&(n=e("#epub-content")),VST.zoomScaleFactor=VST.zoomScaleFactor||1,VST.zoomScaleFactor+=.25,1===VST.zoomScaleFactor?n.css("transform",""):n.css("transform","scale("+VST.zoomScaleFactor+")"),n.css("transform-origin","top left"),VST.fire("page:transform"),t(3==VST.zoomScaleFactor?{message:"zoom limit reached",zoomScale:VST.zoomScaleFactor}:{message:"success",zoomScale:VST.zoomScaleFactor})},decreaseZoomScale:function(t){var n=b._getDocumentHTML();b._isIOS()&&(n=e("#epub-content")),VST.zoomScaleFactor=VST.zoomScaleFactor||1,VST.zoomScaleFactor-=.25,1===VST.zoomScaleFactor?n.css("transform",""):n.css("transform","scale("+VST.zoomScaleFactor+")"),n.css("transform-origin","top left"),VST.fire("page:transform"),t(.25==VST.zoomScaleFactor?{message:"zoom limit reached",zoomScale:VST.zoomScaleFactor}:{message:"success",zoomScale:VST.zoomScaleFactor})},setZoomScale:function(e,t){VST.zoomScaleFactor=e;var n=b._getDocumentHTML();1===VST.zoomScaleFactor?n.css("transform",""):n.css("transform","scale("+VST.zoomScaleFactor+")"),VST.fire("page:transform"),t({message:"success",zoomScale:VST.zoomScaleFactor})},getZoomScale:function(e){e({message:"success",zoomScale:VST.zoomScaleFactor})},dictionaryLookup:function(t,i,r){e.ajax({url:"/dictionary/pearson/-currentWord-".replace("-currentWord-",encodeURIComponent(t)),type:"GET",dataType:"json",success:o(i),error:n(r)})},increaseTextSize:function(e,t){if(VST.Book.isPBK())return e(zoomPDF("increase"));var n=b._getDocumentHTML(),o=4,i=VST.textSize||"1.00",r=parseFloat(i);if(r+=.25,r>2&&(r+=.25),parseFloat(r)>o)return void t({message:"cannot exceed text size limit"});var s=100*r+"%";n.css("font-size",s),parseFloat(r)==o?(VST.textSize=r,e({message:"text limit reached",textSize:r.toString()})):(VST.textSize=r,e({message:"success",textSize:r.toString()}))},decreaseTextSize:function(e,t){if(VST.Book.isPBK())return e(zoomPDF("decrease"));var n=b._getDocumentHTML(),o=.5;VST.Book.isPBK()&&(o=1);var i=VST.textSize||"1.00",r=parseFloat(i);if(r-=.25,r>2&&(r-=.25),r=r.toString(),parseFloat(r)<o)return void t({message:"text limit reached",textSize:r.toString()});var s=100*r+"%";n.css("font-size",s),parseFloat(r)==o?(VST.textSize=r,e({message:"text limit reached",textSize:r.toString()})):(VST.textSize=r,e({message:"success",textSize:r.toString()}))},getTextSize:function(e){e({message:"text limit reached",textSize:VST.textSize.toString()||"1"})},setTextSize:function(t,n,o){var i=e(VST.document).find("html"),r=parseFloat(t);if(r<.5||r>4)return void o("cannot exceed text size limit");var s=100*r+"%";i.css("font-size",s),VST.textSize=r,n({message:"text limit reached",textSize:r.toString()})},cleanupBeforeDestroy:function(e){VST.BatchedPageViewLogger&&(VST.BatchedPageViewLogger.flushSyncAndStop(),e())},enableLab:function(t,i,r){e.ajax({url:"/user/labs/-id-/enable".replace("-id-",t),type:"POST",dataType:"json",success:o(i),error:n(r)})},disableLab:function(t,i,r){e.ajax({url:"/user/labs/-id-/disable".replace("-id-",t),type:"POST",dataType:"json",success:o(i),error:n(r)})},likeLab:function(t,i,r){e.ajax({url:"/user/labs/-id-/like".replace("-id-",t),type:"POST",dataType:"json",success:o(i),error:n(r)})},dislikeLab:function(t,i,r){e.ajax({url:"/user/labs/-id-/dislike".replace("-id-",t),type:"POST",dataType:"json",success:o(i),error:n(r)})},getLabInfo:function(t,i,r){e.ajax({url:"/labs/-id-".replace("-id-",t),type:"GET",dataType:"json",success:o(i),error:n(r)})},getAllLabInfos:function(t,i){e.ajax({url:"/labs",type:"GET",dataType:"json",success:o(t),error:n(i)})},getAllTransactions:function(t,i){e.ajax({url:"/user/transactions",type:"GET",dataType:"json",success:o(t),error:n(i)})},getTransaction:function(t,i,r){e.ajax({url:"/user/transactions/-id-".replace("-id-",t),type:"GET",dataType:"json",success:o(i),error:n(r)})},getBrandConfig:function(t,i,r){e.ajax({url:"/brands/-id-".replace("-id-",t),type:"GET",dataType:"json",success:o(i),error:n(r)})},requestRefund:function(t,i,r){e.ajax({url:"/user/transactions/-id-/refund".replace("-id-",t.transactionId),data:{refund:a(t)},type:"POST",dataType:"json",success:o(i),error:n(r)})},setupSecureToken:function(e){this.secureToken=e},resendActivationEmail:function(t,i,r){e.ajax({url:"/user/activation",data:t,type:"POST",dataType:"json",success:o(i),error:n(r)})},oneNote:function(t,i,r){e.ajax({url:"/user/one-note",data:a(t),type:"POST",dataType:"json",success:o(i),error:n(r)})},setAutofocus:function(e,t){VST.autofocus=e,t(!0)},tts:function(e,t){var n=VST.TTS.sendStatus=function(){VST.fire("tts:status",{speaking:window.speechSynthesis.speaking,paused:window.speechSynthesis.paused,pending:window.speechSynthesis.pending})};switch(e.action){case"start":VST.TTS.startAtTop();break;case"cancel":VST.TTS.cancel();break;case"pause":VST.TTS.pause();break;case"resume":VST.TTS.resume();break;case"next":VST.TTS.next();break;case"prev":VST.TTS.prev();break;case"setVolume":VST.TTS.setVolume(e.value);break;case"setVoice":VST.TTS.setVoice(e.value);break;case"setRate":VST.TTS.setRate(e.value);break;case"setPitch":VST.TTS.setPitch(e.value);break;case"setLang":VST.TTS.setLang(e.value)}setTimeout(n,250),t()},disableScrolling:function(e){VST.pageScrollDisabled=!0,y("no"),e()},enableScrolling:function(e){VST.pageScrollDisabled=!1,y("auto"),e()}},x=["ready","fire","zoomDisabled","swipeDisabled","highlightsEnabled","noteIcon","topURL","getContentRange","enter"],V=x.length-1;V>=0;V--)Jigsaw.socketMethods.remote[x[V]]={};Jigsaw.addLocalSocketMethods(b),Jigsaw.socket=new easyXDM.Rpc(Jigsaw.socketOptions,Jigsaw.socketMethods)}.call(this,VST.$),function(e){var t=function(t){VST.trigger("user:signout",e.parseJSON(t.responseText))},n=function(){};n.prototype.mark=function(n){VST.Book&&n&&n.page&&(d={page:n.page},e.ajax({url:VST.Book.buildAPIURL("/logs/bookmark"),type:"POST",data:{log:d,insecure:n.insecure},dataType:"json",statusCode:{401:t}}))},VST.Bookmarker=new n,VST.bind("page:load",function(e,t){VST.$(VST.document).find('[src^="http:"],link[href^="http:"]').length>0&&(t.insecure=!0),VST.Bookmarker.mark(t)})}.call(this,VST.$),function(){var e=function(){return{}};VST.bind("page:ready",function(){for(var e=VST.$(VST.document),t=["click","keyup","keydown","keypress","touchstart","touchend","touchmove"],n=t.length-1;n>=0;n--)!function(t){"click"==t&&"ontouchstart"in window||(jigName=t+".jigsaw",e.off(jigName).on(jigName,function(e){if("click"===t){for(var n=e.target;"g"===n.nodeName.toLowerCase()||"path"===n.nodeName.toLowerCase()||"svg"===n.nodeName.toLowerCase();)n=n.parentNode;var o=VST.$(n);if(o.hasClass(VST.Models.Highlight.Settings.highlightClass))return;for(var i=e.target;i;){if(["a","button","input","textarea","select","area"].indexOf(i.nodeName.toLowerCase())>=0)return;if(1!==i.nodeType)break;i=i.parentNode}if(o.hasClass("vst-click"))return;if(e.isDefaultPrevented()||e.isImmediatePropagationStopped()||e.isPropagationStopped())return;if(""!==VST.Utils.getSelectedText())return}if(/^key/.test(t))VST.trigger("book:"+t,{keyCode:e.which});else{var r=e.originalEvent.touches&&e.originalEvent.touches.length>0?e.originalEvent.touches[0]:e,i=e.target,s=VST.Utils.scrollTop(),a=VST.Utils.scrollLeft(),l=VST.sharedEpubModule.GetCFIForNode(i);VST.trigger("book:"+t,{x:r.clientX,y:r.clientY,cfi:l,nodeRect:{top:i.offsetTop-s,left:i.offsetLeft-a,right:i.offsetLeft-a+i.offsetWidth,bottom:i.offsetTop-s+i.offsetHeight,width:i.offsetWidth,height:i.offsetHeight}})}}))}(t[n]);VST.$(VST.window).on("mousewheel DOMMouseScroll wheel",function(e){VST.trigger("book:mousewheel",{delta:e.originalEvent.deltaY})}),e.on("mousemove",function(){VST.throttle("book:mousemove",+new Date,50)})}),VST.bind("page:ready",function(){var t;VST.$(VST.document).on("touchstart",function(e){var n=e.originalEvent.changedTouches&&e.originalEvent.changedTouches.length>0?e.originalEvent.changedTouches[0]:e.originalEvent;t||(t={event:e,pageX:n.pageX,pageY:n.pageY,timeStamp:e.timeStamp})}).on("touchend",function(n){if(VST.$(n.target).hasClass(VST.Models.Highlight.Settings.highlightClass))return void(t=null);var o=n.originalEvent.changedTouches&&n.originalEvent.changedTouches.length>0?n.originalEvent.changedTouches[n.originalEvent.changedTouches.length-1]:n.originalEvent;if(n.timeStamp-t.timeStamp<175){var i=Math.abs(o.pageX-t.pageX),r=Math.abs(o.pageY-t.pageY);Math.sqrt(i*i+r*r)<7&&VST.trigger("book:click",e(n))}t=null})})}.call(this),function(e){e.Handler.set("book:getCurrentPageURL",function(){return e.window.location.pathname.replace(/\/?books\/[^\/]+(\/(epub|cfi))?/,"")}),e.Handler.set("book:goToNextPage",function(t){Jigsaw.navigationRequested();var n=this;e.eventWrapper("book:nextPage",function(){document.getElementById("next-page")?(e.trigger("page:unload"),t&&e.once("page:ready",t),e.Loading.initNextPage()):n.getNextPage(function(n,o){o?Jigsaw.navigateTo(o.getURL(),function(){t(undefined,o)}):t(new e.Error("page not found"))})})}),e.Handler.set("book:goToPreviousPage",function(t){Jigsaw.navigationRequested();var n=this;e.eventWrapper("book:previousPage",function(){document.getElementById("prev-page")?(e.trigger("page:unload"),t&&e.once("page:ready",t),e.Loading.initPreviousPage()):n.getPreviousPage(function(n,o){o?Jigsaw.navigateTo(o.getURL(),function(){t(undefined,o)}):t(new e.Error("page not found"))})})})}.call(this,VST,VST.$);